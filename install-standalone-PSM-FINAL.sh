#!/bin/bash
set -e

echo "======================================"
echo "Proxmox Storage Management Installer"
echo "======================================"

if [ "$EUID" -ne 0 ]; then 
   echo "âŒ Run as root: sudo bash install-standalone.sh"
   exit 1
fi

if [ ! -f /etc/pve/storage.cfg ]; then
   echo "âŒ Must run on Proxmox VE server"
   exit 1
fi

echo "âœ“ Proxmox VE detected"
echo ""

# Stop existing
systemctl stop pxstor-agent 2>/dev/null || true
systemctl stop pxstor-coordinator 2>/dev/null || true

echo "ðŸ“¦ Installing dependencies..."
apt-get update -qq >/dev/null 2>&1
apt-get install -y curl wget build-essential >/dev/null 2>&1

# Go
if ! command -v go &> /dev/null; then
    echo "ðŸ“¦ Installing Go..."
    wget -q https://go.dev/dl/go1.21.0.linux-amd64.tar.gz
    rm -rf /usr/local/go
    tar -C /usr/local -xzf go1.21.0.linux-amd64.tar.gz
    rm go1.21.0.linux-amd64.tar.gz
fi
export PATH=$PATH:/usr/local/go/bin

# Node.js
if ! command -v node &> /dev/null; then
    echo "ðŸ“¦ Installing Node.js..."
    curl -fsSL https://deb.nodesource.com/setup_20.x | bash - >/dev/null 2>&1
    apt-get install -y nodejs >/dev/null 2>&1
fi

echo "âœ“ Dependencies installed"
echo ""

echo "ðŸ“ Creating directories..."
mkdir -p /opt/pxstor/{bin,src/{agent,coordinator,ui/src},ui}
useradd -r -s /bin/false pxstor 2>/dev/null || true

# Generate token
TOKEN=9ad3bec3aa5eea7812ff261f781a03ad7eb6873e025e690e
mkdir -p /etc/pxstor
echo "token: $TOKEN" > /etc/pxstor/config.yml

echo "ðŸ“ Extracting source code..."

# Agent
echo "cGFja2FnZSBtYWluCgppbXBvcnQgKAoJImVuY29kaW5nL2pzb24iCgkiZm10IgoJImlvIgoJImxvZyIKCSJtaW1lL211bHRpcGFydCIKCSJuZXQvaHR0cCIKCSJvcyIKCSJvcy9leGVjIgoJInBhdGgvZmlsZXBhdGgiCgkic3RyaW5ncyIKCSJzdHJjb252IgoJInN5bmMiCgkidGltZSIKCSJzeXNjYWxsIgoKCSJnb3BrZy5pbi95YW1sLnYzIgopCgp0eXBlIENvbmZpZyBzdHJ1Y3QgewoJVG9rZW4gc3RyaW5nIGB5YW1sOiJ0b2tlbiJgCn0KCnR5cGUgU3RvcmFnZSBzdHJ1Y3QgewoJSUQgICBzdHJpbmcgYHlhbWw6Ii0iYAoJVHlwZSBzdHJpbmcgYHlhbWw6InR5cGUiYAoJUGF0aCBzdHJpbmcgYHlhbWw6InBhdGgiYAp9Cgp0eXBlIEpvYiBzdHJ1Y3QgewoJSUQgICAgICAgc3RyaW5nCglPcCAgICAgICBzdHJpbmcKCVN0YXR1cyAgIHN0cmluZwoJUHJvZ3Jlc3MgaW50NjQKCVRvdGFsICAgIGludDY0CglDdXJyZW50ICBzdHJpbmcKCUZhaWxlZCAgIFtdc3RyaW5nCgltdSAgICAgICBzeW5jLk11dGV4Cn0KCnR5cGUgUHJvZ3Jlc3NSZWFkZXIgc3RydWN0IHsKCXIgICBpby5SZWFkZXIKCWpvYiAqSm9iCn0KCmZ1bmMgKHByICpQcm9ncmVzc1JlYWRlcikgUmVhZChwIFtdYnl0ZSkgKGludCwgZXJyb3IpIHsKCW4sIGVyciA6PSBwci5yLlJlYWQocCkKCWlmIG4gPiAwIHsKCQlwci5qb2IubXUuTG9jaygpCgkJcHIuam9iLlByb2dyZXNzICs9IGludDY0KG4pCgkJcHIuam9iLm11LlVubG9jaygpCgl9CglyZXR1cm4gbiwgZXJyCn0KCnZhciAoCgljb25maWcgICBDb25maWcKCWpvYnMgICAgID0gbWFrZShtYXBbc3RyaW5nXSpKb2IpCglqb2JNdXRleCBzeW5jLk11dGV4CglsYXN0Q1BVVG90YWwgdWludDY0CglsYXN0Q1BVSWRsZSB1aW50NjQKCWNwdU11dGV4IHN5bmMuTXV0ZXgKKQoKZnVuYyBjb3JzTWlkZGxld2FyZShuZXh0IGh0dHAuSGFuZGxlcikgaHR0cC5IYW5kbGVyIHsKCXJldHVybiBodHRwLkhhbmRsZXJGdW5jKGZ1bmModyBodHRwLlJlc3BvbnNlV3JpdGVyLCByICpodHRwLlJlcXVlc3QpIHsKCQl3LkhlYWRlcigpLlNldCgiQWNjZXNzLUNvbnRyb2wtQWxsb3ctT3JpZ2luIiwgIioiKQoJCXcuSGVhZGVyKCkuU2V0KCJBY2Nlc3MtQ29udHJvbC1BbGxvdy1NZXRob2RzIiwgIkdFVCwgUE9TVCwgUFVULCBERUxFVEUsIE9QVElPTlMiKQoJCXcuSGVhZGVyKCkuU2V0KCJBY2Nlc3MtQ29udHJvbC1BbGxvdy1IZWFkZXJzIiwgIkNvbnRlbnQtVHlwZSwgQXV0aG9yaXphdGlvbiIpCgkJaWYgci5NZXRob2QgPT0gIk9QVElPTlMiIHsKCQkJdy5Xcml0ZUhlYWRlcihodHRwLlN0YXR1c09LKQoJCQlyZXR1cm4KCQl9CgkJbmV4dC5TZXJ2ZUhUVFAodywgcikKCX0pCn0KCmZ1bmMgYXV0aE1pZGRsZXdhcmUobmV4dCBodHRwLkhhbmRsZXJGdW5jKSBodHRwLkhhbmRsZXJGdW5jIHsKCXJldHVybiBmdW5jKHcgaHR0cC5SZXNwb25zZVdyaXRlciwgciAqaHR0cC5SZXF1ZXN0KSB7CgkJYXV0aCA6PSByLkhlYWRlci5HZXQoIkF1dGhvcml6YXRpb24iKQoJCXRva2VuIDo9IHIuVVJMLlF1ZXJ5KCkuR2V0KCJ0b2tlbiIpCgkJCgkJaWYgYXV0aCAhPSAiQmVhcmVyICIrY29uZmlnLlRva2VuICYmIHRva2VuICE9IGNvbmZpZy5Ub2tlbiB7CgkJCWh0dHAuRXJyb3IodywgIlVuYXV0aG9yaXplZCIsIGh0dHAuU3RhdHVzVW5hdXRob3JpemVkKQoJCQlyZXR1cm4KCQl9CgkJbmV4dCh3LCByKQoJfQp9CgpmdW5jIHBhcnNlU3RvcmFnZXMoKSAobWFwW3N0cmluZ11TdG9yYWdlLCBlcnJvcikgewoJZGF0YSwgZXJyIDo9IG9zLlJlYWRGaWxlKCIvZXRjL3B2ZS9zdG9yYWdlLmNmZyIpCglpZiBlcnIgIT0gbmlsIHsKCQlyZXR1cm4gbmlsLCBlcnIKCX0KCXN0b3JhZ2VzIDo9IG1ha2UobWFwW3N0cmluZ11TdG9yYWdlKQoJdmFyIGN1cnJlbnRJRCBzdHJpbmcKCWZvciBfLCBsaW5lIDo9IHJhbmdlIHN0cmluZ3MuU3BsaXQoc3RyaW5nKGRhdGEpLCAiXG4iKSB7CgkJbGluZSA9IHN0cmluZ3MuVHJpbVNwYWNlKGxpbmUpCgkJaWYgc3RyaW5ncy5IYXNQcmVmaXgobGluZSwgImRpcjoiKSB8fCBzdHJpbmdzLkhhc1ByZWZpeChsaW5lLCAibmZzOiIpIHx8IHN0cmluZ3MuSGFzUHJlZml4KGxpbmUsICJjaWZzOiIpIHx8IHN0cmluZ3MuSGFzUHJlZml4KGxpbmUsICJsdm10aGluOiIpIHsKCQkJcGFydHMgOj0gc3RyaW5ncy5GaWVsZHMobGluZSkKCQkJaWYgbGVuKHBhcnRzKSA+PSAyIHsKCQkJCWN1cnJlbnRJRCA9IHBhcnRzWzFdCgkJCQlzdG9yYWdlc1tjdXJyZW50SURdID0gU3RvcmFnZXtJRDogY3VycmVudElELCBUeXBlOiBzdHJpbmdzLlRyaW1TdWZmaXgocGFydHNbMF0sICI6Iil9CgkJCX0KCQl9IGVsc2UgaWYgc3RyaW5ncy5IYXNQcmVmaXgobGluZSwgInBhdGggIikgJiYgY3VycmVudElEICE9ICIiIHsKCQkJcyA6PSBzdG9yYWdlc1tjdXJyZW50SURdCgkJCXMuUGF0aCA9IHN0cmluZ3MuVHJpbVNwYWNlKHN0cmluZ3MuVHJpbVByZWZpeChsaW5lLCAicGF0aCIpKQoJCQlzdG9yYWdlc1tjdXJyZW50SURdID0gcwoJCX0gZWxzZSBpZiBzdHJpbmdzLkhhc1ByZWZpeChsaW5lLCAidGhpbnBvb2wgIikgJiYgY3VycmVudElEICE9ICIiIHsKCQkJcyA6PSBzdG9yYWdlc1tjdXJyZW50SURdCgkJCWlmIHMuVHlwZSA9PSAibHZtdGhpbiIgewoJCQkJcy5QYXRoID0gImx2bXRoaW46IiArIHN0cmluZ3MuVHJpbVNwYWNlKHN0cmluZ3MuVHJpbVByZWZpeChsaW5lLCAidGhpbnBvb2wiKSkKCQkJfQoJCQlzdG9yYWdlc1tjdXJyZW50SURdID0gcwoJCX0gZWxzZSBpZiBzdHJpbmdzLkhhc1ByZWZpeChsaW5lLCAidmduYW1lICIpICYmIGN1cnJlbnRJRCAhPSAiIiB7CgkJCXMgOj0gc3RvcmFnZXNbY3VycmVudElEXQoJCQlpZiBzLlR5cGUgPT0gImx2bXRoaW4iICYmIHN0cmluZ3MuSGFzUHJlZml4KHMuUGF0aCwgImx2bXRoaW46IikgewoJCQkJdmduYW1lIDo9IHN0cmluZ3MuVHJpbVNwYWNlKHN0cmluZ3MuVHJpbVByZWZpeChsaW5lLCAidmduYW1lIikpCgkJCQl0aGlucG9vbCA6PSBzdHJpbmdzLlRyaW1QcmVmaXgocy5QYXRoLCAibHZtdGhpbjoiKQoJCQkJcy5QYXRoID0gImx2bXRoaW46IiArIHZnbmFtZSArICIvIiArIHRoaW5wb29sCgkJCX0KCQkJc3RvcmFnZXNbY3VycmVudElEXSA9IHMKCQl9Cgl9CglyZXR1cm4gc3RvcmFnZXMsIG5pbAp9CgpmdW5jIGhhbmRsZVN0b3JhZ2VzKHcgaHR0cC5SZXNwb25zZVdyaXRlciwgciAqaHR0cC5SZXF1ZXN0KSB7CglzdG9yYWdlcywgZXJyIDo9IHBhcnNlU3RvcmFnZXMoKQoJaWYgZXJyICE9IG5pbCB7CgkJaHR0cC5FcnJvcih3LCBlcnIuRXJyb3IoKSwgaHR0cC5TdGF0dXNJbnRlcm5hbFNlcnZlckVycm9yKQoJCXJldHVybgoJfQoJdmFyIGxpc3QgW11TdG9yYWdlCglmb3IgXywgcyA6PSByYW5nZSBzdG9yYWdlcyB7CgkJbGlzdCA9IGFwcGVuZChsaXN0LCBzKQoJfQoJanNvbi5OZXdFbmNvZGVyKHcpLkVuY29kZShsaXN0KQp9CgpmdW5jIGhhbmRsZUNvbnRlbnQodyBodHRwLlJlc3BvbnNlV3JpdGVyLCByICpodHRwLlJlcXVlc3QpIHsKCXN0b3JhZ2UgOj0gci5VUkwuUXVlcnkoKS5HZXQoInN0b3JhZ2UiKQoJY29udGVudFR5cGUgOj0gci5VUkwuUXVlcnkoKS5HZXQoInR5cGUiKQoJc3RvcmFnZXMsIGVyciA6PSBwYXJzZVN0b3JhZ2VzKCkKCWlmIGVyciAhPSBuaWwgewoJCWh0dHAuRXJyb3IodywgZXJyLkVycm9yKCksIGh0dHAuU3RhdHVzSW50ZXJuYWxTZXJ2ZXJFcnJvcikKCQlyZXR1cm4KCX0KCXN0LCBvayA6PSBzdG9yYWdlc1tzdG9yYWdlXQoJaWYgIW9rIHsKCQlodHRwLkVycm9yKHcsICJTdG9yYWdlIG5vdCBmb3VuZCIsIGh0dHAuU3RhdHVzTm90Rm91bmQpCgkJcmV0dXJuCgl9Cgl2YXIgc3ViZGlyIHN0cmluZwoJc3dpdGNoIGNvbnRlbnRUeXBlIHsKCWNhc2UgImlzbyI6CgkJc3ViZGlyID0gInRlbXBsYXRlL2lzbyIKCWNhc2UgInZ6dG1wbCI6CgkJc3ViZGlyID0gInRlbXBsYXRlL2NhY2hlIgoJY2FzZSAiYmFja3VwIjoKCQlzdWJkaXIgPSAiZHVtcCIKCWRlZmF1bHQ6CgkJaHR0cC5FcnJvcih3LCAiSW52YWxpZCB0eXBlIiwgaHR0cC5TdGF0dXNCYWRSZXF1ZXN0KQoJCXJldHVybgoJfQoJZGlyIDo9IGZpbGVwYXRoLkpvaW4oc3QuUGF0aCwgc3ViZGlyKQoJZW50cmllcywgZXJyIDo9IG9zLlJlYWREaXIoZGlyKQoJaWYgZXJyICE9IG5pbCB7CgkJanNvbi5OZXdFbmNvZGVyKHcpLkVuY29kZShtYXBbc3RyaW5nXWludGVyZmFjZXt9eyJpdGVtcyI6IFtdc3RyaW5ne319KQoJCXJldHVybgoJfQoJdmFyIGl0ZW1zIFtdbWFwW3N0cmluZ11pbnRlcmZhY2V7fQoJZm9yIF8sIGUgOj0gcmFuZ2UgZW50cmllcyB7CgkJaWYgZS5Jc0RpcigpIHsKCQkJY29udGludWUKCQl9CgkJaW5mbywgXyA6PSBlLkluZm8oKQoJCWl0ZW1zID0gYXBwZW5kKGl0ZW1zLCBtYXBbc3RyaW5nXWludGVyZmFjZXt9ewoJCQkibmFtZSI6ICAgICAgICAgICAgZS5OYW1lKCksCgkJCSJwYXRoIjogICAgICAgICAgICBmaWxlcGF0aC5Kb2luKGRpciwgZS5OYW1lKCkpLAoJCQkic2l6ZSI6ICAgICAgICAgICAgaW5mby5TaXplKCksCgkJCSJzaXplX2Zvcm1hdHRlZCI6ICBmbXQuU3ByaW50ZigiJS4yZiBHQiIsIGZsb2F0NjQoaW5mby5TaXplKCkpLzFlOSksCgkJCSJtdGltZV9mb3JtYXR0ZWQiOiBpbmZvLk1vZFRpbWUoKS5Gb3JtYXQoIjIwMDYtMDEtMDIgMTU6MDQ6MDUiKSwKCQkJInR5cGUiOiAgICAgICAgICAgIGNvbnRlbnRUeXBlLAoJCQkic3RvcmFnZSI6ICAgICAgICAgc3RvcmFnZSwKCQl9KQoJfQoJanNvbi5OZXdFbmNvZGVyKHcpLkVuY29kZShtYXBbc3RyaW5nXWludGVyZmFjZXt9eyJpdGVtcyI6IGl0ZW1zfSkKfQoKZnVuYyBoYW5kbGVKb2JzKHcgaHR0cC5SZXNwb25zZVdyaXRlciwgciAqaHR0cC5SZXF1ZXN0KSB7Cgl2YXIgcmVxIHN0cnVjdCB7CgkJT3AgICAgIHN0cmluZyAgICAgICAgICAgICAgICAgICBganNvbjoib3AiYAoJCUl0ZW1zICBbXW1hcFtzdHJpbmddaW50ZXJmYWNle30gYGpzb246Iml0ZW1zImAKCQlUYXJnZXQgc3RydWN0IHsKCQkJU3RvcmFnZSBzdHJpbmcgYGpzb246InN0b3JhZ2UiYAoJCQlEaXIgICAgIHN0cmluZyBganNvbjoiZGlyImAKCQl9IGBqc29uOiJ0YXJnZXQiYAoJfQoJaWYgZXJyIDo9IGpzb24uTmV3RGVjb2RlcihyLkJvZHkpLkRlY29kZSgmcmVxKTsgZXJyICE9IG5pbCB7CgkJaHR0cC5FcnJvcih3LCBlcnIuRXJyb3IoKSwgaHR0cC5TdGF0dXNCYWRSZXF1ZXN0KQoJCXJldHVybgoJfQoJam9iSUQgOj0gZm10LlNwcmludGYoImpvYi0lZCIsIHRpbWUuTm93KCkuVW5peE5hbm8oKSkKCXZhciB0b3RhbFNpemUgaW50NjQKCWZvciBfLCBpdGVtIDo9IHJhbmdlIHJlcS5JdGVtcyB7CgkJaWYgc2l6ZSwgb2sgOj0gaXRlbVsic2l6ZSJdLihmbG9hdDY0KTsgb2sgewoJCQl0b3RhbFNpemUgKz0gaW50NjQoc2l6ZSkKCQl9Cgl9Cglqb2IgOj0gJkpvYnsKCQlJRDogICAgIGpvYklELAoJCU9wOiAgICAgcmVxLk9wLAoJCVN0YXR1czogInJ1bm5pbmciLAoJCVRvdGFsOiAgdG90YWxTaXplLAoJfQoJam9iTXV0ZXguTG9jaygpCglqb2JzW2pvYklEXSA9IGpvYgoJam9iTXV0ZXguVW5sb2NrKCkKCWdvIGZ1bmMoKSB7CgkJc3RvcmFnZXMsIF8gOj0gcGFyc2VTdG9yYWdlcygpCgkJdGFyZ2V0U3QgOj0gc3RvcmFnZXNbcmVxLlRhcmdldC5TdG9yYWdlXQoJCXRhcmdldEJhc2UgOj0gZmlsZXBhdGguSm9pbih0YXJnZXRTdC5QYXRoLCByZXEuVGFyZ2V0LkRpcikKCQlmb3IgXywgaXRlbSA6PSByYW5nZSByZXEuSXRlbXMgewoJCQlzcmNQYXRoIDo9IGl0ZW1bInBhdGgiXS4oc3RyaW5nKQoJCQlmaWxlTmFtZSA6PSBmaWxlcGF0aC5CYXNlKHNyY1BhdGgpCgkJCWpvYi5tdS5Mb2NrKCkKCQkJam9iLkN1cnJlbnQgPSBmaWxlTmFtZQoJCQlqb2IubXUuVW5sb2NrKCkKCQkJc3dpdGNoIHJlcS5PcCB7CgkJCWNhc2UgImNvcHkiOgoJCQkJZHN0IDo9IGZpbGVwYXRoLkpvaW4odGFyZ2V0QmFzZSwgZmlsZU5hbWUpCgkJCQlpZiBlcnIgOj0gY29weUZpbGUoc3JjUGF0aCwgZHN0LCBqb2IpOyBlcnIgIT0gbmlsIHsKCQkJCQlqb2IubXUuTG9jaygpCgkJCQkJam9iLkZhaWxlZCA9IGFwcGVuZChqb2IuRmFpbGVkLCBmaWxlTmFtZSsiOiAiK2Vyci5FcnJvcigpKQoJCQkJCWpvYi5tdS5VbmxvY2soKQoJCQkJfQoJCQljYXNlICJtb3ZlIjoKCQkJCWRzdCA6PSBmaWxlcGF0aC5Kb2luKHRhcmdldEJhc2UsIGZpbGVOYW1lKQoJCQkJaWYgZXJyIDo9IG9zLlJlbmFtZShzcmNQYXRoLCBkc3QpOyBlcnIgIT0gbmlsIHsKCQkJCQlpZiBlcnIgOj0gY29weUZpbGUoc3JjUGF0aCwgZHN0LCBqb2IpOyBlcnIgIT0gbmlsIHsKCQkJCQkJam9iLm11LkxvY2soKQoJCQkJCQlqb2IuRmFpbGVkID0gYXBwZW5kKGpvYi5GYWlsZWQsIGZpbGVOYW1lKyI6ICIrZXJyLkVycm9yKCkpCgkJCQkJCWpvYi5tdS5VbmxvY2soKQoJCQkJCX0gZWxzZSB7CgkJCQkJCW9zLlJlbW92ZShzcmNQYXRoKQoJCQkJCX0KCQkJCX0gZWxzZSB7CgkJCQkJaWYgc2l6ZSwgb2sgOj0gaXRlbVsic2l6ZSJdLihmbG9hdDY0KTsgb2sgewoJCQkJCQlqb2IubXUuTG9jaygpCgkJCQkJCWpvYi5Qcm9ncmVzcyArPSBpbnQ2NChzaXplKQoJCQkJCQlqb2IubXUuVW5sb2NrKCkKCQkJCQl9CgkJCQl9CgkJCWNhc2UgImRlbGV0ZSI6CgkJCQlpZiBlcnIgOj0gb3MuUmVtb3ZlKHNyY1BhdGgpOyBlcnIgIT0gbmlsIHsKCQkJCQlqb2IubXUuTG9jaygpCgkJCQkJam9iLkZhaWxlZCA9IGFwcGVuZChqb2IuRmFpbGVkLCBmaWxlTmFtZSsiOiAiK2Vyci5FcnJvcigpKQoJCQkJCWpvYi5tdS5VbmxvY2soKQoJCQkJfSBlbHNlIHsKCQkJCQlpZiBzaXplLCBvayA6PSBpdGVtWyJzaXplIl0uKGZsb2F0NjQpOyBvayB7CgkJCQkJCWpvYi5tdS5Mb2NrKCkKCQkJCQkJam9iLlByb2dyZXNzICs9IGludDY0KHNpemUpCgkJCQkJCWpvYi5tdS5VbmxvY2soKQoJCQkJCX0KCQkJCX0KCQkJfQoJCX0KCQlqb2IubXUuTG9jaygpCgkJaWYgbGVuKGpvYi5GYWlsZWQpID4gMCB7CgkJCWpvYi5TdGF0dXMgPSAiZmFpbGVkIgoJCX0gZWxzZSB7CgkJCWpvYi5TdGF0dXMgPSAiY29tcGxldGVkIgoJCX0KCQlqb2IubXUuVW5sb2NrKCkKCX0oKQoJanNvbi5OZXdFbmNvZGVyKHcpLkVuY29kZShtYXBbc3RyaW5nXXN0cmluZ3siam9iX2lkIjogam9iSUR9KQp9CgpmdW5jIGNvcHlGaWxlKHNyYywgZHN0IHN0cmluZywgam9iICpKb2IpIGVycm9yIHsKCXNyY0ZpbGUsIGVyciA6PSBvcy5PcGVuKHNyYykKCWlmIGVyciAhPSBuaWwgewoJCXJldHVybiBlcnIKCX0KCWRlZmVyIHNyY0ZpbGUuQ2xvc2UoKQoJZHN0RmlsZSwgZXJyIDo9IG9zLkNyZWF0ZShkc3QpCglpZiBlcnIgIT0gbmlsIHsKCQlyZXR1cm4gZXJyCgl9CglkZWZlciBkc3RGaWxlLkNsb3NlKCkKCXByIDo9ICZQcm9ncmVzc1JlYWRlcntyOiBzcmNGaWxlLCBqb2I6IGpvYn0KCV8sIGVyciA9IGlvLkNvcHkoZHN0RmlsZSwgcHIpCglyZXR1cm4gZXJyCn0KCmZ1bmMgaGFuZGxlSm9iU3RhdHVzKHcgaHR0cC5SZXNwb25zZVdyaXRlciwgciAqaHR0cC5SZXF1ZXN0KSB7Cglqb2JJRCA6PSBzdHJpbmdzLlRyaW1QcmVmaXgoci5VUkwuUGF0aCwgIi9hcGkvam9icy8iKQoJam9iTXV0ZXguTG9jaygpCglqb2IsIG9rIDo9IGpvYnNbam9iSURdCglqb2JNdXRleC5VbmxvY2soKQoJaWYgIW9rIHsKCQlodHRwLkVycm9yKHcsICJKb2Igbm90IGZvdW5kIiwgaHR0cC5TdGF0dXNOb3RGb3VuZCkKCQlyZXR1cm4KCX0KCWpvYi5tdS5Mb2NrKCkKCWRlZmVyIGpvYi5tdS5VbmxvY2soKQoJanNvbi5OZXdFbmNvZGVyKHcpLkVuY29kZShtYXBbc3RyaW5nXWludGVyZmFjZXt9ewoJCSJzdGF0dXMiOiAgIGpvYi5TdGF0dXMsCgkJInByb2dyZXNzIjogam9iLlByb2dyZXNzLAoJCSJ0b3RhbCI6ICAgIGpvYi5Ub3RhbCwKCQkiY3VycmVudCI6ICBqb2IuQ3VycmVudCwKCQkiZmFpbGVkIjogICBqb2IuRmFpbGVkLAoJfSkKfQoKZnVuYyBoYW5kbGVVcGxvYWQodyBodHRwLlJlc3BvbnNlV3JpdGVyLCByICpodHRwLlJlcXVlc3QpIHsKCXIuUGFyc2VNdWx0aXBhcnRGb3JtKDEwIDw8IDMwKQoJZmlsZSwgaGVhZGVyLCBlcnIgOj0gci5Gb3JtRmlsZSgiZmlsZSIpCglpZiBlcnIgIT0gbmlsIHsKCQlodHRwLkVycm9yKHcsIGVyci5FcnJvcigpLCBodHRwLlN0YXR1c0JhZFJlcXVlc3QpCgkJcmV0dXJuCgl9CglkZWZlciBmaWxlLkNsb3NlKCkKCXN0b3JhZ2UgOj0gci5Gb3JtVmFsdWUoInN0b3JhZ2UiKQoJY29udGVudFR5cGUgOj0gci5Gb3JtVmFsdWUoInR5cGUiKQoJc3RvcmFnZXMsIF8gOj0gcGFyc2VTdG9yYWdlcygpCglzdCA6PSBzdG9yYWdlc1tzdG9yYWdlXQoJdmFyIHN1YmRpciBzdHJpbmcKCXN3aXRjaCBjb250ZW50VHlwZSB7CgljYXNlICJpc28iOgoJCXN1YmRpciA9ICJ0ZW1wbGF0ZS9pc28iCgljYXNlICJ2enRtcGwiOgoJCXN1YmRpciA9ICJ0ZW1wbGF0ZS9jYWNoZSIKCWNhc2UgImJhY2t1cCI6CgkJc3ViZGlyID0gImR1bXAiCgl9Cglkc3RQYXRoIDo9IGZpbGVwYXRoLkpvaW4oc3QuUGF0aCwgc3ViZGlyLCBoZWFkZXIuRmlsZW5hbWUpCglqb2JJRCA6PSBmbXQuU3ByaW50Zigiam9iLSVkIiwgdGltZS5Ob3coKS5Vbml4TmFubygpKQoJam9iIDo9ICZKb2J7CgkJSUQ6ICAgICAgam9iSUQsCgkJT3A6ICAgICAgInVwbG9hZCIsCgkJU3RhdHVzOiAgInJ1bm5pbmciLAoJCVRvdGFsOiAgIGhlYWRlci5TaXplLAoJCUN1cnJlbnQ6IGhlYWRlci5GaWxlbmFtZSwKCX0KCWpvYk11dGV4LkxvY2soKQoJam9ic1tqb2JJRF0gPSBqb2IKCWpvYk11dGV4LlVubG9jaygpCglnbyBmdW5jKCkgewoJCWRhdGEsIF8gOj0gaW8uUmVhZEFsbChmaWxlLihtdWx0aXBhcnQuRmlsZSkpCgkJZHN0RmlsZSwgZXJyIDo9IG9zLkNyZWF0ZShkc3RQYXRoKQoJCWlmIGVyciAhPSBuaWwgewoJCQlqb2IubXUuTG9jaygpCgkJCWpvYi5TdGF0dXMgPSAiZmFpbGVkIgoJCQlqb2IuRmFpbGVkID0gYXBwZW5kKGpvYi5GYWlsZWQsIGVyci5FcnJvcigpKQoJCQlqb2IubXUuVW5sb2NrKCkKCQkJcmV0dXJuCgkJfQoJCWRlZmVyIGRzdEZpbGUuQ2xvc2UoKQoJCWNodW5rU2l6ZSA6PSAxMDI0ICogMTAyNAoJCWZvciBpIDo9IDA7IGkgPCBsZW4oZGF0YSk7IGkgKz0gY2h1bmtTaXplIHsKCQkJZW5kIDo9IGkgKyBjaHVua1NpemUKCQkJaWYgZW5kID4gbGVuKGRhdGEpIHsKCQkJCWVuZCA9IGxlbihkYXRhKQoJCQl9CgkJCW4sIF8gOj0gZHN0RmlsZS5Xcml0ZShkYXRhW2k6ZW5kXSkKCQkJam9iLm11LkxvY2soKQoJCQlqb2IuUHJvZ3Jlc3MgKz0gaW50NjQobikKCQkJam9iLm11LlVubG9jaygpCgkJCXRpbWUuU2xlZXAoMTAgKiB0aW1lLk1pbGxpc2Vjb25kKQoJCX0KCQlqb2IubXUuTG9jaygpCgkJam9iLlN0YXR1cyA9ICJjb21wbGV0ZWQiCgkJam9iLm11LlVubG9jaygpCgl9KCkKCWpzb24uTmV3RW5jb2Rlcih3KS5FbmNvZGUobWFwW3N0cmluZ11zdHJpbmd7ImpvYl9pZCI6IGpvYklEfSkKfQpmdW5jIGhhbmRsZURvd25sb2FkKHcgaHR0cC5SZXNwb25zZVdyaXRlciwgciAqaHR0cC5SZXF1ZXN0KSB7CglwYXRoIDo9IHIuVVJMLlF1ZXJ5KCkuR2V0KCJwYXRoIikKCWlmIHBhdGggPT0gIiIgewoJCWh0dHAuRXJyb3IodywgIk1pc3NpbmcgcGF0aCIsIGh0dHAuU3RhdHVzQmFkUmVxdWVzdCkKCQlyZXR1cm4KCX0KCQoJZmlsZSwgZXJyIDo9IG9zLk9wZW4ocGF0aCkKCWlmIGVyciAhPSBuaWwgewoJCWh0dHAuRXJyb3IodywgZXJyLkVycm9yKCksIGh0dHAuU3RhdHVzTm90Rm91bmQpCgkJcmV0dXJuCgl9CglkZWZlciBmaWxlLkNsb3NlKCkKCQoJaW5mbywgXyA6PSBmaWxlLlN0YXQoKQoJdy5IZWFkZXIoKS5TZXQoIkNvbnRlbnQtRGlzcG9zaXRpb24iLCAiYXR0YWNobWVudDsgZmlsZW5hbWU9XCIiK2ZpbGVwYXRoLkJhc2UocGF0aCkrIlwiIikKCXcuSGVhZGVyKCkuU2V0KCJDb250ZW50LVR5cGUiLCAiYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtIikKCXcuSGVhZGVyKCkuU2V0KCJDb250ZW50LUxlbmd0aCIsIGZtdC5TcHJpbnRmKCIlZCIsIGluZm8uU2l6ZSgpKSkKCQoJaW8uQ29weSh3LCBmaWxlKQp9CgoKZnVuYyBtYWluKCkgewoJZGF0YSwgZXJyIDo9IG9zLlJlYWRGaWxlKCIvZXRjL3B4c3Rvci9jb25maWcueW1sIikKCWlmIGVyciAhPSBuaWwgewoJCWxvZy5GYXRhbChlcnIpCgl9CglpZiBlcnIgOj0geWFtbC5Vbm1hcnNoYWwoZGF0YSwgJmNvbmZpZyk7IGVyciAhPSBuaWwgewoJCWxvZy5GYXRhbChlcnIpCgl9CgltdXggOj0gaHR0cC5OZXdTZXJ2ZU11eCgpCgltdXguSGFuZGxlRnVuYygiL2FwaS9zdG9yYWdlcyIsIGF1dGhNaWRkbGV3YXJlKGhhbmRsZVN0b3JhZ2VzKSkKCW11eC5IYW5kbGVGdW5jKCIvYXBpL2NvbnRlbnQiLCBhdXRoTWlkZGxld2FyZShoYW5kbGVDb250ZW50KSkKCW11eC5IYW5kbGVGdW5jKCIvYXBpL2pvYnMiLCBhdXRoTWlkZGxld2FyZShoYW5kbGVKb2JzKSkKCW11eC5IYW5kbGVGdW5jKCIvYXBpL2pvYnMvIiwgYXV0aE1pZGRsZXdhcmUoaGFuZGxlSm9iU3RhdHVzKSkKCW11eC5IYW5kbGVGdW5jKCIvYXBpL3VwbG9hZCIsIGF1dGhNaWRkbGV3YXJlKGhhbmRsZVVwbG9hZCkpCgltdXguSGFuZGxlRnVuYygiL2FwaS9kb3dubG9hZCIsIGF1dGhNaWRkbGV3YXJlKGhhbmRsZURvd25sb2FkKSkKCW11eC5IYW5kbGVGdW5jKCIvYXBpL25vZGUiLCBhdXRoTWlkZGxld2FyZShoYW5kbGVOb2RlKSkKCW11eC5IYW5kbGVGdW5jKCIvYXBpL3N0YXRzIiwgYXV0aE1pZGRsZXdhcmUoaGFuZGxlU3RhdHMpKQoJbG9nLlByaW50bG4oIkFnZW50IGxpc3RlbmluZyBvbiA6ODA4NiIpCglsb2cuRmF0YWwoaHR0cC5MaXN0ZW5BbmRTZXJ2ZSgiOjgwODYiLCBjb3JzTWlkZGxld2FyZShtdXgpKSkKfQoKZnVuYyBoYW5kbGVOb2RlKHcgaHR0cC5SZXNwb25zZVdyaXRlciwgciAqaHR0cC5SZXF1ZXN0KSB7Cglob3N0bmFtZSwgXyA6PSBvcy5Ib3N0bmFtZSgpCglqc29uLk5ld0VuY29kZXIodykuRW5jb2RlKG1hcFtzdHJpbmddc3RyaW5neyJob3N0bmFtZSI6IGhvc3RuYW1lLCAiaXAiOiByLkhvc3R9KQp9CgpmdW5jIGhhbmRsZVN0YXRzKHcgaHR0cC5SZXNwb25zZVdyaXRlciwgciAqaHR0cC5SZXF1ZXN0KSB7CgkvLyBDUFUgdXNhZ2UgKGRlbHRhLWJhc2VkIGZvciByZWFsLXRpbWUpCgljcHVEYXRhLCBfIDo9IG9zLlJlYWRGaWxlKCIvcHJvYy9zdGF0IikKCWNwdUxpbmUgOj0gc3RyaW5ncy5TcGxpdChzdHJpbmcoY3B1RGF0YSksICJcbiIpWzBdCgljcHVGaWVsZHMgOj0gc3RyaW5ncy5GaWVsZHMoY3B1TGluZSkKCXZhciBjcHVUb3RhbCwgY3B1SWRsZSB1aW50NjQKCWZvciBpIDo9IDE7IGkgPCBsZW4oY3B1RmllbGRzKSAmJiBpIDw9IDg7IGkrKyB7CgkJdmFsLCBfIDo9IHN0cmNvbnYuUGFyc2VVaW50KGNwdUZpZWxkc1tpXSwgMTAsIDY0KQoJCWNwdVRvdGFsICs9IHZhbAoJCWlmIGkgPT0gNCB7CgkJCWNwdUlkbGUgPSB2YWwKCQl9Cgl9CgljcHVVc2FnZSA6PSAwLjAKCWNwdU11dGV4LkxvY2soKQoJaWYgbGFzdENQVVRvdGFsID4gMCB7CgkJZGVsdGFUb3RhbCA6PSBjcHVUb3RhbCAtIGxhc3RDUFVUb3RhbAoJCWRlbHRhSWRsZSA6PSBjcHVJZGxlIC0gbGFzdENQVUlkbGUKCQlpZiBkZWx0YVRvdGFsID4gMCB7CgkJCWNwdVVzYWdlID0gMTAwLjAgLSAoZmxvYXQ2NChkZWx0YUlkbGUpIC8gZmxvYXQ2NChkZWx0YVRvdGFsKSAqIDEwMC4wKQoJCX0KCX0KCWxhc3RDUFVUb3RhbCA9IGNwdVRvdGFsCglsYXN0Q1BVSWRsZSA9IGNwdUlkbGUKCWNwdU11dGV4LlVubG9jaygpCgkKCS8vIE1lbW9yeQoJbWVtRGF0YSwgXyA6PSBvcy5SZWFkRmlsZSgiL3Byb2MvbWVtaW5mbyIpCgl2YXIgbWVtVG90YWwsIG1lbUF2YWlsIHVpbnQ2NAoJZm9yIF8sIGxpbmUgOj0gcmFuZ2Ugc3RyaW5ncy5TcGxpdChzdHJpbmcobWVtRGF0YSksICJcbiIpIHsKCQlpZiBzdHJpbmdzLkhhc1ByZWZpeChsaW5lLCAiTWVtVG90YWw6IikgewoJCQlmbXQuU3NjYW5mKGxpbmUsICJNZW1Ub3RhbDogJWQga0IiLCAmbWVtVG90YWwpCgkJfQoJCWlmIHN0cmluZ3MuSGFzUHJlZml4KGxpbmUsICJNZW1BdmFpbGFibGU6IikgewoJCQlmbXQuU3NjYW5mKGxpbmUsICJNZW1BdmFpbGFibGU6ICVkIGtCIiwgJm1lbUF2YWlsKQoJCX0KCX0KCW1lbVVzZWQgOj0gbWVtVG90YWwgLSBtZW1BdmFpbAoJbWVtVXNhZ2UgOj0gZmxvYXQ2NCgwKQoJaWYgbWVtVG90YWwgPiAwIHsKCQltZW1Vc2FnZSA9IGZsb2F0NjQobWVtVXNlZCkgLyBmbG9hdDY0KG1lbVRvdGFsKSAqIDEwMC4wCgl9CgkKCS8vIFN0b3JhZ2UgKHN1bSBvZiBhbGwgY29uZmlndXJlZCBzdG9yYWdlcykKCXN0b3JhZ2VzLCBfIDo9IHBhcnNlU3RvcmFnZXMoKQoJdmFyIHRvdGFsU3RvcmFnZSwgdXNlZFN0b3JhZ2UgdWludDY0Cglmb3IgXywgc3QgOj0gcmFuZ2Ugc3RvcmFnZXMgewoJCWlmIHN0LlR5cGUgPT0gImx2bXRoaW4iICYmIHN0cmluZ3MuSGFzUHJlZml4KHN0LlBhdGgsICJsdm10aGluOiIpIHsKCQkJLy8gTFZNIHRoaW4gcG9vbDogcGFyc2UgdmcvdGhpbnBvb2wgZnJvbSBwYXRoCgkJCXBhcnRzIDo9IHN0cmluZ3MuU3BsaXQoc3RyaW5ncy5UcmltUHJlZml4KHN0LlBhdGgsICJsdm10aGluOiIpLCAiLyIpCgkJCWlmIGxlbihwYXJ0cykgPT0gMiB7CgkJCQlsdnNPdXRwdXQsIGVyciA6PSBleGVjLkNvbW1hbmQoImx2cyIsICItLW5vaGVhZGluZ3MiLCAiLS11bml0cyIsICJnIiwgIi1vIiwgImx2X3NpemUsZGF0YV9wZXJjZW50IiwgcGFydHNbMF0rIi8iK3BhcnRzWzFdKS5PdXRwdXQoKQoJCQkJaWYgZXJyID09IG5pbCB7CgkJCQkJZmllbGRzIDo9IHN0cmluZ3MuRmllbGRzKHN0cmluZyhsdnNPdXRwdXQpKQoJCQkJCWlmIGxlbihmaWVsZHMpID49IDIgewoJCQkJCQlzaXplU3RyIDo9IHN0cmluZ3MuVHJpbVN1ZmZpeChmaWVsZHNbMF0sICJnIikKCQkJCQkJc2l6ZSwgXyA6PSBzdHJjb252LlBhcnNlRmxvYXQoc2l6ZVN0ciwgNjQpCgkJCQkJCWRhdGFQZXJjZW50LCBfIDo9IHN0cmNvbnYuUGFyc2VGbG9hdChmaWVsZHNbMV0sIDY0KQoJCQkJCQl0b3RhbEJ5dGVzIDo9IHVpbnQ2NChzaXplICogMTAyNCAqIDEwMjQgKiAxMDI0KQoJCQkJCQl1c2VkQnl0ZXMgOj0gdWludDY0KChzaXplICogZGF0YVBlcmNlbnQgLyAxMDAuMCkgKiAxMDI0ICogMTAyNCAqIDEwMjQpCgkJCQkJCXRvdGFsU3RvcmFnZSArPSB0b3RhbEJ5dGVzCgkJCQkJCXVzZWRTdG9yYWdlICs9IHVzZWRCeXRlcwoJCQkJCX0KCQkJCX0KCQkJfQoJCX0gZWxzZSBpZiBzdC5QYXRoICE9ICIiIHsKCQkJdmFyIHN0YXQgc3lzY2FsbC5TdGF0ZnNfdAoJCQlpZiBlcnIgOj0gc3lzY2FsbC5TdGF0ZnMoc3QuUGF0aCwgJnN0YXQpOyBlcnIgPT0gbmlsIHsKCQkJCXRvdGFsIDo9IHN0YXQuQmxvY2tzICogdWludDY0KHN0YXQuQnNpemUpCgkJCQlmcmVlIDo9IHN0YXQuQmZyZWUgKiB1aW50NjQoc3RhdC5Cc2l6ZSkKCQkJCXRvdGFsU3RvcmFnZSArPSB0b3RhbAoJCQkJdXNlZFN0b3JhZ2UgKz0gKHRvdGFsIC0gZnJlZSkKCQkJfQoJCX0KCX0KCWRpc2tVc2FnZSA6PSBmbG9hdDY0KDApCglpZiB0b3RhbFN0b3JhZ2UgPiAwIHsKCQlkaXNrVXNhZ2UgPSBmbG9hdDY0KHVzZWRTdG9yYWdlKSAvIGZsb2F0NjQodG90YWxTdG9yYWdlKSAqIDEwMC4wCgl9CgkKCS8vIERldGVybWluZSB1bml0IGR5bmFtaWNhbGx5IGJhc2VkIG9uIHRvdGFsIHN0b3JhZ2Ugc2l6ZQoJdmFyIHN0b3JhZ2VVc2VkLCBzdG9yYWdlVG90YWwgZmxvYXQ2NAoJdmFyIHN0b3JhZ2VVbml0IHN0cmluZwoJdG90YWxUaUIgOj0gZmxvYXQ2NCh0b3RhbFN0b3JhZ2UpIC8gMTAyNCAvIDEwMjQgLyAxMDI0IC8gMTAyNAoJaWYgdG90YWxUaUIgPCAxLjAgewoJCXN0b3JhZ2VVc2VkID0gZmxvYXQ2NCh1c2VkU3RvcmFnZSkgLyAxMDI0IC8gMTAyNCAvIDEwMjQKCQlzdG9yYWdlVG90YWwgPSBmbG9hdDY0KHRvdGFsU3RvcmFnZSkgLyAxMDI0IC8gMTAyNCAvIDEwMjQKCQlzdG9yYWdlVW5pdCA9ICJHaUIiCgl9IGVsc2UgewoJCXN0b3JhZ2VVc2VkID0gZmxvYXQ2NCh1c2VkU3RvcmFnZSkgLyAxMDI0IC8gMTAyNCAvIDEwMjQgLyAxMDI0CgkJc3RvcmFnZVRvdGFsID0gdG90YWxUaUIKCQlzdG9yYWdlVW5pdCA9ICJUaUIiCgl9CgkKCWpzb24uTmV3RW5jb2Rlcih3KS5FbmNvZGUobWFwW3N0cmluZ11pbnRlcmZhY2V7fXsKCQkiY3B1IjogbWFwW3N0cmluZ11pbnRlcmZhY2V7fXsKCQkJInVzYWdlIjogZm10LlNwcmludGYoIiUuMGYlJSIsIGNwdVVzYWdlKSwKCQl9LAoJCSJtZW1vcnkiOiBtYXBbc3RyaW5nXWludGVyZmFjZXt9ewoJCQkidXNlZF9nYiI6IGZtdC5TcHJpbnRmKCIlLjJmIiwgZmxvYXQ2NChtZW1Vc2VkKS8xMDI0LzEwMjQpLAoJCQkidG90YWxfZ2IiOiBmbXQuU3ByaW50ZigiJS4yZiIsIGZsb2F0NjQobWVtVG90YWwpLzEwMjQvMTAyNCksCgkJCSJ1c2FnZSI6IGZtdC5TcHJpbnRmKCIlLjBmJSUiLCBtZW1Vc2FnZSksCgkJfSwKCQkic3RvcmFnZSI6IG1hcFtzdHJpbmddaW50ZXJmYWNle317CgkJCSJ1c2VkIjogZm10LlNwcmludGYoIiUuMmYiLCBzdG9yYWdlVXNlZCksCgkJCSJ0b3RhbCI6IGZtdC5TcHJpbnRmKCIlLjJmIiwgc3RvcmFnZVRvdGFsKSwKCQkJInVuaXQiOiBzdG9yYWdlVW5pdCwKCQkJInVzYWdlIjogZm10LlNwcmludGYoIiUuMGYlJSIsIGRpc2tVc2FnZSksCgkJfSwKCX0pCn0K" | base64 -d > /opt/pxstor/src/agent/main.go

# Coordinator
echo "cGFja2FnZSBtYWluCmltcG9ydCAoCgkibG9nIgoJIm5ldC9odHRwIgoJIm5ldC9odHRwL2h0dHB1dGlsIgoJIm5ldC91cmwiCikKCmZ1bmMgbWFpbigpIHsKCXRhcmdldCwgXyA6PSB1cmwuUGFyc2UoImh0dHA6Ly9sb2NhbGhvc3Q6ODA4NiIpCglwcm94eSA6PSBodHRwdXRpbC5OZXdTaW5nbGVIb3N0UmV2ZXJzZVByb3h5KHRhcmdldCkKCQoJaHR0cC5IYW5kbGVGdW5jKCIvYXBpLyIsIGZ1bmModyBodHRwLlJlc3BvbnNlV3JpdGVyLCByICpodHRwLlJlcXVlc3QpIHsKCQlwcm94eS5TZXJ2ZUhUVFAodywgcikKCX0pCgkKCWh0dHAuSGFuZGxlKCIvIiwgaHR0cC5GaWxlU2VydmVyKGh0dHAuRGlyKCIvb3B0L3B4c3Rvci91aSIpKSkKCQoJbG9nLlByaW50bG4oIkNvb3JkaW5hdG9yIGxpc3RlbmluZyBvbiA6ODA4NyIpCglsb2cuRmF0YWwoaHR0cC5MaXN0ZW5BbmRTZXJ2ZSgiOjgwODciLCBuaWwpKQp9Cg==" | base64 -d > /opt/pxstor/src/coordinator/main.go

# UI App
echo "aW1wb3J0IHsgdXNlU3RhdGUsIHVzZUVmZmVjdCwgdXNlUmVmIH0gZnJvbSAicmVhY3QiOwppbXBvcnQgIi4vQXBwLmNzcyI7Cgpjb25zdCBBUEkgPSAiaHR0cDovLyIgKyB3aW5kb3cubG9jYXRpb24uaG9zdG5hbWUgKyAiOjgwODYiOwpjb25zdCBUT0tFTiA9ICI5YWQzYmVjM2FhNWVlYTc4MTJmZjI2MWY3ODFhMDNhZDdlYjY4NzNlMDI1ZTY5MGUiOwoKZnVuY3Rpb24gQXBwKCkgewogIGNvbnN0IFtzdG9yYWdlcywgc2V0U3RvcmFnZXNdID0gdXNlU3RhdGUoW10pOwogIGNvbnN0IFtzZWxlY3RlZCwgc2V0U2VsZWN0ZWRdID0gdXNlU3RhdGUobnVsbCk7CiAgY29uc3QgW2NvbnRlbnQsIHNldENvbnRlbnRdID0gdXNlU3RhdGUoeyBpc286IFtdLCB2enRtcGw6IFtdLCBiYWNrdXA6IFtdIH0pOwogIGNvbnN0IFt0YWIsIHNldFRhYl0gPSB1c2VTdGF0ZSgiaXNvIik7CiAgY29uc3QgW2NoZWNrZWRJdGVtcywgc2V0Q2hlY2tlZEl0ZW1zXSA9IHVzZVN0YXRlKFtdKTsKICBjb25zdCBbZHJhd2VySXRlbSwgc2V0RHJhd2VySXRlbV0gPSB1c2VTdGF0ZShudWxsKTsKICBjb25zdCBbbW9kYWxPcCwgc2V0TW9kYWxPcF0gPSB1c2VTdGF0ZShudWxsKTsKICBjb25zdCBbbW9kYWxUYXJnZXQsIHNldE1vZGFsVGFyZ2V0XSA9IHVzZVN0YXRlKCIiKTsKICBjb25zdCBbcHJvZ3Jlc3MsIHNldFByb2dyZXNzXSA9IHVzZVN0YXRlKG51bGwpOwogIGNvbnN0IFtub2RlSW5mbywgc2V0Tm9kZUluZm9dID0gdXNlU3RhdGUobnVsbCk7CiAgY29uc3QgW3N0YXRzLCBzZXRTdGF0c10gPSB1c2VTdGF0ZShudWxsKTsKICBjb25zdCBbc2VhcmNoUXVlcnksIHNldFNlYXJjaFF1ZXJ5XSA9IHVzZVN0YXRlKCIiKTsKICBjb25zdCBbc29ydEJ5LCBzZXRTb3J0QnldID0gdXNlU3RhdGUoIm5hbWUiKTsKICBjb25zdCBbc29ydERpciwgc2V0U29ydERpcl0gPSB1c2VTdGF0ZSgiYXNjIik7CiAgY29uc3QgZmlsZUlucHV0UmVmID0gdXNlUmVmKG51bGwpOwoKICB1c2VFZmZlY3QoKCkgPT4gewogICAgZmV0Y2goQVBJICsgIi9hcGkvc3RvcmFnZXMiLCB7IGhlYWRlcnM6IHsgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiICsgVE9LRU4gfSB9KQogICAgICAudGhlbigocikgPT4gci5qc29uKCkpCiAgICAgIC50aGVuKHNldFN0b3JhZ2VzKQogICAgICAuY2F0Y2goY29uc29sZS5lcnJvcik7CgogICAgZmV0Y2goQVBJICsgIi9hcGkvbm9kZSIsIHsgaGVhZGVyczogeyBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIgKyBUT0tFTiB9IH0pCiAgICAgIC50aGVuKChyKSA9PiByLmpzb24oKSkKICAgICAgLnRoZW4oc2V0Tm9kZUluZm8pCiAgICAgIC5jYXRjaChjb25zb2xlLmVycm9yKTsKCiAgICBjb25zdCBsb2FkU3RhdHMgPSAoKSA9PiB7CiAgICAgIGZldGNoKEFQSSArICIvYXBpL3N0YXRzIiwgeyBoZWFkZXJzOiB7IEF1dGhvcml6YXRpb246ICJCZWFyZXIgIiArIFRPS0VOIH0gfSkKICAgICAgICAudGhlbigocikgPT4gci5qc29uKCkpCiAgICAgICAgLnRoZW4oc2V0U3RhdHMpCiAgICAgICAgLmNhdGNoKGNvbnNvbGUuZXJyb3IpOwogICAgfTsKICAgIGxvYWRTdGF0cygpOwogICAgY29uc3Qgc3RhdHNJbnRlcnZhbCA9IHNldEludGVydmFsKGxvYWRTdGF0cywgMjAwMCk7CiAgICByZXR1cm4gKCkgPT4gY2xlYXJJbnRlcnZhbChzdGF0c0ludGVydmFsKTsKICB9LCBbXSk7CgogIGNvbnN0IGxvYWRDb250ZW50ID0gKHN0KSA9PiB7CiAgICBzZXRTZWxlY3RlZChzdCk7CiAgICBzZXRDaGVja2VkSXRlbXMoW10pOwogICAgWyJpc28iLCAidnp0bXBsIiwgImJhY2t1cCJdLmZvckVhY2goKHQpID0+IHsKICAgICAgZmV0Y2goQVBJICsgIi9hcGkvY29udGVudD9zdG9yYWdlPSIgKyBzdC5JRCArICImdHlwZT0iICsgdCwgewogICAgICAgIGhlYWRlcnM6IHsgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiICsgVE9LRU4gfSwKICAgICAgfSkKICAgICAgICAudGhlbigocikgPT4gci5qc29uKCkpCiAgICAgICAgLnRoZW4oKGQpID0+IHNldENvbnRlbnQoKHByZXYpID0+ICh7IC4uLnByZXYsIFt0XTogZC5pdGVtcyB8fCBbXSB9KSkpCiAgICAgICAgLmNhdGNoKGNvbnNvbGUuZXJyb3IpOwogICAgfSk7CiAgfTsKCiAgY29uc3QgcmVmcmVzaENvbnRlbnQgPSAoKSA9PiB7CiAgICBpZiAoc2VsZWN0ZWQpIGxvYWRDb250ZW50KHNlbGVjdGVkKTsKICB9OwoKICBjb25zdCB0b2dnbGVDaGVjayA9IChpdGVtKSA9PiB7CiAgICBzZXRDaGVja2VkSXRlbXMoKHByZXYpID0+CiAgICAgIHByZXYuZmluZCgoeCkgPT4geC5wYXRoID09PSBpdGVtLnBhdGgpCiAgICAgICAgPyBwcmV2LmZpbHRlcigoeCkgPT4geC5wYXRoICE9PSBpdGVtLnBhdGgpCiAgICAgICAgOiBbLi4ucHJldiwgaXRlbV0KICAgICk7CiAgfTsKCiAgY29uc3QgZXhlY3V0ZU9wID0gYXN5bmMgKCkgPT4gewogICAgaWYgKCFtb2RhbE9wIHx8IGNoZWNrZWRJdGVtcy5sZW5ndGggPT09IDApIHJldHVybjsKCiAgICBjb25zdCBvcE5hbWUgPSBtb2RhbE9wOwogICAgY29uc3QgdGFyZ2V0U3RvcmFnZSA9IG1vZGFsVGFyZ2V0OwogICAgY29uc3QgdGFyZ2V0RGlyID0gdGFiID09PSAiaXNvIiA/ICJ0ZW1wbGF0ZS9pc28iIDogdGFiID09PSAidnp0bXBsIiA/ICJ0ZW1wbGF0ZS9jYWNoZSIgOiAiZHVtcCI7CgogICAgc2V0TW9kYWxPcChudWxsKTsKICAgIHNldE1vZGFsVGFyZ2V0KCIiKTsKCiAgICBjb25zdCBqb2JJdGVtcyA9IGNoZWNrZWRJdGVtcy5tYXAoKGl0KSA9PiAoeyBwYXRoOiBpdC5wYXRoLCBzaXplOiBpdC5zaXplIH0pKTsKCiAgICB0cnkgewogICAgICBjb25zdCByZXMgPSBhd2FpdCBmZXRjaChBUEkgKyAiL2FwaS9qb2JzIiwgewogICAgICAgIG1ldGhvZDogIlBPU1QiLAogICAgICAgIGhlYWRlcnM6IHsgIkNvbnRlbnQtVHlwZSI6ICJhcHBsaWNhdGlvbi9qc29uIiwgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiICsgVE9LRU4gfSwKICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7IG9wOiBvcE5hbWUsIGl0ZW1zOiBqb2JJdGVtcywgdGFyZ2V0OiB7IHN0b3JhZ2U6IHRhcmdldFN0b3JhZ2UsIGRpcjogdGFyZ2V0RGlyIH0gfSksCiAgICAgIH0pOwogICAgICBjb25zdCBkYXRhID0gYXdhaXQgcmVzLmpzb24oKTsKCiAgICAgIGlmIChkYXRhLmpvYl9pZCkgewogICAgICAgIHNldFByb2dyZXNzKHsgam9iSWQ6IGRhdGEuam9iX2lkLCBzdGF0dXM6ICJydW5uaW5nIiwgcHJvZ3Jlc3M6IDAsIHRvdGFsOiAxLCBjdXJyZW50OiAiU3RhcnRpbmcuLi4iLCBmYWlsZWQ6IFtdIH0pOwogICAgICAgIHBvbGxKb2IoZGF0YS5qb2JfaWQpOwogICAgICB9CiAgICB9IGNhdGNoIChlKSB7CiAgICAgIGFsZXJ0KCJFcnJvciBzdGFydGluZyBqb2I6ICIgKyAoZSBhcyBhbnkpLm1lc3NhZ2UpOwogICAgfQogIH07CgogIGNvbnN0IGhhbmRsZVVwbG9hZCA9IGFzeW5jIChlKSA9PiB7CiAgICBjb25zdCBmaWxlID0gKGUudGFyZ2V0IGFzIEhUTUxJbnB1dEVsZW1lbnQpLmZpbGVzPy5bMF07CiAgICBpZiAoIWZpbGUgfHwgIXNlbGVjdGVkKSByZXR1cm47CgogICAgc2V0UHJvZ3Jlc3MoeyBqb2JJZDogInVwbG9hZGluZyIsIHN0YXR1czogInVwbG9hZGluZyIsIHByb2dyZXNzOiAwLCB0b3RhbDogMCwgY3VycmVudDogIlVwbG9hZGluZyB0byBzZXJ2ZXIuLi4iLCBmYWlsZWQ6IFtdIH0pOwoKICAgIGNvbnN0IGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKCk7CiAgICBmb3JtRGF0YS5hcHBlbmQoImZpbGUiLCBmaWxlKTsKICAgIGZvcm1EYXRhLmFwcGVuZCgic3RvcmFnZSIsIChzZWxlY3RlZCBhcyBhbnkpPy5JRCk7CiAgICBmb3JtRGF0YS5hcHBlbmQoInR5cGUiLCB0YWIpOwoKICAgIHRyeSB7CiAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IGZldGNoKEFQSSArICIvYXBpL3VwbG9hZCIsIHsgbWV0aG9kOiAiUE9TVCIsIGhlYWRlcnM6IHsgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiICsgVE9LRU4gfSwgYm9keTogZm9ybURhdGEgfSk7CiAgICAgIGNvbnN0IGRhdGEgPSBhd2FpdCByZXMuanNvbigpOwogICAgICBpZiAoZGF0YS5qb2JfaWQpIHsKICAgICAgICBzZXRQcm9ncmVzcyh7IGpvYklkOiBkYXRhLmpvYl9pZCwgc3RhdHVzOiAicnVubmluZyIsIHByb2dyZXNzOiAwLCB0b3RhbDogZmlsZS5zaXplLCBjdXJyZW50OiBmaWxlLm5hbWUsIGZhaWxlZDogW10gfSk7CiAgICAgICAgcG9sbEpvYihkYXRhLmpvYl9pZCk7CiAgICAgIH0KICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgc2V0UHJvZ3Jlc3MobnVsbCk7CiAgICAgIGFsZXJ0KCJVcGxvYWQgZXJyb3I6ICIgKyAoZSBhcyBhbnkpLm1lc3NhZ2UpOwogICAgfQogICAgKGUudGFyZ2V0IGFzIEhUTUxJbnB1dEVsZW1lbnQpLnZhbHVlID0gIiI7CiAgfTsKCiAgY29uc3QgcG9sbEpvYiA9IChqb2JJZCkgPT4gewogICAgY29uc3QgaW50ZXJ2YWwgPSBzZXRJbnRlcnZhbChhc3luYyAoKSA9PiB7CiAgICAgIHRyeSB7CiAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgZmV0Y2goQVBJICsgIi9hcGkvam9icy8iICsgam9iSWQsIHsgaGVhZGVyczogeyBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIgKyBUT0tFTiB9IH0pOwogICAgICAgIGNvbnN0IGRhdGEgPSBhd2FpdCByZXMuanNvbigpOwogICAgICAgIHNldFByb2dyZXNzKHsgam9iSWQsIHN0YXR1czogZGF0YS5zdGF0dXMsIHByb2dyZXNzOiBkYXRhLnByb2dyZXNzLCB0b3RhbDogZGF0YS50b3RhbCwgY3VycmVudDogZGF0YS5jdXJyZW50IHx8ICIiLCBmYWlsZWQ6IGRhdGEuZmFpbGVkIHx8IFtdIH0pOwogICAgICAgIGlmIChkYXRhLnN0YXR1cyA9PT0gImNvbXBsZXRlZCIgfHwgZGF0YS5zdGF0dXMgPT09ICJmYWlsZWQiKSBjbGVhckludGVydmFsKGludGVydmFsKTsKICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgIGNvbnNvbGUuZXJyb3IoIlBvbGwgZXJyb3I6IiwgZSk7CiAgICAgICAgY2xlYXJJbnRlcnZhbChpbnRlcnZhbCk7CiAgICAgICAgc2V0UHJvZ3Jlc3MoKHByZXYpID0+IChwcmV2ID8geyAuLi5wcmV2LCBzdGF0dXM6ICJmYWlsZWQiLCBmYWlsZWQ6IFsiUHJvZ3Jlc3MgdHJhY2tpbmcgZXJyb3IiXSB9IDogbnVsbCkpOwogICAgICB9CiAgICB9LCA1MDApOwogIH07CgogIGNvbnN0IGNsb3NlUHJvZ3Jlc3MgPSAoKSA9PiB7CiAgICBzZXRQcm9ncmVzcyhudWxsKTsKICAgIGlmIChzZWxlY3RlZCkgbG9hZENvbnRlbnQoc2VsZWN0ZWQpOwogIH07CgogIGNvbnN0IGRvd25sb2FkRmlsZSA9IChpdGVtKSA9PiB7CiAgICBjb25zdCBsaW5rID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYSIpOwogICAgbGluay5ocmVmID0gQVBJICsgIi9hcGkvZG93bmxvYWQ/cGF0aD0iICsgZW5jb2RlVVJJQ29tcG9uZW50KGl0ZW0ucGF0aCkgKyAiJnRva2VuPSIgKyBUT0tFTjsKICAgIGxpbmsuZG93bmxvYWQgPSBpdGVtLm5hbWU7CiAgICBsaW5rLmNsaWNrKCk7CiAgfTsKCiAgY29uc3QgdG9nZ2xlU29ydCA9IChmaWVsZCkgPT4gewogICAgaWYgKHNvcnRCeSA9PT0gZmllbGQpIHNldFNvcnREaXIoc29ydERpciA9PT0gImFzYyIgPyAiZGVzYyIgOiAiYXNjIik7CiAgICBlbHNlIHsKICAgICAgc2V0U29ydEJ5KGZpZWxkKTsKICAgICAgc2V0U29ydERpcigiYXNjIik7CiAgICB9CiAgfTsKCiAgY29uc3Qgc29ydEl0ZW1zID0gKGFycikgPT4gewogICAgY29uc3QgaXRlbXMgPSBbLi4uYXJyXTsKICAgIHJldHVybiBpdGVtcy5zb3J0KChhLCBiKSA9PiB7CiAgICAgIGxldCB2YWxBOiBhbnksIHZhbEI6IGFueTsKICAgICAgaWYgKHNvcnRCeSA9PT0gIm5hbWUiKSB7CiAgICAgICAgdmFsQSA9IGEubmFtZS50b0xvd2VyQ2FzZSgpOwogICAgICAgIHZhbEIgPSBiLm5hbWUudG9Mb3dlckNhc2UoKTsKICAgICAgfSBlbHNlIGlmIChzb3J0QnkgPT09ICJzaXplIikgewogICAgICAgIHZhbEEgPSBhLnNpemU7CiAgICAgICAgdmFsQiA9IGIuc2l6ZTsKICAgICAgfSBlbHNlIHsKICAgICAgICB2YWxBID0gbmV3IERhdGUoYS5tdGltZV9mb3JtYXR0ZWQpLmdldFRpbWUoKTsKICAgICAgICB2YWxCID0gbmV3IERhdGUoYi5tdGltZV9mb3JtYXR0ZWQpLmdldFRpbWUoKTsKICAgICAgfQogICAgICBpZiAodmFsQSA8IHZhbEIpIHJldHVybiBzb3J0RGlyID09PSAiYXNjIiA/IC0xIDogMTsKICAgICAgaWYgKHZhbEEgPiB2YWxCKSByZXR1cm4gc29ydERpciA9PT0gImFzYyIgPyAxIDogLTE7CiAgICAgIHJldHVybiAwOwogICAgfSk7CiAgfTsKCiAgY29uc3QgaXRlbXMgPSBzb3J0SXRlbXMoKGNvbnRlbnQgYXMgYW55KVt0YWJdIHx8IFtdKS5maWx0ZXIoKGl0OiBhbnkpID0+IGl0Lm5hbWUudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhzZWFyY2hRdWVyeS50b0xvd2VyQ2FzZSgpKSk7CiAgY29uc3QgcHJvZ3Jlc3NQZXJjZW50ID0gcHJvZ3Jlc3MgJiYgcHJvZ3Jlc3MudG90YWwgPiAwID8gKHByb2dyZXNzLnByb2dyZXNzIC8gcHJvZ3Jlc3MudG90YWwpICogMTAwIDogMDsKICBjb25zdCBpc0RvbmUgPSBwcm9ncmVzcyAmJiAocHJvZ3Jlc3Muc3RhdHVzID09PSAiY29tcGxldGVkIiB8fCBwcm9ncmVzcy5zdGF0dXMgPT09ICJmYWlsZWQiKTsKICBjb25zdCBpc1VwbG9hZGluZyA9IHByb2dyZXNzICYmIHByb2dyZXNzLnN0YXR1cyA9PT0gInVwbG9hZGluZyI7CgogIGNvbnN0IHNvcnRJbmRpY2F0b3IgPSAoZmllbGQ6IHN0cmluZykgPT4gKHNvcnRCeSA9PT0gZmllbGQgPyAoc29ydERpciA9PT0gImFzYyIgPyAiIF4iIDogIiB2IikgOiAiIik7CgogIHJldHVybiAoCiAgICA8ZGl2IHN0eWxlPXt7IGRpc3BsYXk6ICJmbGV4IiwgaGVpZ2h0OiAiMTAwdmgiLCBmb250RmFtaWx5OiAiJ1NlZ29lIFVJJywgVGFob21hLCBHZW5ldmEsIFZlcmRhbmEsIHNhbnMtc2VyaWYiLCBiYWNrZ3JvdW5kOiAiI2ZhZjdmMiIgfX0+CiAgICAgIDxkaXYgc3R5bGU9e3sgd2lkdGg6IDI4MCwgYmFja2dyb3VuZDogImxpbmVhci1ncmFkaWVudCgxODBkZWcsICMyZDJkMmQgMCUsICMzZDNkM2QgMTAwJSkiLCBjb2xvcjogIiNmZmYiLCBwYWRkaW5nOiAiMjRweCAxNnB4Iiwgb3ZlcmZsb3dZOiAiYXV0byIsIGJveFNoYWRvdzogIjRweCAwIDIwcHggcmdiYSgwLDAsMCwwLjE1KSIsIGJvcmRlclJpZ2h0OiAiMXB4IHNvbGlkIHJnYmEoMjI5LCAxMTIsIDAsIDAuMSkiIH19PgogICAgICAgIDxoMiBzdHlsZT17eyBtYXJnaW46ICIwIDAgMjBweCAwIiwgZm9udFNpemU6IDE2LCBmb250V2VpZ2h0OiA2MDAsIGxldHRlclNwYWNpbmc6ICIxcHgiLCB0ZXh0VHJhbnNmb3JtOiAidXBwZXJjYXNlIiwgb3BhY2l0eTogMC45LCBib3JkZXJCb3R0b206ICIycHggc29saWQgcmdiYSgyMjksIDExMiwgMCwgMC4zKSIsIHBhZGRpbmdCb3R0b206IDEyIH19PlN0b3JhZ2VzPC9oMj4KICAgICAgICB7c3RvcmFnZXMubWFwKChzOiBhbnkpID0+ICgKICAgICAgICAgIDxkaXYga2V5PXtzLklEfSBvbkNsaWNrPXsoKSA9PiBsb2FkQ29udGVudChzKX0KICAgICAgICAgICAgc3R5bGU9e3sgcGFkZGluZzogIjE0cHggMTZweCIsIGN1cnNvcjogInBvaW50ZXIiLCBiYWNrZ3JvdW5kOiBzZWxlY3RlZD8uSUQgPT09IHMuSUQgPyAicmdiYSgyMjksIDExMiwgMCwgMC4xNSkiIDogInRyYW5zcGFyZW50IiwgYm9yZGVyUmFkaXVzOiAxMCwgbWFyZ2luQm90dG9tOiAxMCwgdHJhbnNpdGlvbjogImFsbCAwLjNzIGN1YmljLWJlemllcigwLjQsIDAsIDAuMiwgMSkiLCBib3JkZXI6IHNlbGVjdGVkPy5JRCA9PT0gcy5JRCA/ICIycHggc29saWQgI0U1NzAwMCIgOiAiMnB4IHNvbGlkIHRyYW5zcGFyZW50IiwgdHJhbnNmb3JtOiBzZWxlY3RlZD8uSUQgPT09IHMuSUQgPyAidHJhbnNsYXRlWCg0cHgpIiA6ICJ0cmFuc2xhdGVYKDApIiwgYm94U2hhZG93OiBzZWxlY3RlZD8uSUQgPT09IHMuSUQgPyAiMCA0cHggMTJweCByZ2JhKDIyOSwgMTEyLCAwLCAwLjIpIiA6ICJub25lIiB9fQogICAgICAgICAgPgogICAgICAgICAgICA8ZGl2IHN0eWxlPXt7IGZvbnRXZWlnaHQ6IDYwMCwgZm9udFNpemU6IDE0IH19PntzLklEfTwvZGl2PgogICAgICAgICAgICA8ZGl2IHN0eWxlPXt7IGZvbnRTaXplOiAxMSwgb3BhY2l0eTogMC43LCBtYXJnaW5Ub3A6IDQgfX0+e3MudHlwZX08L2Rpdj4KICAgICAgICAgIDwvZGl2PgogICAgICAgICkpfQogICAgICA8L2Rpdj4KICAgICAgPGRpdiBzdHlsZT17eyBmbGV4OiAxLCBkaXNwbGF5OiAiZmxleCIsIGZsZXhEaXJlY3Rpb246ICJjb2x1bW4iLCBtYXJnaW5SaWdodDogZHJhd2VySXRlbSA/IDQyMCA6IDAsIHRyYW5zaXRpb246ICJtYXJnaW4tcmlnaHQgMC40cyBjdWJpYy1iZXppZXIoMC40LCAwLCAwLjIsIDEpIiB9fT4KICAgICAgICA8ZGl2IHN0eWxlPXt7IGJhY2tncm91bmQ6ICJsaW5lYXItZ3JhZGllbnQoMTM1ZGVnLCAjRTU3MDAwIDAlLCAjZmY4YzFhIDEwMCUpIiwgcGFkZGluZzogIjIwcHggMzJweCIsIGJveFNoYWRvdzogIjAgMnB4IDhweCByZ2JhKDAsMCwwLDAuMDYpIiB9fT4KICAgICAgICAgIDxkaXYgc3R5bGU9e3sgZGlzcGxheTogImZsZXgiLCBhbGlnbkl0ZW1zOiAiY2VudGVyIiwgZ2FwOiAxNiB9fT4KICAgICAgICAgICAgPGltZyBzcmM9Ii9wcm94bW94LWxvZ28uc3ZnIiBhbHQ9IlByb3htb3giIHN0eWxlPXt7IGhlaWdodDogNTAgfX0gLz4KICAgICAgICAgICAgPGgxIHN0eWxlPXt7IG1hcmdpbjogMCwgZm9udFNpemU6IDI4LCBmb250V2VpZ2h0OiA2MDAsIGNvbG9yOiAiI2ZmZiIsIGxldHRlclNwYWNpbmc6ICIwLjNweCIgfX0+UHJveG1veCBTdG9yYWdlIE1hbmFnZW1lbnQ8L2gxPgogICAgICAgICAgPC9kaXY+CiAgICAgICAgICA8ZGl2IHN0eWxlPXt7IGRpc3BsYXk6ICJmbGV4IiwgYWxpZ25JdGVtczogImNlbnRlciIsIGdhcDogMzIsIG1hcmdpblRvcDogOCB9fT4KICAgICAgICAgICAge25vZGVJbmZvICYmIDxkaXYgc3R5bGU9e3sgZm9udFNpemU6IDE0LCBvcGFjaXR5OiAwLjksIGZvbnRXZWlnaHQ6IDQwMCB9fT5Db25uZWN0ZWQgdG8ge3dpbmRvdy5sb2NhdGlvbi5ob3N0bmFtZX0gKHsobm9kZUluZm8gYXMgYW55KS5ob3N0bmFtZX0pPC9kaXY+fQogICAgICAgICAgICB7c3RhdHMgJiYgKAogICAgICAgICAgICAgIDxkaXYgc3R5bGU9e3sgZGlzcGxheTogImZsZXgiLCBnYXA6IDI0LCBmb250U2l6ZTogMTMsIG9wYWNpdHk6IDAuOTUgfX0+CiAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXt7IGRpc3BsYXk6ICJmbGV4IiwgYWxpZ25JdGVtczogImNlbnRlciIsIGdhcDogOCB9fT48ZGl2IHN0eWxlPXt7IGZvbnRXZWlnaHQ6IDYwMCB9fT5DUFU6PC9kaXY+PGRpdj57KHN0YXRzIGFzIGFueSkuY3B1LnVzYWdlfTwvZGl2PjwvZGl2PgogICAgICAgICAgICAgICAgPGRpdiBzdHlsZT17eyBkaXNwbGF5OiAiZmxleCIsIGFsaWduSXRlbXM6ICJjZW50ZXIiLCBnYXA6IDggfX0+PGRpdiBzdHlsZT17eyBmb250V2VpZ2h0OiA2MDAgfX0+TWVtb3J5OjwvZGl2PjxkaXY+eyhzdGF0cyBhcyBhbnkpLm1lbW9yeS51c2VkX2difSBHQiAvIHsoc3RhdHMgYXMgYW55KS5tZW1vcnkudG90YWxfZ2J9IEdCICh7KHN0YXRzIGFzIGFueSkubWVtb3J5LnVzYWdlfSk8L2Rpdj48L2Rpdj4KICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9e3sgZGlzcGxheTogImZsZXgiLCBhbGlnbkl0ZW1zOiAiY2VudGVyIiwgZ2FwOiA4IH19PjxkaXYgc3R5bGU9e3sgZm9udFdlaWdodDogNjAwIH19PlN0b3JhZ2U6PC9kaXY+PGRpdj57KHN0YXRzIGFzIGFueSkuc3RvcmFnZS51c2VkfSB7KHN0YXRzIGFzIGFueSkuc3RvcmFnZS51bml0fSAvIHsoc3RhdHMgYXMgYW55KS5zdG9yYWdlLnRvdGFsfSB7KHN0YXRzIGFzIGFueSkuc3RvcmFnZS51bml0fSAoeyhzdGF0cyBhcyBhbnkpLnN0b3JhZ2UudXNhZ2V9KTwvZGl2PjwvZGl2PgogICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICApfQogICAgICAgICAgPC9kaXY+CiAgICAgICAgPC9kaXY+CiAgICAgICAge3NlbGVjdGVkICYmICgKICAgICAgICAgIDxkaXYgc3R5bGU9e3sgZGlzcGxheTogImZsZXgiLCBmbGV4RGlyZWN0aW9uOiAiY29sdW1uIiwgZmxleDogMSB9fT4KICAgICAgICAgICAgPGRpdiBzdHlsZT17eyBkaXNwbGF5OiAiZmxleCIsIGdhcDogMTIsIHBhZGRpbmc6ICIxNnB4IDMycHgiLCBiYWNrZ3JvdW5kOiAiI2ZmZiIsIGJvcmRlckJvdHRvbTogIjFweCBzb2xpZCAjZTllY2VmIiB9fT4KICAgICAgICAgICAgICB7WyJpc28iLCAidnp0bXBsIiwgImJhY2t1cCJdLm1hcCgodCkgPT4gKAogICAgICAgICAgICAgICAgPGJ1dHRvbiBrZXk9e3R9IG9uQ2xpY2s9eygpID0+IHNldFRhYih0KX0KICAgICAgICAgICAgICAgICAgc3R5bGU9e3sgcGFkZGluZzogIjEwcHggMjBweCIsIGJvcmRlcjogIm5vbmUiLCBiYWNrZ3JvdW5kOiB0YWIgPT09IHQgPyAiI0U1NzAwMCIgOiAiI2Y1ZjBlOCIsIGNvbG9yOiB0YWIgPT09IHQgPyAiIzAwMCIgOiAiIzJjM2U1MCIsIGJvcmRlclJhZGl1czogOCwgY3Vyc29yOiAicG9pbnRlciIsIGZvbnRXZWlnaHQ6IDYwMCwgZm9udFNpemU6IDEzLCB0cmFuc2l0aW9uOiAiYWxsIDAuM3MgZWFzZSIsIHRleHRUcmFuc2Zvcm06ICJ1cHBlcmNhc2UiLCBsZXR0ZXJTcGFjaW5nOiAiMC41cHgiIH19CiAgICAgICAgICAgICAgICA+CiAgICAgICAgICAgICAgICAgIHt0ID09PSAidnp0bXBsIiA/ICJUZW1wbGF0ZXMiIDogdC50b1VwcGVyQ2FzZSgpfQogICAgICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgICAgICAgKSl9CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8ZGl2IHN0eWxlPXt7IHBhZGRpbmc6ICIxMnB4IDMycHgiLCBiYWNrZ3JvdW5kOiAiI2ZmZiIsIGJvcmRlckJvdHRvbTogIjFweCBzb2xpZCAjZTllY2VmIiwgZGlzcGxheTogImZsZXgiLCBnYXA6IDEyLCBhbGlnbkl0ZW1zOiAiY2VudGVyIiB9fT4KICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0idGV4dCIgcGxhY2Vob2xkZXI9IlNlYXJjaCBmaWxlcy4uLiIgdmFsdWU9e3NlYXJjaFF1ZXJ5fSBvbkNoYW5nZT17KGUpID0+IHNldFNlYXJjaFF1ZXJ5KChlLnRhcmdldCBhcyBIVE1MSW5wdXRFbGVtZW50KS52YWx1ZSl9CiAgICAgICAgICAgICAgICBzdHlsZT17eyBmbGV4OiAxLCBwYWRkaW5nOiAiMTBweCAxNHB4IiwgYm9yZGVyOiAiMnB4IHNvbGlkICNlOWVjZWYiLCBib3JkZXJSYWRpdXM6IDgsIGZvbnRTaXplOiAxNCB9fSAvPgogICAgICAgICAgICAgIDxidXR0b24gb25DbGljaz17cmVmcmVzaENvbnRlbnR9IHN0eWxlPXt7IHBhZGRpbmc6ICIxMHB4IDE2cHgiLCBib3JkZXI6ICJub25lIiwgYmFja2dyb3VuZDogIiNmZjhjMWEiLCBjb2xvcjogIiNmZmYiLCBib3JkZXJSYWRpdXM6IDgsIGN1cnNvcjogInBvaW50ZXIiLCBmb250V2VpZ2h0OiA2MDAsIGZvbnRTaXplOiAxMywgdHJhbnNpdGlvbjogInRyYW5zZm9ybSAwLjJzIGVhc2UiIH19CiAgICAgICAgICAgICAgICBvbk1vdXNlRW50ZXI9eyhlKSA9PiAoKGUuY3VycmVudFRhcmdldCBhcyBIVE1MQnV0dG9uRWxlbWVudCkuc3R5bGUudHJhbnNmb3JtID0gInRyYW5zbGF0ZVkoLTJweCkiKX0KICAgICAgICAgICAgICAgIG9uTW91c2VMZWF2ZT17KGUpID0+ICgoZS5jdXJyZW50VGFyZ2V0IGFzIEhUTUxCdXR0b25FbGVtZW50KS5zdHlsZS50cmFuc2Zvcm0gPSAidHJhbnNsYXRlWSgwKSIpfQogICAgICAgICAgICAgID4KICAgICAgICAgICAgICAgIFJlZnJlc2gKICAgICAgICAgICAgICA8L2J1dHRvbj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDxkaXYgc3R5bGU9e3sgcGFkZGluZzogIjE2cHggMzJweCIsIGJhY2tncm91bmQ6ICIjZmZmIiwgYm9yZGVyQm90dG9tOiAiMXB4IHNvbGlkICNlOWVjZWYiLCBkaXNwbGF5OiAiZmxleCIsIGdhcDogMTIsIGFsaWduSXRlbXM6ICJjZW50ZXIiIH19PgogICAgICAgICAgICAgIDxpbnB1dCByZWY9e2ZpbGVJbnB1dFJlZn0gdHlwZT0iZmlsZSIgb25DaGFuZ2U9e2hhbmRsZVVwbG9hZH0gc3R5bGU9e3sgZGlzcGxheTogIm5vbmUiIH19IC8+CiAgICAgICAgICAgICAgPGJ1dHRvbiBvbkNsaWNrPXsoKSA9PiAoZmlsZUlucHV0UmVmLmN1cnJlbnQgYXMgYW55KT8uY2xpY2soKX0gc3R5bGU9e3sgcGFkZGluZzogIjhweCAxOHB4IiwgYm9yZGVyOiAibm9uZSIsIGJhY2tncm91bmQ6ICIjRTU3MDAwIiwgY29sb3I6ICIjZmZmIiwgYm9yZGVyUmFkaXVzOiA4LCBjdXJzb3I6ICJwb2ludGVyIiwgZm9udFdlaWdodDogNjAwLCBmb250U2l6ZTogMTMsIHRyYW5zaXRpb246ICJ0cmFuc2Zvcm0gMC4ycyBlYXNlIiwgbGV0dGVyU3BhY2luZzogIjAuM3B4IiB9fQogICAgICAgICAgICAgICAgb25Nb3VzZUVudGVyPXsoZSkgPT4gKChlLmN1cnJlbnRUYXJnZXQgYXMgSFRNTEJ1dHRvbkVsZW1lbnQpLnN0eWxlLnRyYW5zZm9ybSA9ICJ0cmFuc2xhdGVZKC0ycHgpIil9CiAgICAgICAgICAgICAgICBvbk1vdXNlTGVhdmU9eyhlKSA9PiAoKGUuY3VycmVudFRhcmdldCBhcyBIVE1MQnV0dG9uRWxlbWVudCkuc3R5bGUudHJhbnNmb3JtID0gInRyYW5zbGF0ZVkoMCkiKX0KICAgICAgICAgICAgICA+CiAgICAgICAgICAgICAgICBVcGxvYWQgRmlsZQogICAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgICAgICAgIDxzcGFuIHN0eWxlPXt7IGZvbnRTaXplOiAxMywgY29sb3I6ICIjMmMzZTUwIiwgZm9udFdlaWdodDogNTAwIH19PnRvIHsoc2VsZWN0ZWQgYXMgYW55KT8uSUR9IC8ge3RhYn08L3NwYW4+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICB7Y2hlY2tlZEl0ZW1zLmxlbmd0aCA+IDAgJiYgKAogICAgICAgICAgICAgIDxkaXYgc3R5bGU9e3sgcGFkZGluZzogIjE0cHggMzJweCIsIGJhY2tncm91bmQ6ICIjZmZmNGU2IiwgYm9yZGVyQm90dG9tOiAiMXB4IHNvbGlkICNlOWVjZWYiLCBkaXNwbGF5OiAiZmxleCIsIGdhcDogMTIsIGFsaWduSXRlbXM6ICJjZW50ZXIiLCBhbmltYXRpb246ICJzbGlkZURvd24gMC4zcyBlYXNlIiB9fT4KICAgICAgICAgICAgICAgIDxzcGFuIHN0eWxlPXt7IGZvbnRXZWlnaHQ6IDYwMCwgZm9udFNpemU6IDEzLCBjb2xvcjogIiNFNTcwMDAiIH19PntjaGVja2VkSXRlbXMubGVuZ3RofSBzZWxlY3RlZDwvc3Bhbj4KICAgICAgICAgICAgICAgIDxidXR0b24gb25DbGljaz17KCkgPT4geyBzZXRNb2RhbE9wKCJjb3B5Iik7IHNldE1vZGFsVGFyZ2V0KCgoc3RvcmFnZXMgYXMgYW55KVswXT8uSUQgPz8gKHNlbGVjdGVkIGFzIGFueSk/LklEID8/ICIiKSk7IH19IHN0eWxlPXt7IHBhZGRpbmc6ICI2cHggMTRweCIsIGJvcmRlcjogIm5vbmUiLCBiYWNrZ3JvdW5kOiAiI0U1NzAwMCIsIGNvbG9yOiAiI2ZmZiIsIGJvcmRlclJhZGl1czogNiwgY3Vyc29yOiAicG9pbnRlciIsIGZvbnRXZWlnaHQ6IDYwMCwgZm9udFNpemU6IDEyLCB0cmFuc2l0aW9uOiAiYWxsIDAuMnMgZWFzZSIgfX0+Q29weTwvYnV0dG9uPgogICAgICAgICAgICAgICAgPGJ1dHRvbiBvbkNsaWNrPXsoKSA9PiB7IHNldE1vZGFsT3AoIm1vdmUiKTsgc2V0TW9kYWxUYXJnZXQoKChzdG9yYWdlcyBhcyBhbnkpWzBdPy5JRCA/PyAoc2VsZWN0ZWQgYXMgYW55KT8uSUQgPz8gIiIpKTsgfX0gc3R5bGU9e3sgcGFkZGluZzogIjZweCAxNHB4IiwgYm9yZGVyOiAibm9uZSIsIGJhY2tncm91bmQ6ICIjZmY4YzFhIiwgY29sb3I6ICIjZmZmIiwgYm9yZGVyUmFkaXVzOiA2LCBjdXJzb3I6ICJwb2ludGVyIiwgZm9udFdlaWdodDogNjAwLCBmb250U2l6ZTogMTIsIHRyYW5zaXRpb246ICJhbGwgMC4ycyBlYXNlIiB9fT5Nb3ZlPC9idXR0b24+CiAgICAgICAgICAgICAgICA8YnV0dG9uIG9uQ2xpY2s9eygpID0+IHNldE1vZGFsT3AoImRlbGV0ZSIpfSBzdHlsZT17eyBwYWRkaW5nOiAiNnB4IDE0cHgiLCBib3JkZXI6ICJub25lIiwgYmFja2dyb3VuZDogIiNmZjRkNGYiLCBjb2xvcjogIiNmZmYiLCBib3JkZXJSYWRpdXM6IDYsIGN1cnNvcjogInBvaW50ZXIiLCBmb250V2VpZ2h0OiA2MDAsIGZvbnRTaXplOiAxMiwgdHJhbnNpdGlvbjogImFsbCAwLjJzIGVhc2UiIH19PkRlbGV0ZTwvYnV0dG9uPgogICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICApfQogICAgICAgICAgICA8ZGl2IHN0eWxlPXt7IGZsZXg6IDEsIG92ZXJmbG93OiAiYXV0byIsIHBhZGRpbmc6IDMyLCBiYWNrZ3JvdW5kOiAiI2ZhZjdmMiIgfX0+CiAgICAgICAgICAgICAgPGRpdiBzdHlsZT17eyBiYWNrZ3JvdW5kOiAiI2ZmZiIsIGJvcmRlclJhZGl1czogMTIsIG92ZXJmbG93OiAiaGlkZGVuIiwgYm94U2hhZG93OiAiMCAycHggMTJweCByZ2JhKDAsMCwwLDAuMDQpIiB9fT4KICAgICAgICAgICAgICAgIDx0YWJsZSBzdHlsZT17eyB3aWR0aDogIjEwMCUiLCBib3JkZXJDb2xsYXBzZTogImNvbGxhcHNlIiB9fT4KICAgICAgICAgICAgICAgICAgPHRoZWFkPgogICAgICAgICAgICAgICAgICAgIDx0ciBzdHlsZT17eyBiYWNrZ3JvdW5kOiAibGluZWFyLWdyYWRpZW50KDEzNWRlZywgI0U1NzAwMCAwJSwgI2ZmOGMxYSAxMDAlKSIsIGNvbG9yOiAiI2ZmZiIgfX0+CiAgICAgICAgICAgICAgICAgICAgICA8dGggc3R5bGU9e3sgcGFkZGluZzogMTQsIHRleHRBbGlnbjogImxlZnQiLCB3aWR0aDogNDAsIGZvbnRXZWlnaHQ6IDYwMCwgZm9udFNpemU6IDEyIH19PjwvdGg+CiAgICAgICAgICAgICAgICAgICAgICA8dGggb25DbGljaz17KCkgPT4gdG9nZ2xlU29ydCgibmFtZSIpfSBzdHlsZT17eyBwYWRkaW5nOiAxNCwgdGV4dEFsaWduOiAibGVmdCIsIGZvbnRXZWlnaHQ6IDYwMCwgZm9udFNpemU6IDEyLCBsZXR0ZXJTcGFjaW5nOiAiMC41cHgiLCBjdXJzb3I6ICJwb2ludGVyIiwgdXNlclNlbGVjdDogIm5vbmUiIH19PgogICAgICAgICAgICAgICAgICAgICAgICBOQU1Fe3NvcnRJbmRpY2F0b3IoIm5hbWUiKX0KICAgICAgICAgICAgICAgICAgICAgIDwvdGg+CiAgICAgICAgICAgICAgICAgICAgICA8dGggc3R5bGU9e3sgcGFkZGluZzogMTQsIHRleHRBbGlnbjogImxlZnQiLCBmb250V2VpZ2h0OiA2MDAsIGZvbnRTaXplOiAxMiwgbGV0dGVyU3BhY2luZzogIjAuNXB4IiB9fT5UWVBFPC90aD4KICAgICAgICAgICAgICAgICAgICAgIDx0aCBvbkNsaWNrPXsoKSA9PiB0b2dnbGVTb3J0KCJzaXplIil9IHN0eWxlPXt7IHBhZGRpbmc6IDE0LCB0ZXh0QWxpZ246ICJsZWZ0IiwgZm9udFdlaWdodDogNjAwLCBmb250U2l6ZTogMTIsIGxldHRlclNwYWNpbmc6ICIwLjVweCIsIGN1cnNvcjogInBvaW50ZXIiLCB1c2VyU2VsZWN0OiAibm9uZSIgfX0+CiAgICAgICAgICAgICAgICAgICAgICAgIFNJWkV7c29ydEluZGljYXRvcigic2l6ZSIpfQogICAgICAgICAgICAgICAgICAgICAgPC90aD4KICAgICAgICAgICAgICAgICAgICAgIDx0aCBvbkNsaWNrPXsoKSA9PiB0b2dnbGVTb3J0KCJtdGltZSIpfSBzdHlsZT17eyBwYWRkaW5nOiAxNCwgdGV4dEFsaWduOiAibGVmdCIsIGZvbnRXZWlnaHQ6IDYwMCwgZm9udFNpemU6IDEyLCBsZXR0ZXJTcGFjaW5nOiAiMC41cHgiLCBjdXJzb3I6ICJwb2ludGVyIiwgdXNlclNlbGVjdDogIm5vbmUiIH19PgogICAgICAgICAgICAgICAgICAgICAgICBNT0RJRklFRHtzb3J0SW5kaWNhdG9yKCJtdGltZSIpfQogICAgICAgICAgICAgICAgICAgICAgPC90aD4KICAgICAgICAgICAgICAgICAgICAgIDx0aCBzdHlsZT17eyBwYWRkaW5nOiAxNCwgdGV4dEFsaWduOiAiY2VudGVyIiwgZm9udFdlaWdodDogNjAwLCBmb250U2l6ZTogMTIsIGxldHRlclNwYWNpbmc6ICIwLjVweCIsIHdpZHRoOiAxMjAgfX0+QUNUSU9OUzwvdGg+CiAgICAgICAgICAgICAgICAgICAgPC90cj4KICAgICAgICAgICAgICAgICAgPC90aGVhZD4KICAgICAgICAgICAgICAgICAgPHRib2R5PgogICAgICAgICAgICAgICAgICAgIHtpdGVtcy5tYXAoKGl0OiBhbnksIGlkeDogbnVtYmVyKSA9PiAoCiAgICAgICAgICAgICAgICAgICAgICA8dHIga2V5PXtpdC5wYXRofSBzdHlsZT17eyBib3JkZXJCb3R0b206ICIxcHggc29saWQgI2YxZjNmNSIsIGN1cnNvcjogInBvaW50ZXIiLCB0cmFuc2l0aW9uOiAiYmFja2dyb3VuZCAwLjJzIGVhc2UiLCBhbmltYXRpb246ICJmYWRlSW4gMC4zcyBlYXNlICIgKyBpZHggKiAwLjA1ICsgInMgYm90aCIgfX0KICAgICAgICAgICAgICAgICAgICAgICAgb25DbGljaz17KCkgPT4gc2V0RHJhd2VySXRlbShpdCl9CiAgICAgICAgICAgICAgICAgICAgICAgIG9uTW91c2VFbnRlcj17KGUpID0+ICgoZS5jdXJyZW50VGFyZ2V0IGFzIEhUTUxUYWJsZVJvd0VsZW1lbnQpLnN0eWxlLmJhY2tncm91bmQgPSAiI2ZhZjdmMiIpfQogICAgICAgICAgICAgICAgICAgICAgICBvbk1vdXNlTGVhdmU9eyhlKSA9PiAoKGUuY3VycmVudFRhcmdldCBhcyBIVE1MVGFibGVSb3dFbGVtZW50KS5zdHlsZS5iYWNrZ3JvdW5kID0gInRyYW5zcGFyZW50Iil9CiAgICAgICAgICAgICAgICAgICAgICA+CiAgICAgICAgICAgICAgICAgICAgICAgIDx0ZCBzdHlsZT17eyBwYWRkaW5nOiAxMiB9fSBvbkNsaWNrPXsoZSkgPT4gZS5zdG9wUHJvcGFnYXRpb24oKX0+CiAgICAgICAgICAgICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9ImNoZWNrYm94IiBjaGVja2VkPXshIShjaGVja2VkSXRlbXMgYXMgYW55KS5maW5kKCh4OiBhbnkpID0+IHgucGF0aCA9PT0gaXQucGF0aCl9IG9uQ2hhbmdlPXsoKSA9PiB0b2dnbGVDaGVjayhpdCl9IHN0eWxlPXt7IGN1cnNvcjogInBvaW50ZXIiLCB3aWR0aDogMTYsIGhlaWdodDogMTYgfX0gLz4KICAgICAgICAgICAgICAgICAgICAgICAgPC90ZD4KICAgICAgICAgICAgICAgICAgICAgICAgPHRkIHN0eWxlPXt7IHBhZGRpbmc6IDEyLCBmb250U2l6ZTogMTMsIGZvbnRXZWlnaHQ6IDUwMCwgY29sb3I6ICIjMmMzZTUwIiB9fT57aXQubmFtZX08L3RkPgogICAgICAgICAgICAgICAgICAgICAgICA8dGQgc3R5bGU9e3sgcGFkZGluZzogMTIsIGZvbnRTaXplOiAxMiwgY29sb3I6ICIjMzQ0OTVlIiB9fT57aXQudHlwZX08L3RkPgogICAgICAgICAgICAgICAgICAgICAgICA8dGQgc3R5bGU9e3sgcGFkZGluZzogMTIsIGZvbnRTaXplOiAxMiwgY29sb3I6ICIjMzQ0OTVlIiB9fT57aXQuc2l6ZV9mb3JtYXR0ZWR9PC90ZD4KICAgICAgICAgICAgICAgICAgICAgICAgPHRkIHN0eWxlPXt7IHBhZGRpbmc6IDEyLCBmb250U2l6ZTogMTIsIGNvbG9yOiAiIzM0NDk1ZSIgfX0+e2l0Lm10aW1lX2Zvcm1hdHRlZH08L3RkPgogICAgICAgICAgICAgICAgICAgICAgICA8dGQgc3R5bGU9e3sgcGFkZGluZzogMTIsIHRleHRBbGlnbjogImNlbnRlciIgfX0gb25DbGljaz17KGUpID0+IGUuc3RvcFByb3BhZ2F0aW9uKCl9PgogICAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gb25DbGljaz17KCkgPT4gZG93bmxvYWRGaWxlKGl0KX0gc3R5bGU9e3sgcGFkZGluZzogIjZweCAxMnB4IiwgYm9yZGVyOiAibm9uZSIsIGJhY2tncm91bmQ6ICIjZmY4YzFhIiwgY29sb3I6ICIjZmZmIiwgYm9yZGVyUmFkaXVzOiA2LCBjdXJzb3I6ICJwb2ludGVyIiwgZm9udFNpemU6IDExLCBmb250V2VpZ2h0OiA2MDAgfX0+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBEb3dubG9hZAogICAgICAgICAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgICAgICAgICAgICAgICAgICA8L3RkPgogICAgICAgICAgICAgICAgICAgICAgPC90cj4KICAgICAgICAgICAgICAgICAgICApKX0KICAgICAgICAgICAgICAgICAgPC90Ym9keT4KICAgICAgICAgICAgICAgIDwvdGFibGU+CiAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgPC9kaXY+CiAgICAgICAgKX0KICAgICAgPC9kaXY+CiAgICAgIHtkcmF3ZXJJdGVtICYmICgKICAgICAgICA8ZGl2IHN0eWxlPXt7IHBvc2l0aW9uOiAiZml4ZWQiLCByaWdodDogMCwgdG9wOiAwLCBib3R0b206IDAsIHdpZHRoOiA0MjAsIGJhY2tncm91bmQ6ICIjZmZmIiwgYm94U2hhZG93OiAiLTRweCAwIDIwcHggcmdiYSgwLDAsMCwwLjEpIiwgcGFkZGluZzogMzIsIG92ZXJmbG93WTogImF1dG8iLCB6SW5kZXg6IDEwMDAsIGFuaW1hdGlvbjogInNsaWRlSW5SaWdodCAwLjNzIGVhc2UiIH19PgogICAgICAgICAgPGRpdiBzdHlsZT17eyBkaXNwbGF5OiAiZmxleCIsIGp1c3RpZnlDb250ZW50OiAic3BhY2UtYmV0d2VlbiIsIGFsaWduSXRlbXM6ICJjZW50ZXIiLCBtYXJnaW5Cb3R0b206IDI4IH19PgogICAgICAgICAgICA8aDIgc3R5bGU9e3sgbWFyZ2luOiAwLCBmb250U2l6ZTogMjIsIGZvbnRXZWlnaHQ6IDYwMCwgY29sb3I6ICIjMmMzZTUwIiB9fT5GaWxlIERldGFpbHM8L2gyPgogICAgICAgICAgICA8YnV0dG9uIG9uQ2xpY2s9eygpID0+IHNldERyYXdlckl0ZW0obnVsbCl9IHN0eWxlPXt7IGJvcmRlcjogIm5vbmUiLCBiYWNrZ3JvdW5kOiAibm9uZSIsIGZvbnRTaXplOiAyMCwgY3Vyc29yOiAicG9pbnRlciIsIGNvbG9yOiAiI2FkYjViZCIsIHRyYW5zaXRpb246ICJjb2xvciAwLjJzIiB9fQogICAgICAgICAgICAgIG9uTW91c2VFbnRlcj17KGUpID0+ICgoZS5jdXJyZW50VGFyZ2V0IGFzIEhUTUxCdXR0b25FbGVtZW50KS5zdHlsZS5jb2xvciA9ICIjMmMzZTUwIil9CiAgICAgICAgICAgICAgb25Nb3VzZUxlYXZlPXsoZSkgPT4gKChlLmN1cnJlbnRUYXJnZXQgYXMgSFRNTEJ1dHRvbkVsZW1lbnQpLnN0eWxlLmNvbG9yID0gIiNhZGI1YmQiKX0KICAgICAgICAgICAgPlg8L2J1dHRvbj4KICAgICAgICAgIDwvZGl2PgogICAgICAgICAgPGRpdiBzdHlsZT17eyBkaXNwbGF5OiAiZmxleCIsIGZsZXhEaXJlY3Rpb246ICJjb2x1bW4iLCBnYXA6IDIwIH19PgogICAgICAgICAgICA8ZGl2IHN0eWxlPXt7IHBhZGRpbmc6IDE2LCBiYWNrZ3JvdW5kOiAiI2ZhZjdmMiIsIGJvcmRlclJhZGl1czogOCwgYm9yZGVyTGVmdDogIjRweCBzb2xpZCAjRTU3MDAwIiB9fT4KICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXt7IGZvbnRTaXplOiAxMSwgZm9udFdlaWdodDogNjAwLCBjb2xvcjogIiNhZGI1YmQiLCBtYXJnaW5Cb3R0b206IDYsIHRleHRUcmFuc2Zvcm06ICJ1cHBlcmNhc2UiLCBsZXR0ZXJTcGFjaW5nOiAiMC41cHgiIH19Pk5hbWU8L2Rpdj4KICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXt7IGZvbnRTaXplOiAxNCwgZm9udFdlaWdodDogNTAwLCBjb2xvcjogIiMyYzNlNTAiLCB3b3JkQnJlYWs6ICJicmVhay1hbGwiIH19PnsoZHJhd2VySXRlbSBhcyBhbnkpLm5hbWV9PC9kaXY+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8ZGl2IHN0eWxlPXt7IHBhZGRpbmc6IDE2LCBiYWNrZ3JvdW5kOiAiI2ZhZjdmMiIsIGJvcmRlclJhZGl1czogOCwgYm9yZGVyTGVmdDogIjRweCBzb2xpZCAjZjBlNmQ2IiB9fT4KICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXt7IGZvbnRTaXplOiAxMSwgZm9udFdlaWdodDogNjAwLCBjb2xvcjogIiNhZGI1YmQiLCBtYXJnaW5Cb3R0b206IDYsIHRleHRUcmFuc2Zvcm06ICJ1cHBlcmNhc2UiLCBsZXR0ZXJTcGFjaW5nOiAiMC41cHgiIH19PlR5cGU8L2Rpdj4KICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXt7IGZvbnRTaXplOiAxNCwgZm9udFdlaWdodDogNTAwLCBjb2xvcjogIiMyYzNlNTAiIH19PnsoZHJhd2VySXRlbSBhcyBhbnkpLnR5cGV9PC9kaXY+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8ZGl2IHN0eWxlPXt7IHBhZGRpbmc6IDE2LCBiYWNrZ3JvdW5kOiAiI2ZhZjdmMiIsIGJvcmRlclJhZGl1czogOCwgYm9yZGVyTGVmdDogIjRweCBzb2xpZCAjRTU3MDAwIiB9fT4KICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXt7IGZvbnRTaXplOiAxMSwgZm9udFdlaWdodDogNjAwLCBjb2xvcjogIiNhZGI1YmQiLCBtYXJnaW5Cb3R0b206IDYsIHRleHRUcmFuc2Zvcm06ICJ1cHBlcmNhc2UiLCBsZXR0ZXJTcGFjaW5nOiAiMC41cHgiIH19PlNpemU8L2Rpdj4KICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXt7IGZvbnRTaXplOiAxNCwgZm9udFdlaWdodDogNTAwLCBjb2xvcjogIiMyYzNlNTAiIH19PnsoZHJhd2VySXRlbSBhcyBhbnkpLnNpemVfZm9ybWF0dGVkfTwvZGl2PgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPGRpdiBzdHlsZT17eyBwYWRkaW5nOiAxNiwgYmFja2dyb3VuZDogIiNmYWY3ZjIiLCBib3JkZXJSYWRpdXM6IDgsIGJvcmRlckxlZnQ6ICI0cHggc29saWQgI2YwZTZkNiIgfX0+CiAgICAgICAgICAgICAgPGRpdiBzdHlsZT17eyBmb250U2l6ZTogMTEsIGZvbnRXZWlnaHQ6IDYwMCwgY29sb3I6ICIjYWRiNWJkIiwgbWFyZ2luQm90dG9tOiA2LCB0ZXh0VHJhbnNmb3JtOiAidXBwZXJjYXNlIiwgbGV0dGVyU3BhY2luZzogIjAuNXB4IiB9fT5Nb2RpZmllZDwvZGl2PgogICAgICAgICAgICAgIDxkaXYgc3R5bGU9e3sgZm9udFNpemU6IDE0LCBmb250V2VpZ2h0OiA1MDAsIGNvbG9yOiAiIzJjM2U1MCIgfX0+eyhkcmF3ZXJJdGVtIGFzIGFueSkubXRpbWVfZm9ybWF0dGVkfTwvZGl2PgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPGRpdiBzdHlsZT17eyBwYWRkaW5nOiAxNiwgYmFja2dyb3VuZDogIiNmYWY3ZjIiLCBib3JkZXJSYWRpdXM6IDgsIGJvcmRlckxlZnQ6ICI0cHggc29saWQgI0U1NzAwMCIgfX0+CiAgICAgICAgICAgICAgPGRpdiBzdHlsZT17eyBmb250U2l6ZTogMTEsIGZvbnRXZWlnaHQ6IDYwMCwgY29sb3I6ICIjYWRiNWJkIiwgbWFyZ2luQm90dG9tOiA2LCB0ZXh0VHJhbnNmb3JtOiAidXBwZXJjYXNlIiwgbGV0dGVyU3BhY2luZzogIjAuNXB4IiB9fT5QYXRoPC9kaXY+CiAgICAgICAgICAgICAgPGRpdiBzdHlsZT17eyBmb250U2l6ZTogMTMsIGZvbnRXZWlnaHQ6IDQwMCwgY29sb3I6ICIjMzQ0OTVlIiwgd29yZEJyZWFrOiAiYnJlYWstYWxsIiwgZm9udEZhbWlseTogIm1vbm9zcGFjZSIgfX0+eyhkcmF3ZXJJdGVtIGFzIGFueSkucGF0aH08L2Rpdj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDxkaXYgc3R5bGU9e3sgcGFkZGluZzogMTYsIGJhY2tncm91bmQ6ICIjZmFmN2YyIiwgYm9yZGVyUmFkaXVzOiA4LCBib3JkZXJMZWZ0OiAiNHB4IHNvbGlkICNmMGU2ZDYiIH19PgogICAgICAgICAgICAgIDxkaXYgc3R5bGU9e3sgZm9udFNpemU6IDExLCBmb250V2VpZ2h0OiA2MDAsIGNvbG9yOiAiI2FkYjViZCIsIG1hcmdpbkJvdHRvbTogNiwgdGV4dFRyYW5zZm9ybTogInVwcGVyY2FzZSIsIGxldHRlclNwYWNpbmc6ICIwLjVweCIgfX0+U3RvcmFnZTwvZGl2PgogICAgICAgICAgICAgIDxkaXYgc3R5bGU9e3sgZm9udFNpemU6IDE0LCBmb250V2VpZ2h0OiA1MDAsIGNvbG9yOiAiIzJjM2U1MCIgfX0+eyhkcmF3ZXJJdGVtIGFzIGFueSkuc3RvcmFnZX08L2Rpdj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICA8L2Rpdj4KICAgICAgICA8L2Rpdj4KICAgICAgKX0KCiAgICAgIHttb2RhbE9wICYmICgKICAgICAgICA8ZGl2IHN0eWxlPXt7IHBvc2l0aW9uOiAiZml4ZWQiLCBpbnNldDogMCwgYmFja2dyb3VuZDogInJnYmEoMCwwLDAsMC41KSIsIGRpc3BsYXk6ICJmbGV4IiwgYWxpZ25JdGVtczogImNlbnRlciIsIGp1c3RpZnlDb250ZW50OiAiY2VudGVyIiwgekluZGV4OiAyMDAwLCBiYWNrZHJvcEZpbHRlcjogImJsdXIoNHB4KSIgfX0+CiAgICAgICAgICA8ZGl2IHN0eWxlPXt7IGJhY2tncm91bmQ6ICIjZmZmIiwgcGFkZGluZzogMzYsIGJvcmRlclJhZGl1czogMTYsIG1pbldpZHRoOiA0NDAsIGJveFNoYWRvdzogIjAgMjBweCA2MHB4IHJnYmEoMCwwLDAsMC4zKSIgfX0+CiAgICAgICAgICAgIDxoMiBzdHlsZT17eyBtYXJnaW46ICIwIDAgMjRweCAwIiwgZm9udFNpemU6IDIyLCBmb250V2VpZ2h0OiA2MDAsIGNvbG9yOiAiIzJjM2U1MCIgfX0+e21vZGFsT3AgPT09ICJkZWxldGUiID8gIkRlbGV0ZSBGaWxlcyIgOiBtb2RhbE9wID09PSAiY29weSIgPyAiQ29weSBGaWxlcyIgOiAiTW92ZSBGaWxlcyJ9PC9oMj4KICAgICAgICAgICAge21vZGFsT3AgIT09ICJkZWxldGUiICYmICgKICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXt7IG1hcmdpbkJvdHRvbTogMjQgfX0+CiAgICAgICAgICAgICAgICA8bGFiZWwgc3R5bGU9e3sgZGlzcGxheTogImJsb2NrIiwgbWFyZ2luQm90dG9tOiAxMCwgZm9udFNpemU6IDEzLCBmb250V2VpZ2h0OiA2MDAsIGNvbG9yOiAiIzM0NDk1ZSIgfX0+VGFyZ2V0IFN0b3JhZ2U6PC9sYWJlbD4KICAgICAgICAgICAgICAgIDxzZWxlY3QgdmFsdWU9e21vZGFsVGFyZ2V0fSBvbkNoYW5nZT17KGUpID0+IHNldE1vZGFsVGFyZ2V0KChlLnRhcmdldCBhcyBIVE1MU2VsZWN0RWxlbWVudCkudmFsdWUpfSBzdHlsZT17eyB3aWR0aDogIjEwMCUiLCBwYWRkaW5nOiAiMTBweCAxMnB4IiwgYm9yZGVyOiAiMnB4IHNvbGlkICNlOWVjZWYiLCBib3JkZXJSYWRpdXM6IDgsIGZvbnRTaXplOiAxNCB9fT4KICAgICAgICAgICAgICAgICAge3N0b3JhZ2VzLm1hcCgoczogYW55KSA9PiAoCiAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiBrZXk9e3MuSUR9IHZhbHVlPXtzLklEfT57cy5JRH08L29wdGlvbj4KICAgICAgICAgICAgICAgICAgKSl9CiAgICAgICAgICAgICAgICA8L3NlbGVjdD4KICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgKX0KICAgICAgICAgICAgPGRpdiBzdHlsZT17eyBkaXNwbGF5OiAiZmxleCIsIGdhcDogMTIsIGp1c3RpZnlDb250ZW50OiAiZmxleC1lbmQiIH19PgogICAgICAgICAgICAgIDxidXR0b24gb25DbGljaz17ZXhlY3V0ZU9wfSBzdHlsZT17eyBwYWRkaW5nOiAiMTBweCAyNHB4IiwgYm9yZGVyOiAibm9uZSIsIGJhY2tncm91bmQ6ICIjRTU3MDAwIiwgY29sb3I6ICIjZmZmIiwgYm9yZGVyUmFkaXVzOiA4LCBjdXJzb3I6ICJwb2ludGVyIiwgZm9udFdlaWdodDogNjAwLCBmb250U2l6ZTogMTQgfX0+RXhlY3V0ZTwvYnV0dG9uPgogICAgICAgICAgICAgIDxidXR0b24gb25DbGljaz17KCkgPT4geyBzZXRNb2RhbE9wKG51bGwpOyBzZXRNb2RhbFRhcmdldCgiIik7IH19IHN0eWxlPXt7IHBhZGRpbmc6ICIxMHB4IDI0cHgiLCBib3JkZXI6ICIycHggc29saWQgI2U5ZWNlZiIsIGJhY2tncm91bmQ6ICIjZmZmIiwgYm9yZGVyUmFkaXVzOiA4LCBjdXJzb3I6ICJwb2ludGVyIiwgZm9udFdlaWdodDogNjAwLCBmb250U2l6ZTogMTQsIGNvbG9yOiAiIzM0NDk1ZSIgfX0+Q2FuY2VsPC9idXR0b24+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgPC9kaXY+CiAgICAgICAgPC9kaXY+CiAgICAgICl9CgogICAgICB7cHJvZ3Jlc3MgJiYgKAogICAgICAgIDxkaXYgc3R5bGU9e3sgcG9zaXRpb246ICJmaXhlZCIsIGluc2V0OiAwLCBiYWNrZ3JvdW5kOiAicmdiYSgwLDAsMCwwLjYpIiwgZGlzcGxheTogImZsZXgiLCBhbGlnbkl0ZW1zOiAiY2VudGVyIiwganVzdGlmeUNvbnRlbnQ6ICJjZW50ZXIiLCB6SW5kZXg6IDMwMDAsIGJhY2tkcm9wRmlsdGVyOiAiYmx1cig2cHgpIiwgYW5pbWF0aW9uOiAiZmFkZUluIDAuMnMgZWFzZSIgfX0+CiAgICAgICAgICA8ZGl2IHN0eWxlPXt7IGJhY2tncm91bmQ6ICIjZmZmIiwgcGFkZGluZzogNDQsIGJvcmRlclJhZGl1czogMjAsIG1pbldpZHRoOiA1NDAsIGJveFNoYWRvdzogIjAgMjVweCA4MHB4IHJnYmEoMCwwLDAsMC40KSIsIGFuaW1hdGlvbjogInNjYWxlSW4gMC4zcyBlYXNlIiB9fT4KICAgICAgICAgICAgPGgyIHN0eWxlPXt7IG1hcmdpbjogMCwgbWFyZ2luQm90dG9tOiAyNCwgdGV4dEFsaWduOiAiY2VudGVyIiwgZm9udFNpemU6IDI0LCBmb250V2VpZ2h0OiA2MDAsIGNvbG9yOiBwcm9ncmVzcy5zdGF0dXMgPT09ICJjb21wbGV0ZWQiID8gIiMyZjllNDQiIDogcHJvZ3Jlc3Muc3RhdHVzID09PSAiZmFpbGVkIiA/ICIjZmY0ZDRmIiA6ICIjRTU3MDAwIiB9fT4KICAgICAgICAgICAgICB7cHJvZ3Jlc3Muc3RhdHVzID09PSAiY29tcGxldGVkIiA/ICJDb21wbGV0ZWQhIiA6IHByb2dyZXNzLnN0YXR1cyA9PT0gImZhaWxlZCIgPyAiRmFpbGVkIiA6IGlzVXBsb2FkaW5nID8gIlVwbG9hZGluZy4uLiIgOiAiUHJvY2Vzc2luZy4uLiJ9CiAgICAgICAgICAgIDwvaDI+CiAgICAgICAgICAgIDxkaXYgc3R5bGU9e3sgbWFyZ2luQm90dG9tOiAyMCwgZm9udFNpemU6IDE0LCBjb2xvcjogIiMzNDQ5NWUiLCB0ZXh0QWxpZ246ICJjZW50ZXIiLCBtaW5IZWlnaHQ6IDIwLCBmb250V2VpZ2h0OiA1MDAgfX0+e3Byb2dyZXNzLmN1cnJlbnR9PC9kaXY+CiAgICAgICAgICAgIHshaXNVcGxvYWRpbmcgJiYgKAogICAgICAgICAgICAgIDxkaXY+CiAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXt7IGJhY2tncm91bmQ6ICIjZjFmM2Y1IiwgYm9yZGVyUmFkaXVzOiAxMiwgaGVpZ2h0OiAzNiwgb3ZlcmZsb3c6ICJoaWRkZW4iLCBtYXJnaW5Cb3R0b206IDE0LCBib3hTaGFkb3c6ICJpbnNldCAwIDJweCA0cHggcmdiYSgwLDAsMCwwLjA2KSIgfX0+CiAgICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9e3sgYmFja2dyb3VuZDogcHJvZ3Jlc3Muc3RhdHVzID09PSAiZmFpbGVkIiA/ICJsaW5lYXItZ3JhZGllbnQoOTBkZWcsICNmZjRkNGYsICNmZjc4NzUpIiA6ICJsaW5lYXItZ3JhZGllbnQoOTBkZWcsICNFNTcwMDAsICNmZjhjMWEpIiwgaGVpZ2h0OiAiMTAwJSIsIHdpZHRoOiBwcm9ncmVzc1BlcmNlbnQgKyAiJSIsIHRyYW5zaXRpb246ICJ3aWR0aCAwLjRzIGN1YmljLWJlemllcigwLjQsIDAsIDAuMiwgMSkiLCBkaXNwbGF5OiAiZmxleCIsIGFsaWduSXRlbXM6ICJjZW50ZXIiLCBqdXN0aWZ5Q29udGVudDogImNlbnRlciIsIGNvbG9yOiAiI2ZmZiIsIGZvbnRXZWlnaHQ6IDcwMCwgZm9udFNpemU6IDE0LCBtaW5XaWR0aDogcHJvZ3Jlc3NQZXJjZW50ID4gMCA/ICI2MHB4IiA6ICIwIiwgYm94U2hhZG93OiAiMCAycHggOHB4IHJnYmEoMjI5LCAxMTIsIDAsIDAuNCkiIH19PgogICAgICAgICAgICAgICAgICAgIHtNYXRoLnJvdW5kKHByb2dyZXNzUGVyY2VudCl9JQogICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPGRpdiBzdHlsZT17eyB0ZXh0QWxpZ246ICJjZW50ZXIiLCBmb250U2l6ZTogMTMsIGNvbG9yOiAiI2FkYjViZCIsIG1hcmdpbkJvdHRvbTogMjQsIGZvbnRXZWlnaHQ6IDUwMCB9fT4KICAgICAgICAgICAgICAgICAgeyhwcm9ncmVzcy5wcm9ncmVzcyAvIDFlOSkudG9GaXhlZCgyKX0gR0IgLyB7KHByb2dyZXNzLnRvdGFsIC8gMWU5KS50b0ZpeGVkKDIpfSBHQgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICl9CiAgICAgICAgICAgIHtwcm9ncmVzcy5mYWlsZWQgJiYgcHJvZ3Jlc3MuZmFpbGVkLmxlbmd0aCA+IDAgJiYgKAogICAgICAgICAgICAgIDxkaXYgc3R5bGU9e3sgYmFja2dyb3VuZDogIiNmZmY1ZjUiLCBib3JkZXI6ICIxcHggc29saWQgI2ZmNGQ0ZiIsIHBhZGRpbmc6IDE0LCBib3JkZXJSYWRpdXM6IDEwLCBtYXJnaW5Cb3R0b206IDI0LCBmb250U2l6ZTogMTIsIG1heEhlaWdodDogMTIwLCBvdmVyZmxvdzogImF1dG8iIH19PgogICAgICAgICAgICAgICAgPHN0cm9uZyBzdHlsZT17eyBjb2xvcjogIiNkNjMwMzEiIH19PkVycm9yczo8L3N0cm9uZz4KICAgICAgICAgICAgICAgIDx1bCBzdHlsZT17eyBtYXJnaW46ICI4cHggMCAwIDAiLCBwYWRkaW5nTGVmdDogMjAsIGNvbG9yOiAiIzM0NDk1ZSIgfX0+CiAgICAgICAgICAgICAgICAgIHtwcm9ncmVzcy5mYWlsZWQubWFwKChmLCBpKSA9PiAoCiAgICAgICAgICAgICAgICAgICAgPGxpIGtleT17aX0gc3R5bGU9e3sgbWFyZ2luQm90dG9tOiA0IH19PntmfTwvbGk+CiAgICAgICAgICAgICAgICAgICkpfQogICAgICAgICAgICAgICAgPC91bD4KICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgKX0KICAgICAgICAgICAge2lzRG9uZSAmJiAoCiAgICAgICAgICAgICAgPGRpdiBzdHlsZT17eyB0ZXh0QWxpZ246ICJjZW50ZXIiIH19PgogICAgICAgICAgICAgICAgPGJ1dHRvbiBvbkNsaWNrPXtjbG9zZVByb2dyZXNzfSBzdHlsZT17eyBwYWRkaW5nOiAiMTJweCAzNnB4IiwgYm9yZGVyOiAibm9uZSIsIGJhY2tncm91bmQ6ICIjRTU3MDAwIiwgY29sb3I6ICIjZmZmIiwgYm9yZGVyUmFkaXVzOiAxMCwgY3Vyc29yOiAicG9pbnRlciIsIGZvbnRTaXplOiAxNiwgZm9udFdlaWdodDogNzAwLCB0cmFuc2l0aW9uOiAidHJhbnNmb3JtIDAuMnMiLCBib3hTaGFkb3c6ICIwIDRweCAxMnB4IHJnYmEoMjI5LCAxMTIsIDAsIDAuNCkiIH19CiAgICAgICAgICAgICAgICAgIG9uTW91c2VFbnRlcj17KGUpID0+ICgoZS5jdXJyZW50VGFyZ2V0IGFzIEhUTUxCdXR0b25FbGVtZW50KS5zdHlsZS50cmFuc2Zvcm0gPSAidHJhbnNsYXRlWSgtMnB4KSIpfQogICAgICAgICAgICAgICAgICBvbk1vdXNlTGVhdmU9eyhlKSA9PiAoKGUuY3VycmVudFRhcmdldCBhcyBIVE1MQnV0dG9uRWxlbWVudCkuc3R5bGUudHJhbnNmb3JtID0gInRyYW5zbGF0ZVkoMCkiKX0KICAgICAgICAgICAgICAgID4KICAgICAgICAgICAgICAgICAgT0sKICAgICAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICApfQogICAgICAgICAgPC9kaXY+CiAgICAgICAgPC9kaXY+CiAgICAgICl9CiAgICAgIDxzdHlsZT57YAogICAgICAgIEBtZWRpYSAobWF4LXdpZHRoOiA3NjhweCkgewogICAgICAgICAgYm9keSB7IGZvbnQtc2l6ZTogMTRweDsgfQogICAgICAgICAgaDEgeyBmb250LXNpemU6IDIwcHggIWltcG9ydGFudDsgfQogICAgICAgICAgLnNpZGViYXIgeyB3aWR0aDogMjAwcHggIWltcG9ydGFudDsgfQogICAgICAgIH0KICAgICAgICBAa2V5ZnJhbWVzIGZhZGVJbiB7IGZyb20geyBvcGFjaXR5OiAwOyB9IHRvIHsgb3BhY2l0eTogMTsgfSB9CiAgICAgICAgQGtleWZyYW1lcyBzY2FsZUluIHsgZnJvbSB7IHRyYW5zZm9ybTogc2NhbGUoMC45KTsgb3BhY2l0eTogMDsgfSB0byB7IHRyYW5zZm9ybTogc2NhbGUoMSk7IG9wYWNpdHk6IDE7IH0gfQogICAgICAgIEBrZXlmcmFtZXMgc2xpZGVJblJpZ2h0IHsgZnJvbSB7IHRyYW5zZm9ybTogdHJhbnNsYXRlWCgxMDAlKTsgfSB0byB7IHRyYW5zZm9ybTogdHJhbnNsYXRlWCgwKTsgfSB9CiAgICAgICAgQGtleWZyYW1lcyBzbGlkZURvd24geyBmcm9tIHsgdHJhbnNmb3JtOiB0cmFuc2xhdGVZKC0xMHB4KTsgb3BhY2l0eTogMDsgfSB0byB7IHRyYW5zZm9ybTogdHJhbnNsYXRlWSgwKTsgb3BhY2l0eTogMTsgfSB9CiAgICAgIGB9PC9zdHlsZT4KICAgIDwvZGl2PgogICk7Cn0KCmV4cG9ydCBkZWZhdWx0IEFwcDsK" | base64 -d > /opt/pxstor/src/ui/src/App.tsx

# UI package.json
cat > /opt/pxstor/src/ui/package.json << 'PKGJSON'
{
  "name": "pxstor-ui",
  "private": true,
  "version": "1.0.0",
  "type": "module",
  "scripts": {
    "build": "vite build"
  },
  "dependencies": {
    "react": "^18.2.0",
    "react-dom": "^18.2.0"
  },
  "devDependencies": {
    "@types/react": "^18.2.43",
    "@types/react-dom": "^18.2.17",
    "@vitejs/plugin-react": "^4.2.1",
    "vite": "^5.0.8"
  }
}
PKGJSON

# UI vite.config.js
cat > /opt/pxstor/src/ui/vite.config.js << 'VITEJS'
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'
export default defineConfig({
  plugins: [react()],
  build: { outDir: 'dist', emptyOutDir: true },
})
VITEJS

# UI index.html
cat > /opt/pxstor/src/ui/index.html << 'INDEXHTML'
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PSM</title>
    <link rel= icon href=/proxmox-logo.svg type=image/svg+xml>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>
  </body>
</html>
INDEXHTML

# UI main.jsx
cat > /opt/pxstor/src/ui/src/main.jsx << 'MAINJSX'
import React from 'react'
import ReactDOM from 'react-dom/client'
import App from './App'
ReactDOM.createRoot(document.getElementById('root')).render(<React.StrictMode><App /></React.StrictMode>)
MAINJSX

# UI App.css

# UI Proxmox logo
echo "PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjxzdmcKICAgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIgogICB4bWxuczpjYz0iaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbnMjIgogICB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiCiAgIHhtbG5zOnN2Zz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIKICAgeG1sbnM6c29kaXBvZGk9Imh0dHA6Ly9zb2RpcG9kaS5zb3VyY2Vmb3JnZS5uZXQvRFREL3NvZGlwb2RpLTAuZHRkIgogICB4bWxuczppbmtzY2FwZT0iaHR0cDovL3d3dy5pbmtzY2FwZS5vcmcvbmFtZXNwYWNlcy9pbmtzY2FwZSIKICAgd2lkdGg9IjgwMCIKICAgaGVpZ2h0PSI4MDAiCiAgIHZpZXdCb3g9IjAgMCAyMTEuNjY2NjYgMjExLjY2NjY2IgogICB2ZXJzaW9uPSIxLjEiCiAgIGlkPSJzdmc5MjQiCiAgIGlua3NjYXBlOmV4cG9ydC1maWxlbmFtZT0iL2hvbWUvZGFuaWVsYS9Eb2N1bWVudHMvcHJveG1veC9Qcm94bW94L01hcmtldGluZy9Mb2dvL1ppcGZpbGVzX3RvX3NlbmQvcHJveG1veC1sb2dvLXBhY2svUHJveG1veF9sb2dvc19mdWxsX2xvY2t1cF9QTkcvcHJveG1veC1sb2dvLXN0YWNrZWQtY29sb3ItYmd0cmFucy5wbmciCiAgIGlua3NjYXBlOmV4cG9ydC14ZHBpPSI5NiIKICAgaW5rc2NhcGU6ZXhwb3J0LXlkcGk9Ijk2IgogICBpbmtzY2FwZTp2ZXJzaW9uPSIxLjAuMiAoZTg2Yzg3MDg3OSwgMjAyMS0wMS0xNSkiCiAgIHNvZGlwb2RpOmRvY25hbWU9InByb3htb3gtbG9nby1zdGFja2VkLWNvbG9yLWJndHJhbnMuc3ZnIj4KICA8ZGVmcwogICAgIGlkPSJkZWZzOTE4IiAvPgogIDxzb2RpcG9kaTpuYW1lZHZpZXcKICAgICBpZD0iYmFzZSIKICAgICBwYWdlY29sb3I9IiNmZmZmZmYiCiAgICAgYm9yZGVyY29sb3I9IiM2NjY2NjYiCiAgICAgYm9yZGVyb3BhY2l0eT0iMS4wIgogICAgIGlua3NjYXBlOnBhZ2VvcGFjaXR5PSIwLjAiCiAgICAgaW5rc2NhcGU6cGFnZXNoYWRvdz0iMiIKICAgICBpbmtzY2FwZTp6b29tPSIwLjU2ODYzMTEzIgogICAgIGlua3NjYXBlOmN4PSIxOTUuODQ4NzIiCiAgICAgaW5rc2NhcGU6Y3k9IjE4OS43MDQzNSIKICAgICBpbmtzY2FwZTpkb2N1bWVudC11bml0cz0ibW0iCiAgICAgaW5rc2NhcGU6Y3VycmVudC1sYXllcj0ibGF5ZXIxIgogICAgIGlua3NjYXBlOmRvY3VtZW50LXJvdGF0aW9uPSIwIgogICAgIHNob3dncmlkPSJmYWxzZSIKICAgICBpbmtzY2FwZTpwYWdlY2hlY2tlcmJvYXJkPSJ0cnVlIgogICAgIGZpdC1tYXJnaW4tdG9wPSIwIgogICAgIGZpdC1tYXJnaW4tbGVmdD0iMCIKICAgICBmaXQtbWFyZ2luLXJpZ2h0PSIwIgogICAgIGZpdC1tYXJnaW4tYm90dG9tPSIwIgogICAgIGlua3NjYXBlOndpbmRvdy13aWR0aD0iMTcyMCIKICAgICBpbmtzY2FwZTp3aW5kb3ctaGVpZ2h0PSIxMzQzIgogICAgIGlua3NjYXBlOndpbmRvdy14PSIxNzIwIgogICAgIGlua3NjYXBlOndpbmRvdy15PSIyNyIKICAgICBpbmtzY2FwZTp3aW5kb3ctbWF4aW1pemVkPSIwIgogICAgIHVuaXRzPSJweCIgLz4KICA8bWV0YWRhdGEKICAgICBpZD0ibWV0YWRhdGE5MjEiPgogICAgPHJkZjpSREY+CiAgICAgIDxjYzpXb3JrCiAgICAgICAgIHJkZjphYm91dD0iIj4KICAgICAgICA8ZGM6Zm9ybWF0PmltYWdlL3N2Zyt4bWw8L2RjOmZvcm1hdD4KICAgICAgICA8ZGM6dHlwZQogICAgICAgICAgIHJkZjpyZXNvdXJjZT0iaHR0cDovL3B1cmwub3JnL2RjL2RjbWl0eXBlL1N0aWxsSW1hZ2UiIC8+CiAgICAgICAgPGRjOnRpdGxlIC8+CiAgICAgIDwvY2M6V29yaz4KICAgIDwvcmRmOlJERj4KICA8L21ldGFkYXRhPgogIDxnCiAgICAgaW5rc2NhcGU6bGFiZWw9IkxheWVyIDEiCiAgICAgaW5rc2NhcGU6Z3JvdXBtb2RlPSJsYXllciIKICAgICBpZD0ibGF5ZXIxIgogICAgIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0xMS4zNDY5MTYsLTMxLjM2ODQ2MSkiPgogICAgPGcKICAgICAgIGlkPSJnMTg5OCIKICAgICAgIHRyYW5zZm9ybT0ibWF0cml4KDEuMzQ2MzMzNCwwLDAsMS4zNDYzMzM0LDM3NS4zMzE1NiwtMTIxNS41MDU5KSI+CiAgICAgIDxnCiAgICAgICAgIHRyYW5zZm9ybT0ibWF0cml4KDAuNjI4ODY4NTQsMCwwLDAuNjI4ODY4NTQsMTI1LjMxODE4LDI5Ny45OTg2NSkiCiAgICAgICAgIGlkPSJnMTI4OCIKICAgICAgICAgc3R5bGU9ImZpbGw6IzAwMDAwMCI+CiAgICAgICAgPGcKICAgICAgICAgICBpZD0iZzEyODYiCiAgICAgICAgICAgc3R5bGU9ImZvbnQtc3R5bGU6bm9ybWFsO2ZvbnQtdmFyaWFudDpub3JtYWw7Zm9udC13ZWlnaHQ6bm9ybWFsO2ZvbnQtc3RyZXRjaDpub3JtYWw7Zm9udC1zaXplOjI1LjgzMzZweDtsaW5lLWhlaWdodDoxMjUlO2ZvbnQtZmFtaWx5OkhlbGlvbjstaW5rc2NhcGUtZm9udC1zcGVjaWZpY2F0aW9uOkhlbGlvbjt0ZXh0LWFsaWduOnN0YXJ0O2xldHRlci1zcGFjaW5nOjBweDt3b3JkLXNwYWNpbmc6MHB4O3dyaXRpbmctbW9kZTpsci10Yjt0ZXh0LWFuY2hvcjpzdGFydDtmaWxsOiMwMDAwMDA7ZmlsbC1vcGFjaXR5OjE7c3Ryb2tlOm5vbmUiCiAgICAgICAgICAgdHJhbnNmb3JtPSJtYXRyaXgoMS4yNDM1MTM3LDAsMCwxLjI0MzUxMzcsLTc5MS4wNjQ4MSw1NTMuNzU4NjIpIj4KICAgICAgICAgIDxwYXRoCiAgICAgICAgICAgICBpbmtzY2FwZTpjb25uZWN0b3ItY3VydmF0dXJlPSIwIgogICAgICAgICAgICAgaWQ9InBhdGgxMjcyIgogICAgICAgICAgICAgZD0ibSAxNjguODUxNDIsNTAwLjk1OTUgaCAtMTEuODU3NDcgYyAtMC40NjU1NCwwLjAxMjkgLTAuODU4NDIsMC4xODA4NSAtMS4xNzg2NCwwLjUwMzc0IC0wLjMyMDIzLDAuMzIyOTQgLTAuNDg3MDcsMC43MjMzNSAtMC41MDA1MiwxLjIwMTI1IHYgMTYuMzc4MyBjIDEuMjcyMjksLTAuMDMxOCAyLjMzMTQ1LC0wLjQ3MiAzLjE3NzQ5LC0xLjMyMDczIDAuODQ2MDQsLTAuODQ4NzMgMS4yODUyLC0xLjkxNTQzIDEuMzE3NSwtMy4yMDAxIGggOS4wNDE2NCBjIDEuMjg1NzMsLTAuMDMxNyAyLjM1NjczLC0wLjQ3MTk5IDMuMjEzMDIsLTEuMzIwNzIgMC44NTYyNCwtMC44NDg3MyAxLjMwMDc5LC0xLjkxNTQzIDEuMzMzNjQsLTMuMjAwMSB2IC00LjQ5NDk5IGMgLTAuMDMyOCwtMS4yODU3MyAtMC40Nzc0LC0yLjM1NjczIC0xLjMzMzY0LC0zLjIxMzAxIC0wLjg1NjI5LC0wLjg1NjI1IC0xLjkyNzI5LC0xLjMwMDggLTMuMjEzMDIsLTEuMzMzNjQgeiBtIC05LjA0MTY0LDkuNjA5OTcgdiAtNS4wNjMzMiBoIDcuOTMwODEgYyAwLjA0NjMsLTAuMDIzMSAwLjIzMTQxLDAuMDIzMiAwLjU1NTQyLDAuMTM4ODUgMC4zMjM5OCwwLjExNTczIDAuNTA5MTIsMC40Mzk3MiAwLjU1NTQxLDAuOTcxOTggdiAyLjgxNTgzIGMgMC4wMjMxLDAuMDQ3NCAtMC4wMjMxLDAuMjM2ODEgLTAuMTM4ODUsMC41NjgzMyAtMC4xMTU3MywwLjMzMTU0IC0wLjQzOTcyLDAuNTIwOTggLTAuOTcxOTgsMC41NjgzMyB6IgogICAgICAgICAgICAgc3R5bGU9ImZpbGw6IzAwMDAwMDtmaWxsLW9wYWNpdHk6MSIgLz4KICAgICAgICAgIDxwYXRoCiAgICAgICAgICAgICBpbmtzY2FwZTpjb25uZWN0b3ItY3VydmF0dXJlPSIwIgogICAgICAgICAgICAgaWQ9InBhdGgxMjc0IgogICAgICAgICAgICAgZD0ibSAxOTQuMDU5MzEsNTA4Ljg5MDMxIHYgLTMuMzg0MTYgYyAtMC4wMzE4LC0xLjI4NTczIC0wLjQ3MjAxLC0yLjM1NjczIC0xLjMyMDcyLC0zLjIxMzAxIC0wLjg0ODc1LC0wLjg1NjI1IC0xLjkxNTQ1LC0xLjMwMDggLTMuMjAwMSwtMS4zMzM2NCBoIC0xMS44NTc0NyBjIC0wLjQ3Njg0LDAuMDEyOSAtMC44NzI5NSwwLjE4MDg1IC0xLjE4ODMzLDAuNTAzNzQgLTAuMzE1MzgsMC4zMjI5NCAtMC40Nzg5OSwwLjcyMzM1IC0wLjQ5MDgzLDEuMjAxMjUgdiAxNi4zNzgzIGMgMS4yNzMzNiwtMC4wMzE4IDIuMzM2ODMsLTAuNDcyIDMuMTkwNCwtMS4zMjA3MyAwLjg1MzU3LC0wLjg0ODczIDEuMjk3MDUsLTEuOTE1NDMgMS4zMzA0MiwtMy4yMDAxIHYgLTEuMTM2NjYgaCA1LjE0MDgyIGwgMi42MDkxNiwzLjcxOTk5IGMgMC40MTg3LDAuNjAwNjMgMC45NDM5OCwxLjA3MjA4IDEuNTc1ODMsMS40MTQzNyAwLjYzMTgyLDAuMzQyMjkgMS4zMzc5MywwLjUxNjY3IDIuMTE4MzMsMC41MjMxMyAwLjM3NjE4LC01LjRlLTQgMC43NDEwNywtMC4wNDQ3IDEuMDk0NjgsLTAuMTMyNCAwLjM1MzU4LC0wLjA4NzcgMC42ODYxOCwtMC4yMTU4MiAwLjk5NzgxLC0wLjM4NDI3IGwgLTMuNjQyNDksLTUuMTkyNDkgYyAxLjA1NTkyLC0wLjIyODcyIDEuOTIxMzMsLTAuNzQ2NDcgMi41OTYyNSwtMS41NTMyMiAwLjY3NDg3LC0wLjgwNjc1IDEuMDIzNjIsLTEuNzcwMTEgMS4wNDYyNCwtMi44OTAxIHogbSAtMTMuNTM2NjMsMC41NDI1IHYgLTMuOTI2NjYgaCA3Ljg3OTE1IGMgMC4wNDc0LC0wLjAyMzEgMC4yMzY3OSwwLjAyMzIgMC41NjgzMywwLjEzODg1IDAuMzMxNTEsMC4xMTU3MyAwLjUyMDk2LDAuNDM5NzIgMC41NjgzMywwLjk3MTk4IHYgMS43MDUgYyAwLjAyMzcsMC4wNDYzIC0wLjAyMzcsMC4yMzE0MyAtMC4xNDIwOCwwLjU1NTQxIC0wLjExODQyLDAuMzI0IC0wLjQ0OTk1LDAuNTA5MTQgLTAuOTk0NTgsMC41NTU0MiB6IgogICAgICAgICAgICAgc3R5bGU9ImZpbGw6IzAwMDAwMDtmaWxsLW9wYWNpdHk6MSIgLz4KICAgICAgICAgIDxwYXRoCiAgICAgICAgICAgICBpbmtzY2FwZTpjb25uZWN0b3ItY3VydmF0dXJlPSIwIgogICAgICAgICAgICAgaWQ9InBhdGgxMjc2IgogICAgICAgICAgICAgZD0ibSAyMTAuMTc1MSw1MDAuOTU5NSBoIC05LjAxNTgxIGMgLTEuMjg0NjcsMC4wMzI4IC0yLjM1MTM3LDAuNDc3MzkgLTMuMjAwMSwxLjMzMzY0IC0wLjg0ODczLDAuODU2MjggLTEuMjg4OTcsMS45MjcyOCAtMS4zMjA3MiwzLjIxMzAxIHYgOS4wMTU4MSBjIDAuMDMxNywxLjI4NDY3IDAuNDcxOTksMi4zNTEzNyAxLjMyMDcyLDMuMjAwMSAwLjg0ODczLDAuODQ4NzMgMS45MTU0MywxLjI4ODk3IDMuMjAwMSwxLjMyMDczIGggOS4wMTU4MSBjIDEuMjg0NjUsLTAuMDMxOCAyLjM1MTM1LC0wLjQ3MiAzLjIwMDEsLTEuMzIwNzMgMC44NDg3MSwtMC44NDg3MyAxLjI4ODk1LC0xLjkxNTQzIDEuMzIwNzIsLTMuMjAwMSB2IC05LjAxNTgxIGMgLTAuMDMxOCwtMS4yODU3MyAtMC40NzIwMSwtMi4zNTY3MyAtMS4zMjA3MiwtMy4yMTMwMSAtMC44NDg3NSwtMC44NTYyNSAtMS45MTU0NSwtMS4zMDA4IC0zLjIwMDEsLTEuMzMzNjQgeiBtIDAsMTIuNDI1OCBjIDAuMDIzNywwLjA0NzQgLTAuMDIzNywwLjIzNjgxIC0wLjE0MjA4LDAuNTY4MzMgLTAuMTE4NDIsMC4zMzE1MyAtMC40NDk5NSwwLjUyMDk4IC0wLjk5NDU4LDAuNTY4MzMgaCAtNi43NDI0OSBjIC0wLjA0NzQsMC4wMjM3IC0wLjIzNjgxLC0wLjAyMzcgLTAuNTY4MzMsLTAuMTQyMDggLTAuMzMxNTMsLTAuMTE4NCAtMC41MjA5OCwtMC40NDk5MyAtMC41NjgzMywtMC45OTQ1OCB2IC02Ljc2ODMyIGMgLTAuMDIzNywtMC4wNDYzIDAuMDIzNywtMC4yMzE0MSAwLjE0MjA4LC0wLjU1NTQxIDAuMTE4NCwtMC4zMjM5OCAwLjQ0OTkzLC0wLjUwOTEyIDAuOTk0NTgsLTAuNTU1NDIgaCA2Ljc0MjQ5IGMgMC4wNDczLC0wLjAyMzEgMC4yMzY3OSwwLjAyMzIgMC41NjgzMywwLjEzODg1IDAuMzMxNTEsMC4xMTU3MyAwLjUyMDk2LDAuNDM5NzIgMC41NjgzMywwLjk3MTk4IHoiCiAgICAgICAgICAgICBzdHlsZT0iZmlsbDojMDAwMDAwO2ZpbGwtb3BhY2l0eToxIiAvPgogICAgICAgICAgPHBhdGgKICAgICAgICAgICAgIGlua3NjYXBlOmNvbm5lY3Rvci1jdXJ2YXR1cmU9IjAiCiAgICAgICAgICAgICBpZD0icGF0aDEyNzgiCiAgICAgICAgICAgICBkPSJtIDIzNy40NzY3LDUwMi4yNTExNiBjIC0wLjM5MTgzLC0wLjM5MTc5IC0wLjg0ODIyLC0wLjY5OTY0IC0xLjM2OTE3LC0wLjkyMzU0IC0wLjUyMDk5LC0wLjIyMzg3IC0xLjA4MDcxLC0wLjMzNzk3IC0xLjY3OTE2LC0wLjM0MjI5IC0wLjYzNjcsMC4wMDUgLTEuMjIzMzMsMC4xMzA4IC0xLjc1OTg5LDAuMzc3ODEgLTAuNTM2NTksMC4yNDcwNSAtMS4wMDA1MiwwLjU4NjExIC0xLjM5MTc3LDEuMDE3MTkgbCAtMy45MDA4Miw0LjI4ODMyIC0zLjkyNjY2LC00LjI4ODMyIGMgLTAuNDAxNSwtMC40NDIzOCAtMC44NjQzNCwtMC43ODQ2NyAtMS4zODg1NCwtMS4wMjY4OCAtMC41MjQyLC0wLjI0MjE3IC0xLjEwMzMsLTAuMzY0ODcgLTEuNzM3MjksLTAuMzY4MTIgLTAuNTk4NDcsMC4wMDQgLTEuMTU4MTksMC4xMTg0MiAtMS42NzkxNiwwLjM0MjI5IC0wLjUyMDk3LDAuMjIzOSAtMC45NzczNiwwLjUzMTc1IC0xLjM2OTE2LDAuOTIzNTQgbCA3LjA1MjQ4LDcuNzQ5OTggLTcuMDUyNDgsNy43NDk5OCBjIDAuMzkxOCwwLjQwNDE5IDAuODQ4MTksMC43MTk1NyAxLjM2OTE2LDAuOTQ2MTUgMC41MjA5NywwLjIyNjU3IDEuMDgwNjksMC4zNDE3NSAxLjY3OTE2LDAuMzQ1NTIgMC42MjUzOCwtMC4wMDUgMS4yMDg3OCwtMC4xMzA3OSAxLjc1MDIxLC0wLjM3NzgyIDAuNTQxNDIsLTAuMjQ3MDMgMS4wMDg1NywtMC41ODYwOSAxLjQwMTQ1LC0xLjAxNzE4IGwgMy45MDA4MywtNC4yODgzMiAzLjkwMDgyLDQuMjg4MzIgYyAwLjM5MTI1LDAuNDMxMDkgMC44NTUxOCwwLjc3MDE1IDEuMzkxNzcsMS4wMTcxOCAwLjUzNjU2LDAuMjQ3MDMgMS4xMjMxOSwwLjM3Mjk3IDEuNzU5ODksMC4zNzc4MiAwLjU5ODQ1LC0wLjAwNCAxLjE1ODE3LC0wLjExODk1IDEuNjc5MTYsLTAuMzQ1NTIgMC41MjA5NiwtMC4yMjY1OCAwLjk3NzM0LC0wLjU0MTk2IDEuMzY5MTcsLTAuOTQ2MTUgbCAtNy4wNTI0OSwtNy43NDk5OCB6IgogICAgICAgICAgICAgc3R5bGU9ImZpbGw6IzAwMDAwMDtmaWxsLW9wYWNpdHk6MSIgLz4KICAgICAgICAgIDxwYXRoCiAgICAgICAgICAgICBpbmtzY2FwZTpjb25uZWN0b3ItY3VydmF0dXJlPSIwIgogICAgICAgICAgICAgaWQ9InBhdGgxMjgwIgogICAgICAgICAgICAgZD0ibSAyNjAuOTgwNDIsNTAwLjk1OTUgaCAtMi44NDE2NiBjIC0wLjkyOTQ3LDAuMDEyOSAtMS43NTcyMSwwLjI2NDggLTIuNDgzMjIsMC43NTU2MiAtMC43MjYwNCwwLjQ5MDg1IC0xLjI3NjA3LDEuMTQzMTQgLTEuNjUwMSwxLjk1Njg3IGwgMC4wMjU4LC0wLjA1MTcgLTIuNjYwODIsNS44MzgzMiAtMi42MzUsLTUuODM4MzIgdiAwLjA1MTcgYyAtMC4zNjI3NSwtMC44MTM3MyAtMC45MDk1NSwtMS40NjYwMiAtMS42NDA0MSwtMS45NTY4NyAtMC43MzA4NywtMC40OTA4MiAtMS41NjE4NCwtMC43NDI2OSAtMi40OTI5MSwtMC43NTU2MiBoIC0yLjgxNTgzIGMgLTAuNDg5MjIsMC4wMTI5IC0wLjg5Mjg2LDAuMTgwODUgLTEuMjEwOTMsMC41MDM3NCAtMC4zMTgwOCwwLjMyMjk0IC0wLjQ4Mjc2LDAuNzIzMzUgLTAuNDk0MDYsMS4yMDEyNSB2IDE2LjM3ODMgYyAxLjI3MzM2LC0wLjAzMTggMi4zMzY4MywtMC40NzIgMy4xOTA0MSwtMS4zMjA3MyAwLjg1MzU3LC0wLjg0ODczIDEuMjk3MDQsLTEuOTE1NDMgMS4zMzA0MSwtMy4yMDAxIHYgLTguNjU0MTQgYyAwLjAwMiwtMC4xMTc4NSAwLjAzNzEsLTAuMjExNSAwLjEwNjU2LC0wLjI4MDk0IDAuMDY5NCwtMC4wNjk0IDAuMTYzMDcsLTAuMTA0OTMgMC4yODA5NCwtMC4xMDY1NiAwLjA2NzMsMC4wMDIgMC4xMzI5MywwLjAyMzcgMC4xOTY5OCwwLjA2NDYgMC4wNjQsMC4wNDA5IDAuMTEwMzIsMC4wODgzIDAuMTM4ODUsMC4xNDIwOCBsIDUuMDExNjYsMTEuMDU2NjQgYyAwLjA5NDcsMC4xOTc1MiAwLjIzNDY0LDAuMzU3OSAwLjQxOTc5LDAuNDgxMTUgMC4xODUxMiwwLjEyMzI1IDAuMzg5NjQsMC4xODY3NSAwLjYxMzU0LDAuMTkwNTIgMC4yMjIyNiwtMC4wMDMgMC40MjM1NCwtMC4wNjE5IDAuNjAzODUsLTAuMTc3NiAwLjE4MDI4LC0wLjExNTcxIDAuMzIzNDQsLTAuMjcxNzkgMC40Mjk0OCwtMC40NjgyMyBMIDI1Ny40MTU0LDUwNS42ODcgYyAwLjAzOTMsLTAuMDUzOCAwLjA4OTksLTAuMTAxMTYgMC4xNTE3NywtMC4xNDIwOCAwLjA2MTksLTAuMDQwOSAwLjEzMTg0LC0wLjA2MjQgMC4yMDk5LC0wLjA2NDYgMC4xMDU0NywwLjAwMiAwLjE5MTU4LDAuMDM3MSAwLjI1ODMzLDAuMTA2NTYgMC4wNjY3LDAuMDY5NCAwLjEwMTE2LDAuMTYzMDkgMC4xMDMzMywwLjI4MDk0IHYgOC42NTQxNCBjIDAuMDMzMywxLjI4NDY3IDAuNDc2ODIsMi4zNTEzNyAxLjMzMDQyLDMuMjAwMSAwLjg1MzU1LDAuODQ4NzMgMS45MTcwMiwxLjI4ODk3IDMuMTkwNDEsMS4zMjA3MyB2IC0xNi4zNzgzIGMgLTAuMDExOSwtMC40Nzc5IC0wLjE3NTQ4LC0wLjg3ODMxIC0wLjQ5MDg0LC0xLjIwMTI1IC0wLjMxNTQsLTAuMzIyODkgLTAuNzExNTEsLTAuNDkwODEgLTEuMTg4MzMsLTAuNTAzNzQgeiIKICAgICAgICAgICAgIHN0eWxlPSJmaWxsOiMwMDAwMDA7ZmlsbC1vcGFjaXR5OjEiIC8+CiAgICAgICAgICA8cGF0aAogICAgICAgICAgICAgaW5rc2NhcGU6Y29ubmVjdG9yLWN1cnZhdHVyZT0iMCIKICAgICAgICAgICAgIGlkPSJwYXRoMTI4MiIKICAgICAgICAgICAgIGQ9Im0gMjc4Ljc5NTYxLDUwMC45NTk1IGggLTkuMDE1ODEgYyAtMS4yODQ2NywwLjAzMjggLTIuMzUxMzcsMC40NzczOSAtMy4yMDAwOSwxLjMzMzY0IC0wLjg0ODc0LDAuODU2MjggLTEuMjg4OTgsMS45MjcyOCAtMS4zMjA3MywzLjIxMzAxIHYgOS4wMTU4MSBjIDAuMDMxNywxLjI4NDY3IDAuNDcxOTksMi4zNTEzNyAxLjMyMDczLDMuMjAwMSAwLjg0ODcyLDAuODQ4NzMgMS45MTU0MiwxLjI4ODk3IDMuMjAwMDksMS4zMjA3MyBoIDkuMDE1ODEgYyAxLjI4NDY2LC0wLjAzMTggMi4zNTEzNSwtMC40NzIgMy4yMDAxLC0xLjMyMDczIDAuODQ4NzEsLTAuODQ4NzMgMS4yODg5NiwtMS45MTU0MyAxLjMyMDczLC0zLjIwMDEgdiAtOS4wMTU4MSBjIC0wLjAzMTgsLTEuMjg1NzMgLTAuNDcyMDIsLTIuMzU2NzMgLTEuMzIwNzMsLTMuMjEzMDEgLTAuODQ4NzUsLTAuODU2MjUgLTEuOTE1NDQsLTEuMzAwOCAtMy4yMDAxLC0xLjMzMzY0IHogbSAwLDEyLjQyNTggYyAwLjAyMzcsMC4wNDc0IC0wLjAyMzcsMC4yMzY4MSAtMC4xNDIwOCwwLjU2ODMzIC0wLjExODQyLDAuMzMxNTMgLTAuNDQ5OTQsMC41MjA5OCAtMC45OTQ1OCwwLjU2ODMzIGggLTYuNzQyNDggYyAtMC4wNDc0LDAuMDIzNyAtMC4yMzY4MSwtMC4wMjM3IC0wLjU2ODM0LC0wLjE0MjA4IC0wLjMzMTUzLC0wLjExODQgLTAuNTIwOTcsLTAuNDQ5OTMgLTAuNTY4MzMsLTAuOTk0NTggdiAtNi43NjgzMiBjIC0wLjAyMzcsLTAuMDQ2MyAwLjAyMzcsLTAuMjMxNDEgMC4xNDIwOSwtMC41NTU0MSAwLjExODM5LC0wLjMyMzk4IDAuNDQ5OTIsLTAuNTA5MTIgMC45OTQ1OCwtMC41NTU0MiBoIDYuNzQyNDggYyAwLjA0NzMsLTAuMDIzMSAwLjIzNjc5LDAuMDIzMiAwLjU2ODMzLDAuMTM4ODUgMC4zMzE1MiwwLjExNTczIDAuNTIwOTYsMC40Mzk3MiAwLjU2ODMzLDAuOTcxOTggeiIKICAgICAgICAgICAgIHN0eWxlPSJmaWxsOiMwMDAwMDA7ZmlsbC1vcGFjaXR5OjEiIC8+CiAgICAgICAgICA8cGF0aAogICAgICAgICAgICAgaW5rc2NhcGU6Y29ubmVjdG9yLWN1cnZhdHVyZT0iMCIKICAgICAgICAgICAgIGlkPSJwYXRoMTI4NCIKICAgICAgICAgICAgIGQ9Im0gMzA2LjA5NzIsNTAyLjI1MTE2IGMgLTAuMzkxODIsLTAuMzkxNzkgLTAuODQ4MjEsLTAuNjk5NjQgLTEuMzY5MTYsLTAuOTIzNTQgLTAuNTIwOTksLTAuMjIzODcgLTEuMDgwNzEsLTAuMzM3OTcgLTEuNjc5MTYsLTAuMzQyMjkgLTAuNjM2NywwLjAwNSAtMS4yMjMzMywwLjEzMDggLTEuNzU5ODksMC4zNzc4MSAtMC41MzY2LDAuMjQ3MDUgLTEuMDAwNTIsMC41ODYxMSAtMS4zOTE3NywxLjAxNzE5IGwgLTMuOTAwODMsNC4yODgzMiAtMy45MjY2NSwtNC4yODgzMiBjIC0wLjQwMTUsLTAuNDQyMzggLTAuODY0MzUsLTAuNzg0NjcgLTEuMzg4NTQsLTEuMDI2ODggLTAuNTI0MjEsLTAuMjQyMTcgLTEuMTAzMywtMC4zNjQ4NyAtMS43MzcyOSwtMC4zNjgxMiAtMC41OTg0NywwLjAwNCAtMS4xNTgxOSwwLjExODQyIC0xLjY3OTE2LDAuMzQyMjkgLTAuNTIwOTcsMC4yMjM5IC0wLjk3NzM2LDAuNTMxNzUgLTEuMzY5MTcsMC45MjM1NCBsIDcuMDUyNDksNy43NDk5OCAtNy4wNTI0OSw3Ljc0OTk4IGMgMC4zOTE4MSwwLjQwNDE5IDAuODQ4MiwwLjcxOTU3IDEuMzY5MTcsMC45NDYxNSAwLjUyMDk3LDAuMjI2NTcgMS4wODA2OSwwLjM0MTc1IDEuNjc5MTYsMC4zNDU1MiAwLjYyNTM4LC0wLjAwNSAxLjIwODc4LC0wLjEzMDc5IDEuNzUwMiwtMC4zNzc4MiAwLjU0MTQyLC0wLjI0NzAzIDEuMDA4NTcsLTAuNTg2MDkgMS40MDE0NiwtMS4wMTcxOCBsIDMuOTAwODIsLTQuMjg4MzIgMy45MDA4Myw0LjI4ODMyIGMgMC4zOTEyNSwwLjQzMTA5IDAuODU1MTcsMC43NzAxNSAxLjM5MTc3LDEuMDE3MTggMC41MzY1NiwwLjI0NzAzIDEuMTIzMTksMC4zNzI5NyAxLjc1OTg5LDAuMzc3ODIgMC41OTg0NSwtMC4wMDQgMS4xNTgxNywtMC4xMTg5NSAxLjY3OTE2LC0wLjM0NTUyIDAuNTIwOTUsLTAuMjI2NTggMC45NzczNCwtMC41NDE5NiAxLjM2OTE2LC0wLjk0NjE1IGwgLTcuMDUyNDgsLTcuNzQ5OTggeiIKICAgICAgICAgICAgIHN0eWxlPSJmaWxsOiMwMDAwMDA7ZmlsbC1vcGFjaXR5OjEiIC8+CiAgICAgICAgPC9nPgogICAgICA8L2c+CiAgICAgIDxnCiAgICAgICAgIGlkPSJnMTg4MiI+CiAgICAgICAgPHBhdGgKICAgICAgICAgICBpbmtzY2FwZTpjb25uZWN0b3ItY3VydmF0dXJlPSIwIgogICAgICAgICAgIGlkPSJwYXRoMTI5MCIKICAgICAgICAgICBzdHlsZT0iZmlsbDojZTU3MDAwO2ZpbGwtb3BhY2l0eToxO2ZpbGwtcnVsZTpub256ZXJvO3N0cm9rZTpub25lO3N0cm9rZS13aWR0aDowLjU0Mjg3NSIKICAgICAgICAgICBkPSJtIC0xNzMuMzg0OTcsOTg5LjY0NTE0IDE4Ljg3NTI0LDIwLjc0MjI2IGMgLTIuMDc0MywyLjE0MzIgLTQuOTc4MTQsMy40NTc1IC04LjE1OTQsMy40NTc1IC0zLjM4NzU0LDAgLTYuMzYwMzUsLTEuNDUyMiAtOC40MzQ3LC0zLjczMzkgbCAtMTAuNDQwMDIsLTExLjQ3Njg5IC04LjE1ODksLTguOTg4OTcgOC4xNTg5LC04LjkxOTQ0IDEwLjQ0MDAyLC0xMS40Nzc0OSBjIDIuMDc0MzUsLTIuMjgxMTQgNS4wNDcxNiwtMy43MzM5IDguNDM0NywtMy43MzM5IDMuMTgxMjYsMCA2LjA4NTEsMS4zMTM3NiA4LjE1OTQsMy4zODgxMSB6IgogICAgICAgICAgIHNvZGlwb2RpOm5vZGV0eXBlcz0iY2NzY2NjY2NzY2MiIC8+CiAgICAgICAgPHBhdGgKICAgICAgICAgICBpbmtzY2FwZTpjb25uZWN0b3ItY3VydmF0dXJlPSIwIgogICAgICAgICAgIGlkPSJwYXRoMTI5MiIKICAgICAgICAgICBzdHlsZT0iZmlsbDojZTU3MDAwO2ZpbGwtb3BhY2l0eToxO2ZpbGwtcnVsZTpub256ZXJvO3N0cm9rZTpub25lO3N0cm9rZS13aWR0aDowLjU0Mjg3NSIKICAgICAgICAgICBkPSJtIC0yMTAuMTk4NTQsOTg5LjY0NDkxIC0xOC44NzUyNSwyMC43NDIyOSBjIDIuMDc0MywyLjE0MzIgNC45NzgxNCwzLjQ1NzUgOC4xNTk0MSwzLjQ1NzUgMy4zODc1MywwIDYuMzYwMzQsLTEuNDUyMiA4LjQzNDY5LC0zLjczMzkgbCAxMC40NDAwMiwtMTEuNDc2OTIgOC4xNTg4OCwtOC45ODg5NyAtOC4xNTg4OCwtOC45MTk0NCAtMTAuNDQwMDIsLTExLjQ3NzQ5IGMgLTIuMDc0MzUsLTIuMjgxMTcgLTUuMDQ3MTYsLTMuNzMzOSAtOC40MzQ2OSwtMy43MzM5IC0zLjE4MTI3LDAgLTYuMDg1MTEsMS4zMTM3NiAtOC4xNTk0MSwzLjM4ODExIHoiCiAgICAgICAgICAgc29kaXBvZGk6bm9kZXR5cGVzPSJjY3NjY2NjY3NjYyIgLz4KICAgICAgICA8cGF0aAogICAgICAgICAgIGlua3NjYXBlOmNvbm5lY3Rvci1jdXJ2YXR1cmU9IjAiCiAgICAgICAgICAgaWQ9InBhdGgxMjk0IgogICAgICAgICAgIHN0eWxlPSJmaWxsOiMwMDAwMDA7ZmlsbC1vcGFjaXR5OjE7ZmlsbC1ydWxlOm5vbnplcm87c3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOjAuNDk1NTA5IgogICAgICAgICAgIGQ9Im0gLTE4NC4zNTQyOSw5OTkuOTI5NzMgLTcuNDQ2NzgsLTguMjA0NDEgLTcuNDQ3MTIsOC4yMDQ0MSAtMTcuMjI4NTMsMTguOTMyNzcgYyAxLjg5MzE1LDEuODkzMyA0LjU0NDMyLDMuMDkyMyA3LjQ0NjI2LDMuMDkyMyAzLjA5MjU0LDAgNS42ODA0NSwtMS4yNjI1IDcuNjM2MzgsLTMuNDA3OSBsIDkuNTkzMDEsLTEwLjQ3NTkgOS41Mjg3MSwxMC40NzU5IGMgMS44OTM1MSwyLjA4MTkgNC42MDY3MiwzLjQwNzkgNy42OTg3OCwzLjQwNzkgMi45MDM1MiwwIDUuNTU0MTEsLTEuMTk5IDcuNDQ3MjgsLTMuMDkyMyB6IgogICAgICAgICAgIHNvZGlwb2RpOm5vZGV0eXBlcz0iY2NjY3NjY2NzY2MiIC8+CiAgICAgICAgPHBhdGgKICAgICAgICAgICBpbmtzY2FwZTpjb25uZWN0b3ItY3VydmF0dXJlPSIwIgogICAgICAgICAgIGlkPSJwYXRoMTI5NiIKICAgICAgICAgICBzdHlsZT0iZmlsbDojMDAwMDAwO2ZpbGwtb3BhY2l0eToxO2ZpbGwtcnVsZTpub256ZXJvO3N0cm9rZTpub25lO3N0cm9rZS13aWR0aDowLjQ5NTUwOSIKICAgICAgICAgICBkPSJtIC0xODQuMzU0NzUsOTc5LjM1OTIyIC03LjQ0Njc4LDguMjA0NDEgLTcuNDQ3MTIsLTguMjA0NDEgLTE3LjIyODUyLC0xOC45MzI3NiBjIDEuODkzMTcsLTEuODkzMjQgNC41NDQzMSwtMy4wOTIyNyA3LjQ0NjI3LC0zLjA5MjI3IDMuMDkyNTUsMCA1LjY4MDQ0LDEuMjYyNDkgNy42MzYzNiwzLjQwNzg4IGwgOS41OTMwMSwxMC40NzU5MyA5LjUyODcxLC0xMC40NzU5MyBjIDEuODkzNTQsLTIuMDgxOTUgNC42MDY3NCwtMy40MDc4OCA3LjY5ODc4LC0zLjQwNzg4IDIuOTAzNTIsMCA1LjU1NDE0LDEuMTk5MDMgNy40NDcyOSwzLjA5MjI3IHoiCiAgICAgICAgICAgc29kaXBvZGk6bm9kZXR5cGVzPSJjY2Njc2NjY3NjYyIgLz4KICAgICAgPC9nPgogICAgPC9nPgogIDwvZz4KPC9zdmc+Cg==" | base64 -d > /opt/pxstor/ui/proxmox-logo.svg
cat > /opt/pxstor/src/ui/src/App.css << 'APPCSS'
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: 'Segoe UI', sans-serif; overflow: hidden; }
APPCSS

echo "âœ“ Source code extracted"
echo ""

echo "ðŸ”¨ Building agent..."
cd /opt/pxstor/src/agent
go mod init pxstor-agent 2>/dev/null || true
go get gopkg.in/yaml.v3 >/dev/null 2>&1
go build -o /opt/pxstor/bin/pxstor-agent . 2>&1 | grep -v "go: downloading" || true

echo "ðŸ”¨ Building coordinator..."
cd /opt/pxstor/src/coordinator
go mod init pxstor-coordinator 2>/dev/null || true
go build -o /opt/pxstor/bin/pxstor-coordinator . 2>&1 | grep -v "go: downloading" || true

echo "ðŸ”¨ Building UI (this may take a minute)..."
cd /opt/pxstor/src/ui
npm install --silent >/dev/null 2>&1
npm run build --silent >/dev/null 2>&1
cp -r dist/* /opt/pxstor/ui/

echo "âœ“ Build complete"
echo ""

echo "âš™ï¸  Creating services..."
cat > /etc/systemd/system/pxstor-agent.service << 'AGENTSVC'
[Unit]
Description=pxstor agent
After=network.target
[Service]
Type=simple
User=root
WorkingDirectory=/opt/pxstor
ExecStart=/opt/pxstor/bin/pxstor-agent
Restart=always
[Install]
WantedBy=multi-user.target
AGENTSVC

cat > /etc/systemd/system/pxstor-coordinator.service << 'COORDSVC'
[Unit]
Description=pxstor coordinator
After=network.target
[Service]
Type=simple
User=root
WorkingDirectory=/opt/pxstor
ExecStart=/opt/pxstor/bin/pxstor-coordinator
Restart=always
[Install]
WantedBy=multi-user.target
COORDSVC

chown -R pxstor:pxstor /opt/pxstor

systemctl daemon-reload
systemctl enable pxstor-agent pxstor-coordinator >/dev/null 2>&1
systemctl start pxstor-agent
systemctl start pxstor-coordinator

NODE_IP=$(hostname -I | awk '{print $1}')

echo ""
echo "======================================"
echo "âœ… Installation Complete!"
echo "======================================"
echo ""
echo "ðŸŒ Access: http://$NODE_IP:8087"
echo "ðŸ”‘ Token: $TOKEN"
echo ""
echo "Services:"
echo "  systemctl status pxstor-agent"
echo "  systemctl status pxstor-coordinator"
echo ""
