#!/bin/bash
set -e

echo "======================================"
echo "Proxmox Storage Management Installer"
echo "======================================"

if [ "$EUID" -ne 0 ]; then 
   echo "âŒ Run as root: sudo bash install-standalone.sh"
   exit 1
fi

if [ ! -f /etc/pve/storage.cfg ]; then
   echo "âŒ Must run on Proxmox VE server"
   exit 1
fi

echo "âœ“ Proxmox VE detected"
echo ""

# Stop existing
systemctl stop pxstor-agent 2>/dev/null || true
systemctl stop pxstor-coordinator 2>/dev/null || true

echo "ðŸ“¦ Installing dependencies..."
apt-get update -qq >/dev/null 2>&1
apt-get install -y curl wget build-essential >/dev/null 2>&1

# Go
if ! command -v go &> /dev/null; then
    echo "ðŸ“¦ Installing Go..."
    wget -q https://go.dev/dl/go1.21.0.linux-amd64.tar.gz
    rm -rf /usr/local/go
    tar -C /usr/local -xzf go1.21.0.linux-amd64.tar.gz
    rm go1.21.0.linux-amd64.tar.gz
fi
export PATH=$PATH:/usr/local/go/bin

# Node.js
if ! command -v node &> /dev/null; then
    echo "ðŸ“¦ Installing Node.js..."
    curl -fsSL https://deb.nodesource.com/setup_20.x | bash - >/dev/null 2>&1
    apt-get install -y nodejs >/dev/null 2>&1
fi

echo "âœ“ Dependencies installed"
echo ""

echo "ðŸ“ Creating directories..."
mkdir -p /opt/pxstor/{bin,src/{agent,coordinator,ui/src},ui}
useradd -r -s /bin/false pxstor 2>/dev/null || true

# Generate token
TOKEN=9ad3bec3aa5eea7812ff261f781a03ad7eb6873e025e690e
mkdir -p /etc/pxstor
echo "token: $TOKEN" > /etc/pxstor/config.yml

echo "ðŸ“ Extracting source code..."

# Agent
echo "cGFja2FnZSBtYWluCgppbXBvcnQgKAoJImVuY29kaW5nL2pzb24iCgkiZm10IgoJImlvIgoJImxvZyIKCSJtaW1lL211bHRpcGFydCIKCSJuZXQvaHR0cCIKCSJvcyIKCSJvcy9leGVjIgoJInBhdGgvZmlsZXBhdGgiCgkic3RyaW5ncyIKCSJzdHJjb252IgoJInN5bmMiCgkidGltZSIKCSJzeXNjYWxsIgoKCSJnb3BrZy5pbi95YW1sLnYzIgopCgp0eXBlIENvbmZpZyBzdHJ1Y3QgewoJVG9rZW4gc3RyaW5nIGB5YW1sOiJ0b2tlbiJgCn0KCnR5cGUgU3RvcmFnZSBzdHJ1Y3QgewoJSUQgICBzdHJpbmcgYHlhbWw6Ii0iYAoJVHlwZSBzdHJpbmcgYHlhbWw6InR5cGUiYAoJUGF0aCBzdHJpbmcgYHlhbWw6InBhdGgiYAp9Cgp0eXBlIEpvYiBzdHJ1Y3QgewoJSUQgICAgICAgc3RyaW5nCglPcCAgICAgICBzdHJpbmcKCVN0YXR1cyAgIHN0cmluZwoJUHJvZ3Jlc3MgaW50NjQKCVRvdGFsICAgIGludDY0CglDdXJyZW50ICBzdHJpbmcKCUZhaWxlZCAgIFtdc3RyaW5nCgltdSAgICAgICBzeW5jLk11dGV4Cn0KCnR5cGUgUHJvZ3Jlc3NSZWFkZXIgc3RydWN0IHsKCXIgICBpby5SZWFkZXIKCWpvYiAqSm9iCn0KCmZ1bmMgKHByICpQcm9ncmVzc1JlYWRlcikgUmVhZChwIFtdYnl0ZSkgKGludCwgZXJyb3IpIHsKCW4sIGVyciA6PSBwci5yLlJlYWQocCkKCWlmIG4gPiAwIHsKCQlwci5qb2IubXUuTG9jaygpCgkJcHIuam9iLlByb2dyZXNzICs9IGludDY0KG4pCgkJcHIuam9iLm11LlVubG9jaygpCgl9CglyZXR1cm4gbiwgZXJyCn0KCnZhciAoCgljb25maWcgICBDb25maWcKCWpvYnMgICAgID0gbWFrZShtYXBbc3RyaW5nXSpKb2IpCglqb2JNdXRleCBzeW5jLk11dGV4CglsYXN0Q1BVVG90YWwgdWludDY0CglsYXN0Q1BVSWRsZSB1aW50NjQKCWNwdU11dGV4IHN5bmMuTXV0ZXgKKQoKZnVuYyBjb3JzTWlkZGxld2FyZShuZXh0IGh0dHAuSGFuZGxlcikgaHR0cC5IYW5kbGVyIHsKCXJldHVybiBodHRwLkhhbmRsZXJGdW5jKGZ1bmModyBodHRwLlJlc3BvbnNlV3JpdGVyLCByICpodHRwLlJlcXVlc3QpIHsKCQl3LkhlYWRlcigpLlNldCgiQWNjZXNzLUNvbnRyb2wtQWxsb3ctT3JpZ2luIiwgIioiKQoJCXcuSGVhZGVyKCkuU2V0KCJBY2Nlc3MtQ29udHJvbC1BbGxvdy1NZXRob2RzIiwgIkdFVCwgUE9TVCwgUFVULCBERUxFVEUsIE9QVElPTlMiKQoJCXcuSGVhZGVyKCkuU2V0KCJBY2Nlc3MtQ29udHJvbC1BbGxvdy1IZWFkZXJzIiwgIkNvbnRlbnQtVHlwZSwgQXV0aG9yaXphdGlvbiIpCgkJaWYgci5NZXRob2QgPT0gIk9QVElPTlMiIHsKCQkJdy5Xcml0ZUhlYWRlcihodHRwLlN0YXR1c09LKQoJCQlyZXR1cm4KCQl9CgkJbmV4dC5TZXJ2ZUhUVFAodywgcikKCX0pCn0KCmZ1bmMgYXV0aE1pZGRsZXdhcmUobmV4dCBodHRwLkhhbmRsZXJGdW5jKSBodHRwLkhhbmRsZXJGdW5jIHsKCXJldHVybiBmdW5jKHcgaHR0cC5SZXNwb25zZVdyaXRlciwgciAqaHR0cC5SZXF1ZXN0KSB7CgkJYXV0aCA6PSByLkhlYWRlci5HZXQoIkF1dGhvcml6YXRpb24iKQoJCXRva2VuIDo9IHIuVVJMLlF1ZXJ5KCkuR2V0KCJ0b2tlbiIpCgkJCgkJaWYgYXV0aCAhPSAiQmVhcmVyICIrY29uZmlnLlRva2VuICYmIHRva2VuICE9IGNvbmZpZy5Ub2tlbiB7CgkJCWh0dHAuRXJyb3IodywgIlVuYXV0aG9yaXplZCIsIGh0dHAuU3RhdHVzVW5hdXRob3JpemVkKQoJCQlyZXR1cm4KCQl9CgkJbmV4dCh3LCByKQoJfQp9CgpmdW5jIHBhcnNlU3RvcmFnZXMoKSAobWFwW3N0cmluZ11TdG9yYWdlLCBlcnJvcikgewoJZGF0YSwgZXJyIDo9IG9zLlJlYWRGaWxlKCIvZXRjL3B2ZS9zdG9yYWdlLmNmZyIpCglpZiBlcnIgIT0gbmlsIHsKCQlyZXR1cm4gbmlsLCBlcnIKCX0KCXN0b3JhZ2VzIDo9IG1ha2UobWFwW3N0cmluZ11TdG9yYWdlKQoJdmFyIGN1cnJlbnRJRCBzdHJpbmcKCWZvciBfLCBsaW5lIDo9IHJhbmdlIHN0cmluZ3MuU3BsaXQoc3RyaW5nKGRhdGEpLCAiXG4iKSB7CgkJbGluZSA9IHN0cmluZ3MuVHJpbVNwYWNlKGxpbmUpCgkJaWYgc3RyaW5ncy5IYXNQcmVmaXgobGluZSwgImRpcjoiKSB8fCBzdHJpbmdzLkhhc1ByZWZpeChsaW5lLCAibmZzOiIpIHx8IHN0cmluZ3MuSGFzUHJlZml4KGxpbmUsICJjaWZzOiIpIHx8IHN0cmluZ3MuSGFzUHJlZml4KGxpbmUsICJsdm10aGluOiIpIHsKCQkJcGFydHMgOj0gc3RyaW5ncy5GaWVsZHMobGluZSkKCQkJaWYgbGVuKHBhcnRzKSA+PSAyIHsKCQkJCWN1cnJlbnRJRCA9IHBhcnRzWzFdCgkJCQlzdG9yYWdlc1tjdXJyZW50SURdID0gU3RvcmFnZXtJRDogY3VycmVudElELCBUeXBlOiBzdHJpbmdzLlRyaW1TdWZmaXgocGFydHNbMF0sICI6Iil9CgkJCX0KCQl9IGVsc2UgaWYgc3RyaW5ncy5IYXNQcmVmaXgobGluZSwgInBhdGggIikgJiYgY3VycmVudElEICE9ICIiIHsKCQkJcyA6PSBzdG9yYWdlc1tjdXJyZW50SURdCgkJCXMuUGF0aCA9IHN0cmluZ3MuVHJpbVNwYWNlKHN0cmluZ3MuVHJpbVByZWZpeChsaW5lLCAicGF0aCIpKQoJCQlzdG9yYWdlc1tjdXJyZW50SURdID0gcwoJCX0gZWxzZSBpZiBzdHJpbmdzLkhhc1ByZWZpeChsaW5lLCAidGhpbnBvb2wgIikgJiYgY3VycmVudElEICE9ICIiIHsKCQkJcyA6PSBzdG9yYWdlc1tjdXJyZW50SURdCgkJCWlmIHMuVHlwZSA9PSAibHZtdGhpbiIgewoJCQkJcy5QYXRoID0gImx2bXRoaW46IiArIHN0cmluZ3MuVHJpbVNwYWNlKHN0cmluZ3MuVHJpbVByZWZpeChsaW5lLCAidGhpbnBvb2wiKSkKCQkJfQoJCQlzdG9yYWdlc1tjdXJyZW50SURdID0gcwoJCX0gZWxzZSBpZiBzdHJpbmdzLkhhc1ByZWZpeChsaW5lLCAidmduYW1lICIpICYmIGN1cnJlbnRJRCAhPSAiIiB7CgkJCXMgOj0gc3RvcmFnZXNbY3VycmVudElEXQoJCQlpZiBzLlR5cGUgPT0gImx2bXRoaW4iICYmIHN0cmluZ3MuSGFzUHJlZml4KHMuUGF0aCwgImx2bXRoaW46IikgewoJCQkJdmduYW1lIDo9IHN0cmluZ3MuVHJpbVNwYWNlKHN0cmluZ3MuVHJpbVByZWZpeChsaW5lLCAidmduYW1lIikpCgkJCQl0aGlucG9vbCA6PSBzdHJpbmdzLlRyaW1QcmVmaXgocy5QYXRoLCAibHZtdGhpbjoiKQoJCQkJcy5QYXRoID0gImx2bXRoaW46IiArIHZnbmFtZSArICIvIiArIHRoaW5wb29sCgkJCX0KCQkJc3RvcmFnZXNbY3VycmVudElEXSA9IHMKCQl9Cgl9CglyZXR1cm4gc3RvcmFnZXMsIG5pbAp9CgpmdW5jIGhhbmRsZVN0b3JhZ2VzKHcgaHR0cC5SZXNwb25zZVdyaXRlciwgciAqaHR0cC5SZXF1ZXN0KSB7CglzdG9yYWdlcywgZXJyIDo9IHBhcnNlU3RvcmFnZXMoKQoJaWYgZXJyICE9IG5pbCB7CgkJaHR0cC5FcnJvcih3LCBlcnIuRXJyb3IoKSwgaHR0cC5TdGF0dXNJbnRlcm5hbFNlcnZlckVycm9yKQoJCXJldHVybgoJfQoJdmFyIGxpc3QgW11TdG9yYWdlCglmb3IgXywgcyA6PSByYW5nZSBzdG9yYWdlcyB7CgkJbGlzdCA9IGFwcGVuZChsaXN0LCBzKQoJfQoJanNvbi5OZXdFbmNvZGVyKHcpLkVuY29kZShsaXN0KQp9CgpmdW5jIGhhbmRsZUNvbnRlbnQodyBodHRwLlJlc3BvbnNlV3JpdGVyLCByICpodHRwLlJlcXVlc3QpIHsKCXN0b3JhZ2UgOj0gci5VUkwuUXVlcnkoKS5HZXQoInN0b3JhZ2UiKQoJY29udGVudFR5cGUgOj0gci5VUkwuUXVlcnkoKS5HZXQoInR5cGUiKQoJc3RvcmFnZXMsIGVyciA6PSBwYXJzZVN0b3JhZ2VzKCkKCWlmIGVyciAhPSBuaWwgewoJCWh0dHAuRXJyb3IodywgZXJyLkVycm9yKCksIGh0dHAuU3RhdHVzSW50ZXJuYWxTZXJ2ZXJFcnJvcikKCQlyZXR1cm4KCX0KCXN0LCBvayA6PSBzdG9yYWdlc1tzdG9yYWdlXQoJaWYgIW9rIHsKCQlodHRwLkVycm9yKHcsICJTdG9yYWdlIG5vdCBmb3VuZCIsIGh0dHAuU3RhdHVzTm90Rm91bmQpCgkJcmV0dXJuCgl9Cgl2YXIgc3ViZGlyIHN0cmluZwoJc3dpdGNoIGNvbnRlbnRUeXBlIHsKCWNhc2UgImlzbyI6CgkJc3ViZGlyID0gInRlbXBsYXRlL2lzbyIKCWNhc2UgInZ6dG1wbCI6CgkJc3ViZGlyID0gInRlbXBsYXRlL2NhY2hlIgoJY2FzZSAiYmFja3VwIjoKCQlzdWJkaXIgPSAiZHVtcCIKCWRlZmF1bHQ6CgkJaHR0cC5FcnJvcih3LCAiSW52YWxpZCB0eXBlIiwgaHR0cC5TdGF0dXNCYWRSZXF1ZXN0KQoJCXJldHVybgoJfQoJZGlyIDo9IGZpbGVwYXRoLkpvaW4oc3QuUGF0aCwgc3ViZGlyKQoJZW50cmllcywgZXJyIDo9IG9zLlJlYWREaXIoZGlyKQoJaWYgZXJyICE9IG5pbCB7CgkJanNvbi5OZXdFbmNvZGVyKHcpLkVuY29kZShtYXBbc3RyaW5nXWludGVyZmFjZXt9eyJpdGVtcyI6IFtdc3RyaW5ne319KQoJCXJldHVybgoJfQoJdmFyIGl0ZW1zIFtdbWFwW3N0cmluZ11pbnRlcmZhY2V7fQoJZm9yIF8sIGUgOj0gcmFuZ2UgZW50cmllcyB7CgkJaWYgZS5Jc0RpcigpIHsKCQkJY29udGludWUKCQl9CgkJaW5mbywgXyA6PSBlLkluZm8oKQoJCWl0ZW1zID0gYXBwZW5kKGl0ZW1zLCBtYXBbc3RyaW5nXWludGVyZmFjZXt9ewoJCQkibmFtZSI6ICAgICAgICAgICAgZS5OYW1lKCksCgkJCSJwYXRoIjogICAgICAgICAgICBmaWxlcGF0aC5Kb2luKGRpciwgZS5OYW1lKCkpLAoJCQkic2l6ZSI6ICAgICAgICAgICAgaW5mby5TaXplKCksCgkJCSJzaXplX2Zvcm1hdHRlZCI6ICBmbXQuU3ByaW50ZigiJS4yZiBHQiIsIGZsb2F0NjQoaW5mby5TaXplKCkpLzFlOSksCgkJCSJtdGltZV9mb3JtYXR0ZWQiOiBpbmZvLk1vZFRpbWUoKS5Gb3JtYXQoIjIwMDYtMDEtMDIgMTU6MDQ6MDUiKSwKCQkJInR5cGUiOiAgICAgICAgICAgIGNvbnRlbnRUeXBlLAoJCQkic3RvcmFnZSI6ICAgICAgICAgc3RvcmFnZSwKCQl9KQoJfQoJanNvbi5OZXdFbmNvZGVyKHcpLkVuY29kZShtYXBbc3RyaW5nXWludGVyZmFjZXt9eyJpdGVtcyI6IGl0ZW1zfSkKfQoKZnVuYyBoYW5kbGVKb2JzKHcgaHR0cC5SZXNwb25zZVdyaXRlciwgciAqaHR0cC5SZXF1ZXN0KSB7Cgl2YXIgcmVxIHN0cnVjdCB7CgkJT3AgICAgIHN0cmluZyAgICAgICAgICAgICAgICAgICBganNvbjoib3AiYAoJCUl0ZW1zICBbXW1hcFtzdHJpbmddaW50ZXJmYWNle30gYGpzb246Iml0ZW1zImAKCQlUYXJnZXQgc3RydWN0IHsKCQkJU3RvcmFnZSBzdHJpbmcgYGpzb246InN0b3JhZ2UiYAoJCQlEaXIgICAgIHN0cmluZyBganNvbjoiZGlyImAKCQl9IGBqc29uOiJ0YXJnZXQiYAoJfQoJaWYgZXJyIDo9IGpzb24uTmV3RGVjb2RlcihyLkJvZHkpLkRlY29kZSgmcmVxKTsgZXJyICE9IG5pbCB7CgkJaHR0cC5FcnJvcih3LCBlcnIuRXJyb3IoKSwgaHR0cC5TdGF0dXNCYWRSZXF1ZXN0KQoJCXJldHVybgoJfQoJam9iSUQgOj0gZm10LlNwcmludGYoImpvYi0lZCIsIHRpbWUuTm93KCkuVW5peE5hbm8oKSkKCXZhciB0b3RhbFNpemUgaW50NjQKCWZvciBfLCBpdGVtIDo9IHJhbmdlIHJlcS5JdGVtcyB7CgkJaWYgc2l6ZSwgb2sgOj0gaXRlbVsic2l6ZSJdLihmbG9hdDY0KTsgb2sgewoJCQl0b3RhbFNpemUgKz0gaW50NjQoc2l6ZSkKCQl9Cgl9Cglqb2IgOj0gJkpvYnsKCQlJRDogICAgIGpvYklELAoJCU9wOiAgICAgcmVxLk9wLAoJCVN0YXR1czogInJ1bm5pbmciLAoJCVRvdGFsOiAgdG90YWxTaXplLAoJfQoJam9iTXV0ZXguTG9jaygpCglqb2JzW2pvYklEXSA9IGpvYgoJam9iTXV0ZXguVW5sb2NrKCkKCWdvIGZ1bmMoKSB7CgkJc3RvcmFnZXMsIF8gOj0gcGFyc2VTdG9yYWdlcygpCgkJdGFyZ2V0U3QgOj0gc3RvcmFnZXNbcmVxLlRhcmdldC5TdG9yYWdlXQoJCXRhcmdldEJhc2UgOj0gZmlsZXBhdGguSm9pbih0YXJnZXRTdC5QYXRoLCByZXEuVGFyZ2V0LkRpcikKCQlmb3IgXywgaXRlbSA6PSByYW5nZSByZXEuSXRlbXMgewoJCQlzcmNQYXRoIDo9IGl0ZW1bInBhdGgiXS4oc3RyaW5nKQoJCQlmaWxlTmFtZSA6PSBmaWxlcGF0aC5CYXNlKHNyY1BhdGgpCgkJCWpvYi5tdS5Mb2NrKCkKCQkJam9iLkN1cnJlbnQgPSBmaWxlTmFtZQoJCQlqb2IubXUuVW5sb2NrKCkKCQkJc3dpdGNoIHJlcS5PcCB7CgkJCWNhc2UgImNvcHkiOgoJCQkJZHN0IDo9IGZpbGVwYXRoLkpvaW4odGFyZ2V0QmFzZSwgZmlsZU5hbWUpCgkJCQlpZiBlcnIgOj0gY29weUZpbGUoc3JjUGF0aCwgZHN0LCBqb2IpOyBlcnIgIT0gbmlsIHsKCQkJCQlqb2IubXUuTG9jaygpCgkJCQkJam9iLkZhaWxlZCA9IGFwcGVuZChqb2IuRmFpbGVkLCBmaWxlTmFtZSsiOiAiK2Vyci5FcnJvcigpKQoJCQkJCWpvYi5tdS5VbmxvY2soKQoJCQkJfQoJCQljYXNlICJtb3ZlIjoKCQkJCWRzdCA6PSBmaWxlcGF0aC5Kb2luKHRhcmdldEJhc2UsIGZpbGVOYW1lKQoJCQkJaWYgZXJyIDo9IG9zLlJlbmFtZShzcmNQYXRoLCBkc3QpOyBlcnIgIT0gbmlsIHsKCQkJCQlpZiBlcnIgOj0gY29weUZpbGUoc3JjUGF0aCwgZHN0LCBqb2IpOyBlcnIgIT0gbmlsIHsKCQkJCQkJam9iLm11LkxvY2soKQoJCQkJCQlqb2IuRmFpbGVkID0gYXBwZW5kKGpvYi5GYWlsZWQsIGZpbGVOYW1lKyI6ICIrZXJyLkVycm9yKCkpCgkJCQkJCWpvYi5tdS5VbmxvY2soKQoJCQkJCX0gZWxzZSB7CgkJCQkJCW9zLlJlbW92ZShzcmNQYXRoKQoJCQkJCX0KCQkJCX0gZWxzZSB7CgkJCQkJaWYgc2l6ZSwgb2sgOj0gaXRlbVsic2l6ZSJdLihmbG9hdDY0KTsgb2sgewoJCQkJCQlqb2IubXUuTG9jaygpCgkJCQkJCWpvYi5Qcm9ncmVzcyArPSBpbnQ2NChzaXplKQoJCQkJCQlqb2IubXUuVW5sb2NrKCkKCQkJCQl9CgkJCQl9CgkJCWNhc2UgImRlbGV0ZSI6CgkJCQlpZiBlcnIgOj0gb3MuUmVtb3ZlKHNyY1BhdGgpOyBlcnIgIT0gbmlsIHsKCQkJCQlqb2IubXUuTG9jaygpCgkJCQkJam9iLkZhaWxlZCA9IGFwcGVuZChqb2IuRmFpbGVkLCBmaWxlTmFtZSsiOiAiK2Vyci5FcnJvcigpKQoJCQkJCWpvYi5tdS5VbmxvY2soKQoJCQkJfSBlbHNlIHsKCQkJCQlpZiBzaXplLCBvayA6PSBpdGVtWyJzaXplIl0uKGZsb2F0NjQpOyBvayB7CgkJCQkJCWpvYi5tdS5Mb2NrKCkKCQkJCQkJam9iLlByb2dyZXNzICs9IGludDY0KHNpemUpCgkJCQkJCWpvYi5tdS5VbmxvY2soKQoJCQkJCX0KCQkJCX0KCQkJfQoJCX0KCQlqb2IubXUuTG9jaygpCgkJaWYgbGVuKGpvYi5GYWlsZWQpID4gMCB7CgkJCWpvYi5TdGF0dXMgPSAiZmFpbGVkIgoJCX0gZWxzZSB7CgkJCWpvYi5TdGF0dXMgPSAiY29tcGxldGVkIgoJCX0KCQlqb2IubXUuVW5sb2NrKCkKCX0oKQoJanNvbi5OZXdFbmNvZGVyKHcpLkVuY29kZShtYXBbc3RyaW5nXXN0cmluZ3siam9iX2lkIjogam9iSUR9KQp9CgpmdW5jIGNvcHlGaWxlKHNyYywgZHN0IHN0cmluZywgam9iICpKb2IpIGVycm9yIHsKCXNyY0ZpbGUsIGVyciA6PSBvcy5PcGVuKHNyYykKCWlmIGVyciAhPSBuaWwgewoJCXJldHVybiBlcnIKCX0KCWRlZmVyIHNyY0ZpbGUuQ2xvc2UoKQoJZHN0RmlsZSwgZXJyIDo9IG9zLkNyZWF0ZShkc3QpCglpZiBlcnIgIT0gbmlsIHsKCQlyZXR1cm4gZXJyCgl9CglkZWZlciBkc3RGaWxlLkNsb3NlKCkKCXByIDo9ICZQcm9ncmVzc1JlYWRlcntyOiBzcmNGaWxlLCBqb2I6IGpvYn0KCV8sIGVyciA9IGlvLkNvcHkoZHN0RmlsZSwgcHIpCglyZXR1cm4gZXJyCn0KCmZ1bmMgaGFuZGxlSm9iU3RhdHVzKHcgaHR0cC5SZXNwb25zZVdyaXRlciwgciAqaHR0cC5SZXF1ZXN0KSB7Cglqb2JJRCA6PSBzdHJpbmdzLlRyaW1QcmVmaXgoci5VUkwuUGF0aCwgIi9hcGkvam9icy8iKQoJam9iTXV0ZXguTG9jaygpCglqb2IsIG9rIDo9IGpvYnNbam9iSURdCglqb2JNdXRleC5VbmxvY2soKQoJaWYgIW9rIHsKCQlodHRwLkVycm9yKHcsICJKb2Igbm90IGZvdW5kIiwgaHR0cC5TdGF0dXNOb3RGb3VuZCkKCQlyZXR1cm4KCX0KCWpvYi5tdS5Mb2NrKCkKCWRlZmVyIGpvYi5tdS5VbmxvY2soKQoJanNvbi5OZXdFbmNvZGVyKHcpLkVuY29kZShtYXBbc3RyaW5nXWludGVyZmFjZXt9ewoJCSJzdGF0dXMiOiAgIGpvYi5TdGF0dXMsCgkJInByb2dyZXNzIjogam9iLlByb2dyZXNzLAoJCSJ0b3RhbCI6ICAgIGpvYi5Ub3RhbCwKCQkiY3VycmVudCI6ICBqb2IuQ3VycmVudCwKCQkiZmFpbGVkIjogICBqb2IuRmFpbGVkLAoJfSkKfQoKZnVuYyBoYW5kbGVVcGxvYWQodyBodHRwLlJlc3BvbnNlV3JpdGVyLCByICpodHRwLlJlcXVlc3QpIHsKCXIuUGFyc2VNdWx0aXBhcnRGb3JtKDEwIDw8IDMwKQoJZmlsZSwgaGVhZGVyLCBlcnIgOj0gci5Gb3JtRmlsZSgiZmlsZSIpCglpZiBlcnIgIT0gbmlsIHsKCQlodHRwLkVycm9yKHcsIGVyci5FcnJvcigpLCBodHRwLlN0YXR1c0JhZFJlcXVlc3QpCgkJcmV0dXJuCgl9CglkZWZlciBmaWxlLkNsb3NlKCkKCXN0b3JhZ2UgOj0gci5Gb3JtVmFsdWUoInN0b3JhZ2UiKQoJY29udGVudFR5cGUgOj0gci5Gb3JtVmFsdWUoInR5cGUiKQoJc3RvcmFnZXMsIF8gOj0gcGFyc2VTdG9yYWdlcygpCglzdCA6PSBzdG9yYWdlc1tzdG9yYWdlXQoJdmFyIHN1YmRpciBzdHJpbmcKCXN3aXRjaCBjb250ZW50VHlwZSB7CgljYXNlICJpc28iOgoJCXN1YmRpciA9ICJ0ZW1wbGF0ZS9pc28iCgljYXNlICJ2enRtcGwiOgoJCXN1YmRpciA9ICJ0ZW1wbGF0ZS9jYWNoZSIKCWNhc2UgImJhY2t1cCI6CgkJc3ViZGlyID0gImR1bXAiCgl9Cglkc3RQYXRoIDo9IGZpbGVwYXRoLkpvaW4oc3QuUGF0aCwgc3ViZGlyLCBoZWFkZXIuRmlsZW5hbWUpCglqb2JJRCA6PSBmbXQuU3ByaW50Zigiam9iLSVkIiwgdGltZS5Ob3coKS5Vbml4TmFubygpKQoJam9iIDo9ICZKb2J7CgkJSUQ6ICAgICAgam9iSUQsCgkJT3A6ICAgICAgInVwbG9hZCIsCgkJU3RhdHVzOiAgInJ1bm5pbmciLAoJCVRvdGFsOiAgIGhlYWRlci5TaXplLAoJCUN1cnJlbnQ6IGhlYWRlci5GaWxlbmFtZSwKCX0KCWpvYk11dGV4LkxvY2soKQoJam9ic1tqb2JJRF0gPSBqb2IKCWpvYk11dGV4LlVubG9jaygpCglnbyBmdW5jKCkgewoJCWRhdGEsIF8gOj0gaW8uUmVhZEFsbChmaWxlLihtdWx0aXBhcnQuRmlsZSkpCgkJZHN0RmlsZSwgZXJyIDo9IG9zLkNyZWF0ZShkc3RQYXRoKQoJCWlmIGVyciAhPSBuaWwgewoJCQlqb2IubXUuTG9jaygpCgkJCWpvYi5TdGF0dXMgPSAiZmFpbGVkIgoJCQlqb2IuRmFpbGVkID0gYXBwZW5kKGpvYi5GYWlsZWQsIGVyci5FcnJvcigpKQoJCQlqb2IubXUuVW5sb2NrKCkKCQkJcmV0dXJuCgkJfQoJCWRlZmVyIGRzdEZpbGUuQ2xvc2UoKQoJCWNodW5rU2l6ZSA6PSAxMDI0ICogMTAyNAoJCWZvciBpIDo9IDA7IGkgPCBsZW4oZGF0YSk7IGkgKz0gY2h1bmtTaXplIHsKCQkJZW5kIDo9IGkgKyBjaHVua1NpemUKCQkJaWYgZW5kID4gbGVuKGRhdGEpIHsKCQkJCWVuZCA9IGxlbihkYXRhKQoJCQl9CgkJCW4sIF8gOj0gZHN0RmlsZS5Xcml0ZShkYXRhW2k6ZW5kXSkKCQkJam9iLm11LkxvY2soKQoJCQlqb2IuUHJvZ3Jlc3MgKz0gaW50NjQobikKCQkJam9iLm11LlVubG9jaygpCgkJCXRpbWUuU2xlZXAoMTAgKiB0aW1lLk1pbGxpc2Vjb25kKQoJCX0KCQlqb2IubXUuTG9jaygpCgkJam9iLlN0YXR1cyA9ICJjb21wbGV0ZWQiCgkJam9iLm11LlVubG9jaygpCgl9KCkKCWpzb24uTmV3RW5jb2Rlcih3KS5FbmNvZGUobWFwW3N0cmluZ11zdHJpbmd7ImpvYl9pZCI6IGpvYklEfSkKfQpmdW5jIGhhbmRsZURvd25sb2FkKHcgaHR0cC5SZXNwb25zZVdyaXRlciwgciAqaHR0cC5SZXF1ZXN0KSB7CglwYXRoIDo9IHIuVVJMLlF1ZXJ5KCkuR2V0KCJwYXRoIikKCWlmIHBhdGggPT0gIiIgewoJCWh0dHAuRXJyb3IodywgIk1pc3NpbmcgcGF0aCIsIGh0dHAuU3RhdHVzQmFkUmVxdWVzdCkKCQlyZXR1cm4KCX0KCQoJZmlsZSwgZXJyIDo9IG9zLk9wZW4ocGF0aCkKCWlmIGVyciAhPSBuaWwgewoJCWh0dHAuRXJyb3IodywgZXJyLkVycm9yKCksIGh0dHAuU3RhdHVzTm90Rm91bmQpCgkJcmV0dXJuCgl9CglkZWZlciBmaWxlLkNsb3NlKCkKCQoJaW5mbywgXyA6PSBmaWxlLlN0YXQoKQoJdy5IZWFkZXIoKS5TZXQoIkNvbnRlbnQtRGlzcG9zaXRpb24iLCAiYXR0YWNobWVudDsgZmlsZW5hbWU9XCIiK2ZpbGVwYXRoLkJhc2UocGF0aCkrIlwiIikKCXcuSGVhZGVyKCkuU2V0KCJDb250ZW50LVR5cGUiLCAiYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtIikKCXcuSGVhZGVyKCkuU2V0KCJDb250ZW50LUxlbmd0aCIsIGZtdC5TcHJpbnRmKCIlZCIsIGluZm8uU2l6ZSgpKSkKCQoJaW8uQ29weSh3LCBmaWxlKQp9CgoKZnVuYyBtYWluKCkgewoJZGF0YSwgZXJyIDo9IG9zLlJlYWRGaWxlKCIvZXRjL3B4c3Rvci9jb25maWcueW1sIikKCWlmIGVyciAhPSBuaWwgewoJCWxvZy5GYXRhbChlcnIpCgl9CglpZiBlcnIgOj0geWFtbC5Vbm1hcnNoYWwoZGF0YSwgJmNvbmZpZyk7IGVyciAhPSBuaWwgewoJCWxvZy5GYXRhbChlcnIpCgl9CgltdXggOj0gaHR0cC5OZXdTZXJ2ZU11eCgpCgltdXguSGFuZGxlRnVuYygiL2FwaS9zdG9yYWdlcyIsIGF1dGhNaWRkbGV3YXJlKGhhbmRsZVN0b3JhZ2VzKSkKCW11eC5IYW5kbGVGdW5jKCIvYXBpL2NvbnRlbnQiLCBhdXRoTWlkZGxld2FyZShoYW5kbGVDb250ZW50KSkKCW11eC5IYW5kbGVGdW5jKCIvYXBpL2pvYnMiLCBhdXRoTWlkZGxld2FyZShoYW5kbGVKb2JzKSkKCW11eC5IYW5kbGVGdW5jKCIvYXBpL2pvYnMvIiwgYXV0aE1pZGRsZXdhcmUoaGFuZGxlSm9iU3RhdHVzKSkKCW11eC5IYW5kbGVGdW5jKCIvYXBpL3VwbG9hZCIsIGF1dGhNaWRkbGV3YXJlKGhhbmRsZVVwbG9hZCkpCgltdXguSGFuZGxlRnVuYygiL2FwaS9kb3dubG9hZCIsIGF1dGhNaWRkbGV3YXJlKGhhbmRsZURvd25sb2FkKSkKCW11eC5IYW5kbGVGdW5jKCIvYXBpL25vZGUiLCBhdXRoTWlkZGxld2FyZShoYW5kbGVOb2RlKSkKCW11eC5IYW5kbGVGdW5jKCIvYXBpL3N0YXRzIiwgYXV0aE1pZGRsZXdhcmUoaGFuZGxlU3RhdHMpKQoJbG9nLlByaW50bG4oIkFnZW50IGxpc3RlbmluZyBvbiA6ODA4NiIpCglsb2cuRmF0YWwoaHR0cC5MaXN0ZW5BbmRTZXJ2ZSgiOjgwODYiLCBjb3JzTWlkZGxld2FyZShtdXgpKSkKfQoKZnVuYyBoYW5kbGVOb2RlKHcgaHR0cC5SZXNwb25zZVdyaXRlciwgciAqaHR0cC5SZXF1ZXN0KSB7Cglob3N0bmFtZSwgXyA6PSBvcy5Ib3N0bmFtZSgpCglqc29uLk5ld0VuY29kZXIodykuRW5jb2RlKG1hcFtzdHJpbmddc3RyaW5neyJob3N0bmFtZSI6IGhvc3RuYW1lLCAiaXAiOiByLkhvc3R9KQp9CgpmdW5jIGhhbmRsZVN0YXRzKHcgaHR0cC5SZXNwb25zZVdyaXRlciwgciAqaHR0cC5SZXF1ZXN0KSB7CgkvLyBDUFUgdXNhZ2UgKGRlbHRhLWJhc2VkIGZvciByZWFsLXRpbWUpCgljcHVEYXRhLCBfIDo9IG9zLlJlYWRGaWxlKCIvcHJvYy9zdGF0IikKCWNwdUxpbmUgOj0gc3RyaW5ncy5TcGxpdChzdHJpbmcoY3B1RGF0YSksICJcbiIpWzBdCgljcHVGaWVsZHMgOj0gc3RyaW5ncy5GaWVsZHMoY3B1TGluZSkKCXZhciBjcHVUb3RhbCwgY3B1SWRsZSB1aW50NjQKCWZvciBpIDo9IDE7IGkgPCBsZW4oY3B1RmllbGRzKSAmJiBpIDw9IDg7IGkrKyB7CgkJdmFsLCBfIDo9IHN0cmNvbnYuUGFyc2VVaW50KGNwdUZpZWxkc1tpXSwgMTAsIDY0KQoJCWNwdVRvdGFsICs9IHZhbAoJCWlmIGkgPT0gNCB7CgkJCWNwdUlkbGUgPSB2YWwKCQl9Cgl9CgljcHVVc2FnZSA6PSAwLjAKCWNwdU11dGV4LkxvY2soKQoJaWYgbGFzdENQVVRvdGFsID4gMCB7CgkJZGVsdGFUb3RhbCA6PSBjcHVUb3RhbCAtIGxhc3RDUFVUb3RhbAoJCWRlbHRhSWRsZSA6PSBjcHVJZGxlIC0gbGFzdENQVUlkbGUKCQlpZiBkZWx0YVRvdGFsID4gMCB7CgkJCWNwdVVzYWdlID0gMTAwLjAgLSAoZmxvYXQ2NChkZWx0YUlkbGUpIC8gZmxvYXQ2NChkZWx0YVRvdGFsKSAqIDEwMC4wKQoJCX0KCX0KCWxhc3RDUFVUb3RhbCA9IGNwdVRvdGFsCglsYXN0Q1BVSWRsZSA9IGNwdUlkbGUKCWNwdU11dGV4LlVubG9jaygpCgkKCS8vIE1lbW9yeQoJbWVtRGF0YSwgXyA6PSBvcy5SZWFkRmlsZSgiL3Byb2MvbWVtaW5mbyIpCgl2YXIgbWVtVG90YWwsIG1lbUF2YWlsIHVpbnQ2NAoJZm9yIF8sIGxpbmUgOj0gcmFuZ2Ugc3RyaW5ncy5TcGxpdChzdHJpbmcobWVtRGF0YSksICJcbiIpIHsKCQlpZiBzdHJpbmdzLkhhc1ByZWZpeChsaW5lLCAiTWVtVG90YWw6IikgewoJCQlmbXQuU3NjYW5mKGxpbmUsICJNZW1Ub3RhbDogJWQga0IiLCAmbWVtVG90YWwpCgkJfQoJCWlmIHN0cmluZ3MuSGFzUHJlZml4KGxpbmUsICJNZW1BdmFpbGFibGU6IikgewoJCQlmbXQuU3NjYW5mKGxpbmUsICJNZW1BdmFpbGFibGU6ICVkIGtCIiwgJm1lbUF2YWlsKQoJCX0KCX0KCW1lbVVzZWQgOj0gbWVtVG90YWwgLSBtZW1BdmFpbAoJbWVtVXNhZ2UgOj0gZmxvYXQ2NCgwKQoJaWYgbWVtVG90YWwgPiAwIHsKCQltZW1Vc2FnZSA9IGZsb2F0NjQobWVtVXNlZCkgLyBmbG9hdDY0KG1lbVRvdGFsKSAqIDEwMC4wCgl9CgkKCS8vIFN0b3JhZ2UgKHN1bSBvZiBhbGwgY29uZmlndXJlZCBzdG9yYWdlcykKCXN0b3JhZ2VzLCBfIDo9IHBhcnNlU3RvcmFnZXMoKQoJdmFyIHRvdGFsU3RvcmFnZSwgdXNlZFN0b3JhZ2UgdWludDY0Cglmb3IgXywgc3QgOj0gcmFuZ2Ugc3RvcmFnZXMgewoJCWlmIHN0LlR5cGUgPT0gImx2bXRoaW4iICYmIHN0cmluZ3MuSGFzUHJlZml4KHN0LlBhdGgsICJsdm10aGluOiIpIHsKCQkJLy8gTFZNIHRoaW4gcG9vbDogcGFyc2UgdmcvdGhpbnBvb2wgZnJvbSBwYXRoCgkJCXBhcnRzIDo9IHN0cmluZ3MuU3BsaXQoc3RyaW5ncy5UcmltUHJlZml4KHN0LlBhdGgsICJsdm10aGluOiIpLCAiLyIpCgkJCWlmIGxlbihwYXJ0cykgPT0gMiB7CgkJCQlsdnNPdXRwdXQsIGVyciA6PSBleGVjLkNvbW1hbmQoImx2cyIsICItLW5vaGVhZGluZ3MiLCAiLS11bml0cyIsICJnIiwgIi1vIiwgImx2X3NpemUsZGF0YV9wZXJjZW50IiwgcGFydHNbMF0rIi8iK3BhcnRzWzFdKS5PdXRwdXQoKQoJCQkJaWYgZXJyID09IG5pbCB7CgkJCQkJZmllbGRzIDo9IHN0cmluZ3MuRmllbGRzKHN0cmluZyhsdnNPdXRwdXQpKQoJCQkJCWlmIGxlbihmaWVsZHMpID49IDIgewoJCQkJCQlzaXplU3RyIDo9IHN0cmluZ3MuVHJpbVN1ZmZpeChmaWVsZHNbMF0sICJnIikKCQkJCQkJc2l6ZSwgXyA6PSBzdHJjb252LlBhcnNlRmxvYXQoc2l6ZVN0ciwgNjQpCgkJCQkJCWRhdGFQZXJjZW50LCBfIDo9IHN0cmNvbnYuUGFyc2VGbG9hdChmaWVsZHNbMV0sIDY0KQoJCQkJCQl0b3RhbEJ5dGVzIDo9IHVpbnQ2NChzaXplICogMTAyNCAqIDEwMjQgKiAxMDI0KQoJCQkJCQl1c2VkQnl0ZXMgOj0gdWludDY0KChzaXplICogZGF0YVBlcmNlbnQgLyAxMDAuMCkgKiAxMDI0ICogMTAyNCAqIDEwMjQpCgkJCQkJCXRvdGFsU3RvcmFnZSArPSB0b3RhbEJ5dGVzCgkJCQkJCXVzZWRTdG9yYWdlICs9IHVzZWRCeXRlcwoJCQkJCX0KCQkJCX0KCQkJfQoJCX0gZWxzZSBpZiBzdC5QYXRoICE9ICIiIHsKCQkJdmFyIHN0YXQgc3lzY2FsbC5TdGF0ZnNfdAoJCQlpZiBlcnIgOj0gc3lzY2FsbC5TdGF0ZnMoc3QuUGF0aCwgJnN0YXQpOyBlcnIgPT0gbmlsIHsKCQkJCXRvdGFsIDo9IHN0YXQuQmxvY2tzICogdWludDY0KHN0YXQuQnNpemUpCgkJCQlmcmVlIDo9IHN0YXQuQmZyZWUgKiB1aW50NjQoc3RhdC5Cc2l6ZSkKCQkJCXRvdGFsU3RvcmFnZSArPSB0b3RhbAoJCQkJdXNlZFN0b3JhZ2UgKz0gKHRvdGFsIC0gZnJlZSkKCQkJfQoJCX0KCX0KCWRpc2tVc2FnZSA6PSBmbG9hdDY0KDApCglpZiB0b3RhbFN0b3JhZ2UgPiAwIHsKCQlkaXNrVXNhZ2UgPSBmbG9hdDY0KHVzZWRTdG9yYWdlKSAvIGZsb2F0NjQodG90YWxTdG9yYWdlKSAqIDEwMC4wCgl9CgkKCS8vIERldGVybWluZSB1bml0IGR5bmFtaWNhbGx5IGJhc2VkIG9uIHRvdGFsIHN0b3JhZ2Ugc2l6ZQoJdmFyIHN0b3JhZ2VVc2VkLCBzdG9yYWdlVG90YWwgZmxvYXQ2NAoJdmFyIHN0b3JhZ2VVbml0IHN0cmluZwoJdG90YWxUaUIgOj0gZmxvYXQ2NCh0b3RhbFN0b3JhZ2UpIC8gMTAyNCAvIDEwMjQgLyAxMDI0IC8gMTAyNAoJaWYgdG90YWxUaUIgPCAxLjAgewoJCXN0b3JhZ2VVc2VkID0gZmxvYXQ2NCh1c2VkU3RvcmFnZSkgLyAxMDI0IC8gMTAyNCAvIDEwMjQKCQlzdG9yYWdlVG90YWwgPSBmbG9hdDY0KHRvdGFsU3RvcmFnZSkgLyAxMDI0IC8gMTAyNCAvIDEwMjQKCQlzdG9yYWdlVW5pdCA9ICJHaUIiCgl9IGVsc2UgewoJCXN0b3JhZ2VVc2VkID0gZmxvYXQ2NCh1c2VkU3RvcmFnZSkgLyAxMDI0IC8gMTAyNCAvIDEwMjQgLyAxMDI0CgkJc3RvcmFnZVRvdGFsID0gdG90YWxUaUIKCQlzdG9yYWdlVW5pdCA9ICJUaUIiCgl9CgkKCWpzb24uTmV3RW5jb2Rlcih3KS5FbmNvZGUobWFwW3N0cmluZ11pbnRlcmZhY2V7fXsKCQkiY3B1IjogbWFwW3N0cmluZ11pbnRlcmZhY2V7fXsKCQkJInVzYWdlIjogZm10LlNwcmludGYoIiUuMGYlJSIsIGNwdVVzYWdlKSwKCQl9LAoJCSJtZW1vcnkiOiBtYXBbc3RyaW5nXWludGVyZmFjZXt9ewoJCQkidXNlZF9nYiI6IGZtdC5TcHJpbnRmKCIlLjJmIiwgZmxvYXQ2NChtZW1Vc2VkKS8xMDI0LzEwMjQpLAoJCQkidG90YWxfZ2IiOiBmbXQuU3ByaW50ZigiJS4yZiIsIGZsb2F0NjQobWVtVG90YWwpLzEwMjQvMTAyNCksCgkJCSJ1c2FnZSI6IGZtdC5TcHJpbnRmKCIlLjBmJSUiLCBtZW1Vc2FnZSksCgkJfSwKCQkic3RvcmFnZSI6IG1hcFtzdHJpbmddaW50ZXJmYWNle317CgkJCSJ1c2VkIjogZm10LlNwcmludGYoIiUuMmYiLCBzdG9yYWdlVXNlZCksCgkJCSJ0b3RhbCI6IGZtdC5TcHJpbnRmKCIlLjJmIiwgc3RvcmFnZVRvdGFsKSwKCQkJInVuaXQiOiBzdG9yYWdlVW5pdCwKCQkJInVzYWdlIjogZm10LlNwcmludGYoIiUuMGYlJSIsIGRpc2tVc2FnZSksCgkJfSwKCX0pCn0K" | base64 -d > /opt/pxstor/src/agent/main.go

# Coordinator
echo "cGFja2FnZSBtYWluCmltcG9ydCAoCgkibG9nIgoJIm5ldC9odHRwIgoJIm5ldC9odHRwL2h0dHB1dGlsIgoJIm5ldC91cmwiCikKCmZ1bmMgbWFpbigpIHsKCXRhcmdldCwgXyA6PSB1cmwuUGFyc2UoImh0dHA6Ly9sb2NhbGhvc3Q6ODA4NiIpCglwcm94eSA6PSBodHRwdXRpbC5OZXdTaW5nbGVIb3N0UmV2ZXJzZVByb3h5KHRhcmdldCkKCQoJaHR0cC5IYW5kbGVGdW5jKCIvYXBpLyIsIGZ1bmModyBodHRwLlJlc3BvbnNlV3JpdGVyLCByICpodHRwLlJlcXVlc3QpIHsKCQlwcm94eS5TZXJ2ZUhUVFAodywgcikKCX0pCgkKCWh0dHAuSGFuZGxlKCIvIiwgaHR0cC5GaWxlU2VydmVyKGh0dHAuRGlyKCIvb3B0L3B4c3Rvci91aSIpKSkKCQoJbG9nLlByaW50bG4oIkNvb3JkaW5hdG9yIGxpc3RlbmluZyBvbiA6ODA4NyIpCglsb2cuRmF0YWwoaHR0cC5MaXN0ZW5BbmRTZXJ2ZSgiOjgwODciLCBuaWwpKQp9Cg==" | base64 -d > /opt/pxstor/src/coordinator/main.go

# UI App
echo "aW1wb3J0IHsgdXNlU3RhdGUsIHVzZUVmZmVjdCwgdXNlUmVmIH0gZnJvbSAicmVhY3QiOwppbXBvcnQgIi4vQXBwLmNzcyI7Cgpjb25zdCBBUEkgPSAiaHR0cDovLyIgKyB3aW5kb3cubG9jYXRpb24uaG9zdG5hbWUgKyAiOjgwODYiOwpjb25zdCBDT09SRElOQVRPUl9BUEkgPSAiaHR0cDovLyIgKyB3aW5kb3cubG9jYXRpb24uaG9zdG5hbWUgKyAiOjgwODciOwoKZnVuY3Rpb24gQXBwKCkgewogIGNvbnN0IFtzdG9yYWdlcywgc2V0U3RvcmFnZXNdID0gdXNlU3RhdGUoW10pOwogIGNvbnN0IFtzZWxlY3RlZCwgc2V0U2VsZWN0ZWRdID0gdXNlU3RhdGUobnVsbCk7CiAgY29uc3QgW2NvbnRlbnQsIHNldENvbnRlbnRdID0gdXNlU3RhdGUoeyBpc286IFtdLCB2enRtcGw6IFtdLCBiYWNrdXA6IFtdIH0pOwogIGNvbnN0IFt0YWIsIHNldFRhYl0gPSB1c2VTdGF0ZSgiaXNvIik7CiAgY29uc3QgW2NoZWNrZWRJdGVtcywgc2V0Q2hlY2tlZEl0ZW1zXSA9IHVzZVN0YXRlKFtdKTsKICBjb25zdCBbZHJhd2VySXRlbSwgc2V0RHJhd2VySXRlbV0gPSB1c2VTdGF0ZShudWxsKTsKICBjb25zdCBbbW9kYWxPcCwgc2V0TW9kYWxPcF0gPSB1c2VTdGF0ZShudWxsKTsKICBjb25zdCBbbW9kYWxUYXJnZXQsIHNldE1vZGFsVGFyZ2V0XSA9IHVzZVN0YXRlKCIiKTsKICBjb25zdCBbcHJvZ3Jlc3MsIHNldFByb2dyZXNzXSA9IHVzZVN0YXRlKG51bGwpOwogIGNvbnN0IFtub2RlSW5mbywgc2V0Tm9kZUluZm9dID0gdXNlU3RhdGUobnVsbCk7CiAgY29uc3QgW3N0YXRzLCBzZXRTdGF0c10gPSB1c2VTdGF0ZShudWxsKTsKICBjb25zdCBbc2VhcmNoUXVlcnksIHNldFNlYXJjaFF1ZXJ5XSA9IHVzZVN0YXRlKCIiKTsKICBjb25zdCBbc29ydEJ5LCBzZXRTb3J0QnldID0gdXNlU3RhdGUoIm5hbWUiKTsKICBjb25zdCBbc29ydERpciwgc2V0U29ydERpcl0gPSB1c2VTdGF0ZSgiYXNjIik7CiAgY29uc3QgW3Rva2VuLCBzZXRUb2tlbl0gPSB1c2VTdGF0ZSgiIik7CiAgY29uc3QgZmlsZUlucHV0UmVmID0gdXNlUmVmKG51bGwpOwoKICB1c2VFZmZlY3QoKCkgPT4gewogICAgLy8gRmV0Y2ggdG9rZW4gZnJvbSBjb29yZGluYXRvciBmaXJzdCwgd2l0aCBmYWxsYmFjawogICAgZmV0Y2goQ09PUkRJTkFUT1JfQVBJICsgIi9hcGkvY29uZmlnIikKICAgICAgLnRoZW4oKHIpID0+IHsKICAgICAgICBpZiAoIXIub2spIHRocm93IG5ldyBFcnJvcignQ29uZmlnIGVuZHBvaW50IG5vdCBhdmFpbGFibGUnKTsKICAgICAgICByZXR1cm4gci5qc29uKCk7CiAgICAgIH0pCiAgICAgIC50aGVuKChkYXRhKSA9PiB7CiAgICAgICAgc2V0VG9rZW4oZGF0YS50b2tlbik7CiAgICAgICAgcmV0dXJuIGRhdGEudG9rZW47CiAgICAgIH0pCiAgICAgIC5jYXRjaCgoZXJyKSA9PiB7CiAgICAgICAgLy8gSWYgY29uZmlnIGVuZHBvaW50IGZhaWxzLCBzaG93IGVycm9yIC0gY29vcmRpbmF0b3IgbmVlZHMgdG8gYmUgdXBkYXRlZAogICAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byBmZXRjaCBjb25maWcgZnJvbSBjb29yZGluYXRvcjonLCBlcnIpOwogICAgICAgIGFsZXJ0KCdQU00gY29uZmlndXJhdGlvbiBlcnJvci4gUGxlYXNlIGVuc3VyZSB5b3VyIFBTTSBpbnN0YWxsYXRpb24gaXMgdXAgdG8gZGF0ZS4nKTsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfSkKICAgICAgLnRoZW4oKHRrbikgPT4gewogICAgICAgIGlmICghdGtuKSByZXR1cm47IC8vIEV4aXQgaWYgdG9rZW4gZmV0Y2ggZmFpbGVkCiAgICAgICAgLy8gTG9hZCBpbml0aWFsIGRhdGEgd2l0aCB0b2tlbgogICAgICAgIGZldGNoKEFQSSArICIvYXBpL3N0b3JhZ2VzIiwgeyBoZWFkZXJzOiB7IEF1dGhvcml6YXRpb246ICJCZWFyZXIgIiArIHRrbiB9IH0pCiAgICAgICAgICAudGhlbigocikgPT4gci5qc29uKCkpCiAgICAgICAgICAudGhlbihzZXRTdG9yYWdlcykKICAgICAgICAgIC5jYXRjaChjb25zb2xlLmVycm9yKTsKCiAgICAgICAgZmV0Y2goQVBJICsgIi9hcGkvbm9kZSIsIHsgaGVhZGVyczogeyBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIgKyB0a24gfSB9KQogICAgICAgICAgLnRoZW4oKHIpID0+IHIuanNvbigpKQogICAgICAgICAgLnRoZW4oc2V0Tm9kZUluZm8pCiAgICAgICAgICAuY2F0Y2goY29uc29sZS5lcnJvcik7CgogICAgICAgIGNvbnN0IGxvYWRTdGF0cyA9ICgpID0+IHsKICAgICAgICAgIGZldGNoKEFQSSArICIvYXBpL3N0YXRzIiwgeyBoZWFkZXJzOiB7IEF1dGhvcml6YXRpb246ICJCZWFyZXIgIiArIHRrbiB9IH0pCiAgICAgICAgICAgIC50aGVuKChyKSA9PiByLmpzb24oKSkKICAgICAgICAgICAgLnRoZW4oc2V0U3RhdHMpCiAgICAgICAgICAgIC5jYXRjaChjb25zb2xlLmVycm9yKTsKICAgICAgICB9OwogICAgICAgIGxvYWRTdGF0cygpOwogICAgICAgIGNvbnN0IHN0YXRzSW50ZXJ2YWwgPSBzZXRJbnRlcnZhbChsb2FkU3RhdHMsIDIwMDApOwogICAgICAgIHJldHVybiAoKSA9PiBjbGVhckludGVydmFsKHN0YXRzSW50ZXJ2YWwpOwogICAgICB9KQogICAgICAuY2F0Y2goY29uc29sZS5lcnJvcik7CiAgfSwgW10pOwoKICBjb25zdCBsb2FkQ29udGVudCA9IChzdCkgPT4gewogICAgc2V0U2VsZWN0ZWQoc3QpOwogICAgc2V0Q2hlY2tlZEl0ZW1zKFtdKTsKICAgIFsiaXNvIiwgInZ6dG1wbCIsICJiYWNrdXAiXS5mb3JFYWNoKCh0KSA9PiB7CiAgICAgIGZldGNoKEFQSSArICIvYXBpL2NvbnRlbnQ/c3RvcmFnZT0iICsgc3QuSUQgKyAiJnR5cGU9IiArIHQsIHsKICAgICAgICBoZWFkZXJzOiB7IEF1dGhvcml6YXRpb246ICJCZWFyZXIgIiArIHRva2VuIH0sCiAgICAgIH0pCiAgICAgICAgLnRoZW4oKHIpID0+IHIuanNvbigpKQogICAgICAgIC50aGVuKChkKSA9PiBzZXRDb250ZW50KChwcmV2KSA9PiAoeyAuLi5wcmV2LCBbdF06IGQuaXRlbXMgfHwgW10gfSkpKQogICAgICAgIC5jYXRjaChjb25zb2xlLmVycm9yKTsKICAgIH0pOwogIH07CgogIGNvbnN0IHJlZnJlc2hDb250ZW50ID0gKCkgPT4gewogICAgaWYgKHNlbGVjdGVkKSBsb2FkQ29udGVudChzZWxlY3RlZCk7CiAgfTsKCiAgY29uc3QgdG9nZ2xlQ2hlY2sgPSAoaXRlbSkgPT4gewogICAgc2V0Q2hlY2tlZEl0ZW1zKChwcmV2KSA9PgogICAgICBwcmV2LmZpbmQoKHgpID0+IHgucGF0aCA9PT0gaXRlbS5wYXRoKQogICAgICAgID8gcHJldi5maWx0ZXIoKHgpID0+IHgucGF0aCAhPT0gaXRlbS5wYXRoKQogICAgICAgIDogWy4uLnByZXYsIGl0ZW1dCiAgICApOwogIH07CgogIGNvbnN0IGV4ZWN1dGVPcCA9IGFzeW5jICgpID0+IHsKICAgIGlmICghbW9kYWxPcCB8fCBjaGVja2VkSXRlbXMubGVuZ3RoID09PSAwKSByZXR1cm47CgogICAgY29uc3Qgb3BOYW1lID0gbW9kYWxPcDsKICAgIGNvbnN0IHRhcmdldFN0b3JhZ2UgPSBtb2RhbFRhcmdldDsKICAgIGNvbnN0IHRhcmdldERpciA9IHRhYiA9PT0gImlzbyIgPyAidGVtcGxhdGUvaXNvIiA6IHRhYiA9PT0gInZ6dG1wbCIgPyAidGVtcGxhdGUvY2FjaGUiIDogImR1bXAiOwoKICAgIHNldE1vZGFsT3AobnVsbCk7CiAgICBzZXRNb2RhbFRhcmdldCgiIik7CgogICAgY29uc3Qgam9iSXRlbXMgPSBjaGVja2VkSXRlbXMubWFwKChpdCkgPT4gKHsgcGF0aDogaXQucGF0aCwgc2l6ZTogaXQuc2l6ZSB9KSk7CgogICAgdHJ5IHsKICAgICAgY29uc3QgcmVzID0gYXdhaXQgZmV0Y2goQVBJICsgIi9hcGkvam9icyIsIHsKICAgICAgICBtZXRob2Q6ICJQT1NUIiwKICAgICAgICBoZWFkZXJzOiB7ICJDb250ZW50LVR5cGUiOiAiYXBwbGljYXRpb24vanNvbiIsIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIiArIHRva2VuIH0sCiAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoeyBvcDogb3BOYW1lLCBpdGVtczogam9iSXRlbXMsIHRhcmdldDogeyBzdG9yYWdlOiB0YXJnZXRTdG9yYWdlLCBkaXI6IHRhcmdldERpciB9IH0pLAogICAgICB9KTsKICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IHJlcy5qc29uKCk7CgogICAgICBpZiAoZGF0YS5qb2JfaWQpIHsKICAgICAgICBzZXRQcm9ncmVzcyh7IGpvYklkOiBkYXRhLmpvYl9pZCwgc3RhdHVzOiAicnVubmluZyIsIHByb2dyZXNzOiAwLCB0b3RhbDogMSwgY3VycmVudDogIlN0YXJ0aW5nLi4uIiwgZmFpbGVkOiBbXSB9KTsKICAgICAgICBwb2xsSm9iKGRhdGEuam9iX2lkKTsKICAgICAgfQogICAgfSBjYXRjaCAoZSkgewogICAgICBhbGVydCgiRXJyb3Igc3RhcnRpbmcgam9iOiAiICsgKGUgYXMgYW55KS5tZXNzYWdlKTsKICAgIH0KICB9OwoKICBjb25zdCBoYW5kbGVVcGxvYWQgPSBhc3luYyAoZSkgPT4gewogICAgY29uc3QgZmlsZSA9IChlLnRhcmdldCBhcyBIVE1MSW5wdXRFbGVtZW50KS5maWxlcz8uWzBdOwogICAgaWYgKCFmaWxlIHx8ICFzZWxlY3RlZCkgcmV0dXJuOwoKICAgIHNldFByb2dyZXNzKHsgam9iSWQ6ICJ1cGxvYWRpbmciLCBzdGF0dXM6ICJ1cGxvYWRpbmciLCBwcm9ncmVzczogMCwgdG90YWw6IDAsIGN1cnJlbnQ6ICJVcGxvYWRpbmcgdG8gc2VydmVyLi4uIiwgZmFpbGVkOiBbXSB9KTsKCiAgICBjb25zdCBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSgpOwogICAgZm9ybURhdGEuYXBwZW5kKCJmaWxlIiwgZmlsZSk7CiAgICBmb3JtRGF0YS5hcHBlbmQoInN0b3JhZ2UiLCAoc2VsZWN0ZWQgYXMgYW55KT8uSUQpOwogICAgZm9ybURhdGEuYXBwZW5kKCJ0eXBlIiwgdGFiKTsKCiAgICB0cnkgewogICAgICBjb25zdCByZXMgPSBhd2FpdCBmZXRjaChBUEkgKyAiL2FwaS91cGxvYWQiLCB7IG1ldGhvZDogIlBPU1QiLCBoZWFkZXJzOiB7IEF1dGhvcml6YXRpb246ICJCZWFyZXIgIiArIHRva2VuIH0sIGJvZHk6IGZvcm1EYXRhIH0pOwogICAgICBjb25zdCBkYXRhID0gYXdhaXQgcmVzLmpzb24oKTsKICAgICAgaWYgKGRhdGEuam9iX2lkKSB7CiAgICAgICAgc2V0UHJvZ3Jlc3MoeyBqb2JJZDogZGF0YS5qb2JfaWQsIHN0YXR1czogInJ1bm5pbmciLCBwcm9ncmVzczogMCwgdG90YWw6IGZpbGUuc2l6ZSwgY3VycmVudDogZmlsZS5uYW1lLCBmYWlsZWQ6IFtdIH0pOwogICAgICAgIHBvbGxKb2IoZGF0YS5qb2JfaWQpOwogICAgICB9CiAgICB9IGNhdGNoIChlKSB7CiAgICAgIHNldFByb2dyZXNzKG51bGwpOwogICAgICBhbGVydCgiVXBsb2FkIGVycm9yOiAiICsgKGUgYXMgYW55KS5tZXNzYWdlKTsKICAgIH0KICAgIChlLnRhcmdldCBhcyBIVE1MSW5wdXRFbGVtZW50KS52YWx1ZSA9ICIiOwogIH07CgogIGNvbnN0IHBvbGxKb2IgPSAoam9iSWQpID0+IHsKICAgIGNvbnN0IGludGVydmFsID0gc2V0SW50ZXJ2YWwoYXN5bmMgKCkgPT4gewogICAgICB0cnkgewogICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IGZldGNoKEFQSSArICIvYXBpL2pvYnMvIiArIGpvYklkLCB7IGhlYWRlcnM6IHsgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiICsgdG9rZW4gfSB9KTsKICAgICAgICBjb25zdCBkYXRhID0gYXdhaXQgcmVzLmpzb24oKTsKICAgICAgICBzZXRQcm9ncmVzcyh7IGpvYklkLCBzdGF0dXM6IGRhdGEuc3RhdHVzLCBwcm9ncmVzczogZGF0YS5wcm9ncmVzcywgdG90YWw6IGRhdGEudG90YWwsIGN1cnJlbnQ6IGRhdGEuY3VycmVudCB8fCAiIiwgZmFpbGVkOiBkYXRhLmZhaWxlZCB8fCBbXSB9KTsKICAgICAgICBpZiAoZGF0YS5zdGF0dXMgPT09ICJjb21wbGV0ZWQiIHx8IGRhdGEuc3RhdHVzID09PSAiZmFpbGVkIikgY2xlYXJJbnRlcnZhbChpbnRlcnZhbCk7CiAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCJQb2xsIGVycm9yOiIsIGUpOwogICAgICAgIGNsZWFySW50ZXJ2YWwoaW50ZXJ2YWwpOwogICAgICAgIHNldFByb2dyZXNzKChwcmV2KSA9PiAocHJldiA/IHsgLi4ucHJldiwgc3RhdHVzOiAiZmFpbGVkIiwgZmFpbGVkOiBbIlByb2dyZXNzIHRyYWNraW5nIGVycm9yIl0gfSA6IG51bGwpKTsKICAgICAgfQogICAgfSwgNTAwKTsKICB9OwoKICBjb25zdCBjbG9zZVByb2dyZXNzID0gKCkgPT4gewogICAgc2V0UHJvZ3Jlc3MobnVsbCk7CiAgICBpZiAoc2VsZWN0ZWQpIGxvYWRDb250ZW50KHNlbGVjdGVkKTsKICB9OwoKICBjb25zdCBkb3dubG9hZEZpbGUgPSAoaXRlbSkgPT4gewogICAgY29uc3QgbGluayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImEiKTsKICAgIGxpbmsuaHJlZiA9IEFQSSArICIvYXBpL2Rvd25sb2FkP3BhdGg9IiArIGVuY29kZVVSSUNvbXBvbmVudChpdGVtLnBhdGgpICsgIiZ0b2tlbj0iICsgdG9rZW47CiAgICBsaW5rLmRvd25sb2FkID0gaXRlbS5uYW1lOwogICAgbGluay5jbGljaygpOwogIH07CgogIGNvbnN0IHRvZ2dsZVNvcnQgPSAoZmllbGQpID0+IHsKICAgIGlmIChzb3J0QnkgPT09IGZpZWxkKSBzZXRTb3J0RGlyKHNvcnREaXIgPT09ICJhc2MiID8gImRlc2MiIDogImFzYyIpOwogICAgZWxzZSB7CiAgICAgIHNldFNvcnRCeShmaWVsZCk7CiAgICAgIHNldFNvcnREaXIoImFzYyIpOwogICAgfQogIH07CgogIGNvbnN0IHNvcnRJdGVtcyA9IChhcnIpID0+IHsKICAgIGNvbnN0IGl0ZW1zID0gWy4uLmFycl07CiAgICByZXR1cm4gaXRlbXMuc29ydCgoYSwgYikgPT4gewogICAgICBsZXQgdmFsQTogYW55LCB2YWxCOiBhbnk7CiAgICAgIGlmIChzb3J0QnkgPT09ICJuYW1lIikgewogICAgICAgIHZhbEEgPSBhLm5hbWUudG9Mb3dlckNhc2UoKTsKICAgICAgICB2YWxCID0gYi5uYW1lLnRvTG93ZXJDYXNlKCk7CiAgICAgIH0gZWxzZSBpZiAoc29ydEJ5ID09PSAic2l6ZSIpIHsKICAgICAgICB2YWxBID0gYS5zaXplOwogICAgICAgIHZhbEIgPSBiLnNpemU7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdmFsQSA9IG5ldyBEYXRlKGEubXRpbWVfZm9ybWF0dGVkKS5nZXRUaW1lKCk7CiAgICAgICAgdmFsQiA9IG5ldyBEYXRlKGIubXRpbWVfZm9ybWF0dGVkKS5nZXRUaW1lKCk7CiAgICAgIH0KICAgICAgaWYgKHZhbEEgPCB2YWxCKSByZXR1cm4gc29ydERpciA9PT0gImFzYyIgPyAtMSA6IDE7CiAgICAgIGlmICh2YWxBID4gdmFsQikgcmV0dXJuIHNvcnREaXIgPT09ICJhc2MiID8gMSA6IC0xOwogICAgICByZXR1cm4gMDsKICAgIH0pOwogIH07CgogIGNvbnN0IGl0ZW1zID0gc29ydEl0ZW1zKChjb250ZW50IGFzIGFueSlbdGFiXSB8fCBbXSkuZmlsdGVyKChpdDogYW55KSA9PiBpdC5uYW1lLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoc2VhcmNoUXVlcnkudG9Mb3dlckNhc2UoKSkpOwogIGNvbnN0IHByb2dyZXNzUGVyY2VudCA9IHByb2dyZXNzICYmIHByb2dyZXNzLnRvdGFsID4gMCA/IChwcm9ncmVzcy5wcm9ncmVzcyAvIHByb2dyZXNzLnRvdGFsKSAqIDEwMCA6IDA7CiAgY29uc3QgaXNEb25lID0gcHJvZ3Jlc3MgJiYgKHByb2dyZXNzLnN0YXR1cyA9PT0gImNvbXBsZXRlZCIgfHwgcHJvZ3Jlc3Muc3RhdHVzID09PSAiZmFpbGVkIik7CiAgY29uc3QgaXNVcGxvYWRpbmcgPSBwcm9ncmVzcyAmJiBwcm9ncmVzcy5zdGF0dXMgPT09ICJ1cGxvYWRpbmciOwoKICBjb25zdCBzb3J0SW5kaWNhdG9yID0gKGZpZWxkOiBzdHJpbmcpID0+IChzb3J0QnkgPT09IGZpZWxkID8gKHNvcnREaXIgPT09ICJhc2MiID8gIiBeIiA6ICIgdiIpIDogIiIpOwoKICByZXR1cm4gKAogICAgPGRpdiBzdHlsZT17eyBkaXNwbGF5OiAiZmxleCIsIGhlaWdodDogIjEwMHZoIiwgZm9udEZhbWlseTogIidTZWdvZSBVSScsIFRhaG9tYSwgR2VuZXZhLCBWZXJkYW5hLCBzYW5zLXNlcmlmIiwgYmFja2dyb3VuZDogIiNmYWY3ZjIiIH19PgogICAgICA8ZGl2IHN0eWxlPXt7IHdpZHRoOiAyODAsIGJhY2tncm91bmQ6ICJsaW5lYXItZ3JhZGllbnQoMTgwZGVnLCAjMmQyZDJkIDAlLCAjM2QzZDNkIDEwMCUpIiwgY29sb3I6ICIjZmZmIiwgcGFkZGluZzogIjI0cHggMTZweCIsIG92ZXJmbG93WTogImF1dG8iLCBib3hTaGFkb3c6ICI0cHggMCAyMHB4IHJnYmEoMCwwLDAsMC4xNSkiLCBib3JkZXJSaWdodDogIjFweCBzb2xpZCByZ2JhKDIyOSwgMTEyLCAwLCAwLjEpIiB9fT4KICAgICAgICA8aDIgc3R5bGU9e3sgbWFyZ2luOiAiMCAwIDIwcHggMCIsIGZvbnRTaXplOiAxNiwgZm9udFdlaWdodDogNjAwLCBsZXR0ZXJTcGFjaW5nOiAiMXB4IiwgdGV4dFRyYW5zZm9ybTogInVwcGVyY2FzZSIsIG9wYWNpdHk6IDAuOSwgYm9yZGVyQm90dG9tOiAiMnB4IHNvbGlkIHJnYmEoMjI5LCAxMTIsIDAsIDAuMykiLCBwYWRkaW5nQm90dG9tOiAxMiB9fT5TdG9yYWdlczwvaDI+CiAgICAgICAge3N0b3JhZ2VzLm1hcCgoczogYW55KSA9PiAoCiAgICAgICAgICA8ZGl2IGtleT17cy5JRH0gb25DbGljaz17KCkgPT4gbG9hZENvbnRlbnQocyl9CiAgICAgICAgICAgIHN0eWxlPXt7IHBhZGRpbmc6ICIxNHB4IDE2cHgiLCBjdXJzb3I6ICJwb2ludGVyIiwgYmFja2dyb3VuZDogc2VsZWN0ZWQ/LklEID09PSBzLklEID8gInJnYmEoMjI5LCAxMTIsIDAsIDAuMTUpIiA6ICJ0cmFuc3BhcmVudCIsIGJvcmRlclJhZGl1czogMTAsIG1hcmdpbkJvdHRvbTogMTAsIHRyYW5zaXRpb246ICJhbGwgMC4zcyBjdWJpYy1iZXppZXIoMC40LCAwLCAwLjIsIDEpIiwgYm9yZGVyOiBzZWxlY3RlZD8uSUQgPT09IHMuSUQgPyAiMnB4IHNvbGlkICNFNTcwMDAiIDogIjJweCBzb2xpZCB0cmFuc3BhcmVudCIsIHRyYW5zZm9ybTogc2VsZWN0ZWQ/LklEID09PSBzLklEID8gInRyYW5zbGF0ZVgoNHB4KSIgOiAidHJhbnNsYXRlWCgwKSIsIGJveFNoYWRvdzogc2VsZWN0ZWQ/LklEID09PSBzLklEID8gIjAgNHB4IDEycHggcmdiYSgyMjksIDExMiwgMCwgMC4yKSIgOiAibm9uZSIgfX0KICAgICAgICAgID4KICAgICAgICAgICAgPGRpdiBzdHlsZT17eyBmb250V2VpZ2h0OiA2MDAsIGZvbnRTaXplOiAxNCB9fT57cy5JRH08L2Rpdj4KICAgICAgICAgICAgPGRpdiBzdHlsZT17eyBmb250U2l6ZTogMTEsIG9wYWNpdHk6IDAuNywgbWFyZ2luVG9wOiA0IH19PntzLnR5cGV9PC9kaXY+CiAgICAgICAgICA8L2Rpdj4KICAgICAgICApKX0KICAgICAgPC9kaXY+CiAgICAgIDxkaXYgc3R5bGU9e3sgZmxleDogMSwgZGlzcGxheTogImZsZXgiLCBmbGV4RGlyZWN0aW9uOiAiY29sdW1uIiwgbWFyZ2luUmlnaHQ6IGRyYXdlckl0ZW0gPyA0MjAgOiAwLCB0cmFuc2l0aW9uOiAibWFyZ2luLXJpZ2h0IDAuNHMgY3ViaWMtYmV6aWVyKDAuNCwgMCwgMC4yLCAxKSIgfX0+CiAgICAgICAgPGRpdiBzdHlsZT17eyBiYWNrZ3JvdW5kOiAibGluZWFyLWdyYWRpZW50KDEzNWRlZywgI0U1NzAwMCAwJSwgI2ZmOGMxYSAxMDAlKSIsIHBhZGRpbmc6ICIyMHB4IDMycHgiLCBib3hTaGFkb3c6ICIwIDJweCA4cHggcmdiYSgwLDAsMCwwLjA2KSIgfX0+CiAgICAgICAgICA8ZGl2IHN0eWxlPXt7IGRpc3BsYXk6ICJmbGV4IiwgYWxpZ25JdGVtczogImNlbnRlciIsIGdhcDogMTYgfX0+CiAgICAgICAgICAgIDxpbWcgc3JjPSIvcHJveG1veC1sb2dvLnN2ZyIgYWx0PSJQcm94bW94IiBzdHlsZT17eyBoZWlnaHQ6IDUwIH19IC8+CiAgICAgICAgICAgIDxoMSBzdHlsZT17eyBtYXJnaW46IDAsIGZvbnRTaXplOiAyOCwgZm9udFdlaWdodDogNjAwLCBjb2xvcjogIiNmZmYiLCBsZXR0ZXJTcGFjaW5nOiAiMC4zcHgiIH19PlByb3htb3ggU3RvcmFnZSBNYW5hZ2VtZW50PC9oMT4KICAgICAgICAgIDwvZGl2PgogICAgICAgICAgPGRpdiBzdHlsZT17eyBkaXNwbGF5OiAiZmxleCIsIGFsaWduSXRlbXM6ICJjZW50ZXIiLCBnYXA6IDMyLCBtYXJnaW5Ub3A6IDggfX0+CiAgICAgICAgICAgIHtub2RlSW5mbyAmJiA8ZGl2IHN0eWxlPXt7IGZvbnRTaXplOiAxNCwgb3BhY2l0eTogMC45LCBmb250V2VpZ2h0OiA0MDAgfX0+Q29ubmVjdGVkIHRvIHt3aW5kb3cubG9jYXRpb24uaG9zdG5hbWV9ICh7KG5vZGVJbmZvIGFzIGFueSkuaG9zdG5hbWV9KTwvZGl2Pn0KICAgICAgICAgICAge3N0YXRzICYmICgKICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXt7IGRpc3BsYXk6ICJmbGV4IiwgZ2FwOiAyNCwgZm9udFNpemU6IDEzLCBvcGFjaXR5OiAwLjk1IH19PgogICAgICAgICAgICAgICAgPGRpdiBzdHlsZT17eyBkaXNwbGF5OiAiZmxleCIsIGFsaWduSXRlbXM6ICJjZW50ZXIiLCBnYXA6IDggfX0+PGRpdiBzdHlsZT17eyBmb250V2VpZ2h0OiA2MDAgfX0+Q1BVOjwvZGl2PjxkaXY+eyhzdGF0cyBhcyBhbnkpLmNwdS51c2FnZX08L2Rpdj48L2Rpdj4KICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9e3sgZGlzcGxheTogImZsZXgiLCBhbGlnbkl0ZW1zOiAiY2VudGVyIiwgZ2FwOiA4IH19PjxkaXYgc3R5bGU9e3sgZm9udFdlaWdodDogNjAwIH19Pk1lbW9yeTo8L2Rpdj48ZGl2Pnsoc3RhdHMgYXMgYW55KS5tZW1vcnkudXNlZF9nYn0gR0IgLyB7KHN0YXRzIGFzIGFueSkubWVtb3J5LnRvdGFsX2difSBHQiAoeyhzdGF0cyBhcyBhbnkpLm1lbW9yeS51c2FnZX0pPC9kaXY+PC9kaXY+CiAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXt7IGRpc3BsYXk6ICJmbGV4IiwgYWxpZ25JdGVtczogImNlbnRlciIsIGdhcDogOCB9fT48ZGl2IHN0eWxlPXt7IGZvbnRXZWlnaHQ6IDYwMCB9fT5TdG9yYWdlOjwvZGl2PjxkaXY+eyhzdGF0cyBhcyBhbnkpLnN0b3JhZ2UudXNlZH0geyhzdGF0cyBhcyBhbnkpLnN0b3JhZ2UudW5pdH0gLyB7KHN0YXRzIGFzIGFueSkuc3RvcmFnZS50b3RhbH0geyhzdGF0cyBhcyBhbnkpLnN0b3JhZ2UudW5pdH0gKHsoc3RhdHMgYXMgYW55KS5zdG9yYWdlLnVzYWdlfSk8L2Rpdj48L2Rpdj4KICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgKX0KICAgICAgICAgIDwvZGl2PgogICAgICAgIDwvZGl2PgogICAgICAgIHtzZWxlY3RlZCAmJiAoCiAgICAgICAgICA8ZGl2IHN0eWxlPXt7IGRpc3BsYXk6ICJmbGV4IiwgZmxleERpcmVjdGlvbjogImNvbHVtbiIsIGZsZXg6IDEgfX0+CiAgICAgICAgICAgIDxkaXYgc3R5bGU9e3sgZGlzcGxheTogImZsZXgiLCBnYXA6IDEyLCBwYWRkaW5nOiAiMTZweCAzMnB4IiwgYmFja2dyb3VuZDogIiNmZmYiLCBib3JkZXJCb3R0b206ICIxcHggc29saWQgI2U5ZWNlZiIgfX0+CiAgICAgICAgICAgICAge1siaXNvIiwgInZ6dG1wbCIsICJiYWNrdXAiXS5tYXAoKHQpID0+ICgKICAgICAgICAgICAgICAgIDxidXR0b24ga2V5PXt0fSBvbkNsaWNrPXsoKSA9PiBzZXRUYWIodCl9CiAgICAgICAgICAgICAgICAgIHN0eWxlPXt7IHBhZGRpbmc6ICIxMHB4IDIwcHgiLCBib3JkZXI6ICJub25lIiwgYmFja2dyb3VuZDogdGFiID09PSB0ID8gIiNFNTcwMDAiIDogIiNmNWYwZTgiLCBjb2xvcjogdGFiID09PSB0ID8gIiMwMDAiIDogIiMyYzNlNTAiLCBib3JkZXJSYWRpdXM6IDgsIGN1cnNvcjogInBvaW50ZXIiLCBmb250V2VpZ2h0OiA2MDAsIGZvbnRTaXplOiAxMywgdHJhbnNpdGlvbjogImFsbCAwLjNzIGVhc2UiLCB0ZXh0VHJhbnNmb3JtOiAidXBwZXJjYXNlIiwgbGV0dGVyU3BhY2luZzogIjAuNXB4IiB9fQogICAgICAgICAgICAgICAgPgogICAgICAgICAgICAgICAgICB7dCA9PT0gInZ6dG1wbCIgPyAiVGVtcGxhdGVzIiA6IHQudG9VcHBlckNhc2UoKX0KICAgICAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgICAgICAgICkpfQogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPGRpdiBzdHlsZT17eyBwYWRkaW5nOiAiMTJweCAzMnB4IiwgYmFja2dyb3VuZDogIiNmZmYiLCBib3JkZXJCb3R0b206ICIxcHggc29saWQgI2U5ZWNlZiIsIGRpc3BsYXk6ICJmbGV4IiwgZ2FwOiAxMiwgYWxpZ25JdGVtczogImNlbnRlciIgfX0+CiAgICAgICAgICAgICAgPGlucHV0IHR5cGU9InRleHQiIHBsYWNlaG9sZGVyPSJTZWFyY2ggZmlsZXMuLi4iIHZhbHVlPXtzZWFyY2hRdWVyeX0gb25DaGFuZ2U9eyhlKSA9PiBzZXRTZWFyY2hRdWVyeSgoZS50YXJnZXQgYXMgSFRNTElucHV0RWxlbWVudCkudmFsdWUpfQogICAgICAgICAgICAgICAgc3R5bGU9e3sgZmxleDogMSwgcGFkZGluZzogIjEwcHggMTRweCIsIGJvcmRlcjogIjJweCBzb2xpZCAjZTllY2VmIiwgYm9yZGVyUmFkaXVzOiA4LCBmb250U2l6ZTogMTQgfX0gLz4KICAgICAgICAgICAgICA8YnV0dG9uIG9uQ2xpY2s9e3JlZnJlc2hDb250ZW50fSBzdHlsZT17eyBwYWRkaW5nOiAiMTBweCAxNnB4IiwgYm9yZGVyOiAibm9uZSIsIGJhY2tncm91bmQ6ICIjZmY4YzFhIiwgY29sb3I6ICIjZmZmIiwgYm9yZGVyUmFkaXVzOiA4LCBjdXJzb3I6ICJwb2ludGVyIiwgZm9udFdlaWdodDogNjAwLCBmb250U2l6ZTogMTMsIHRyYW5zaXRpb246ICJ0cmFuc2Zvcm0gMC4ycyBlYXNlIiB9fQogICAgICAgICAgICAgICAgb25Nb3VzZUVudGVyPXsoZSkgPT4gKChlLmN1cnJlbnRUYXJnZXQgYXMgSFRNTEJ1dHRvbkVsZW1lbnQpLnN0eWxlLnRyYW5zZm9ybSA9ICJ0cmFuc2xhdGVZKC0ycHgpIil9CiAgICAgICAgICAgICAgICBvbk1vdXNlTGVhdmU9eyhlKSA9PiAoKGUuY3VycmVudFRhcmdldCBhcyBIVE1MQnV0dG9uRWxlbWVudCkuc3R5bGUudHJhbnNmb3JtID0gInRyYW5zbGF0ZVkoMCkiKX0KICAgICAgICAgICAgICA+CiAgICAgICAgICAgICAgICBSZWZyZXNoCiAgICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8ZGl2IHN0eWxlPXt7IHBhZGRpbmc6ICIxNnB4IDMycHgiLCBiYWNrZ3JvdW5kOiAiI2ZmZiIsIGJvcmRlckJvdHRvbTogIjFweCBzb2xpZCAjZTllY2VmIiwgZGlzcGxheTogImZsZXgiLCBnYXA6IDEyLCBhbGlnbkl0ZW1zOiAiY2VudGVyIiB9fT4KICAgICAgICAgICAgICA8aW5wdXQgcmVmPXtmaWxlSW5wdXRSZWZ9IHR5cGU9ImZpbGUiIG9uQ2hhbmdlPXtoYW5kbGVVcGxvYWR9IHN0eWxlPXt7IGRpc3BsYXk6ICJub25lIiB9fSAvPgogICAgICAgICAgICAgIDxidXR0b24gb25DbGljaz17KCkgPT4gKGZpbGVJbnB1dFJlZi5jdXJyZW50IGFzIGFueSk/LmNsaWNrKCl9IHN0eWxlPXt7IHBhZGRpbmc6ICI4cHggMThweCIsIGJvcmRlcjogIm5vbmUiLCBiYWNrZ3JvdW5kOiAiI0U1NzAwMCIsIGNvbG9yOiAiI2ZmZiIsIGJvcmRlclJhZGl1czogOCwgY3Vyc29yOiAicG9pbnRlciIsIGZvbnRXZWlnaHQ6IDYwMCwgZm9udFNpemU6IDEzLCB0cmFuc2l0aW9uOiAidHJhbnNmb3JtIDAuMnMgZWFzZSIsIGxldHRlclNwYWNpbmc6ICIwLjNweCIgfX0KICAgICAgICAgICAgICAgIG9uTW91c2VFbnRlcj17KGUpID0+ICgoZS5jdXJyZW50VGFyZ2V0IGFzIEhUTUxCdXR0b25FbGVtZW50KS5zdHlsZS50cmFuc2Zvcm0gPSAidHJhbnNsYXRlWSgtMnB4KSIpfQogICAgICAgICAgICAgICAgb25Nb3VzZUxlYXZlPXsoZSkgPT4gKChlLmN1cnJlbnRUYXJnZXQgYXMgSFRNTEJ1dHRvbkVsZW1lbnQpLnN0eWxlLnRyYW5zZm9ybSA9ICJ0cmFuc2xhdGVZKDApIil9CiAgICAgICAgICAgICAgPgogICAgICAgICAgICAgICAgVXBsb2FkIEZpbGUKICAgICAgICAgICAgICA8L2J1dHRvbj4KICAgICAgICAgICAgICA8c3BhbiBzdHlsZT17eyBmb250U2l6ZTogMTMsIGNvbG9yOiAiIzJjM2U1MCIsIGZvbnRXZWlnaHQ6IDUwMCB9fT50byB7KHNlbGVjdGVkIGFzIGFueSk/LklEfSAvIHt0YWJ9PC9zcGFuPgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAge2NoZWNrZWRJdGVtcy5sZW5ndGggPiAwICYmICgKICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXt7IHBhZGRpbmc6ICIxNHB4IDMycHgiLCBiYWNrZ3JvdW5kOiAiI2ZmZjRlNiIsIGJvcmRlckJvdHRvbTogIjFweCBzb2xpZCAjZTllY2VmIiwgZGlzcGxheTogImZsZXgiLCBnYXA6IDEyLCBhbGlnbkl0ZW1zOiAiY2VudGVyIiwgYW5pbWF0aW9uOiAic2xpZGVEb3duIDAuM3MgZWFzZSIgfX0+CiAgICAgICAgICAgICAgICA8c3BhbiBzdHlsZT17eyBmb250V2VpZ2h0OiA2MDAsIGZvbnRTaXplOiAxMywgY29sb3I6ICIjRTU3MDAwIiB9fT57Y2hlY2tlZEl0ZW1zLmxlbmd0aH0gc2VsZWN0ZWQ8L3NwYW4+CiAgICAgICAgICAgICAgICA8YnV0dG9uIG9uQ2xpY2s9eygpID0+IHsgc2V0TW9kYWxPcCgiY29weSIpOyBzZXRNb2RhbFRhcmdldCgoKHN0b3JhZ2VzIGFzIGFueSlbMF0/LklEID8/IChzZWxlY3RlZCBhcyBhbnkpPy5JRCA/PyAiIikpOyB9fSBzdHlsZT17eyBwYWRkaW5nOiAiNnB4IDE0cHgiLCBib3JkZXI6ICJub25lIiwgYmFja2dyb3VuZDogIiNFNTcwMDAiLCBjb2xvcjogIiNmZmYiLCBib3JkZXJSYWRpdXM6IDYsIGN1cnNvcjogInBvaW50ZXIiLCBmb250V2VpZ2h0OiA2MDAsIGZvbnRTaXplOiAxMiwgdHJhbnNpdGlvbjogImFsbCAwLjJzIGVhc2UiIH19PkNvcHk8L2J1dHRvbj4KICAgICAgICAgICAgICAgIDxidXR0b24gb25DbGljaz17KCkgPT4geyBzZXRNb2RhbE9wKCJtb3ZlIik7IHNldE1vZGFsVGFyZ2V0KCgoc3RvcmFnZXMgYXMgYW55KVswXT8uSUQgPz8gKHNlbGVjdGVkIGFzIGFueSk/LklEID8/ICIiKSk7IH19IHN0eWxlPXt7IHBhZGRpbmc6ICI2cHggMTRweCIsIGJvcmRlcjogIm5vbmUiLCBiYWNrZ3JvdW5kOiAiI2ZmOGMxYSIsIGNvbG9yOiAiI2ZmZiIsIGJvcmRlclJhZGl1czogNiwgY3Vyc29yOiAicG9pbnRlciIsIGZvbnRXZWlnaHQ6IDYwMCwgZm9udFNpemU6IDEyLCB0cmFuc2l0aW9uOiAiYWxsIDAuMnMgZWFzZSIgfX0+TW92ZTwvYnV0dG9uPgogICAgICAgICAgICAgICAgPGJ1dHRvbiBvbkNsaWNrPXsoKSA9PiBzZXRNb2RhbE9wKCJkZWxldGUiKX0gc3R5bGU9e3sgcGFkZGluZzogIjZweCAxNHB4IiwgYm9yZGVyOiAibm9uZSIsIGJhY2tncm91bmQ6ICIjZmY0ZDRmIiwgY29sb3I6ICIjZmZmIiwgYm9yZGVyUmFkaXVzOiA2LCBjdXJzb3I6ICJwb2ludGVyIiwgZm9udFdlaWdodDogNjAwLCBmb250U2l6ZTogMTIsIHRyYW5zaXRpb246ICJhbGwgMC4ycyBlYXNlIiB9fT5EZWxldGU8L2J1dHRvbj4KICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgKX0KICAgICAgICAgICAgPGRpdiBzdHlsZT17eyBmbGV4OiAxLCBvdmVyZmxvdzogImF1dG8iLCBwYWRkaW5nOiAzMiwgYmFja2dyb3VuZDogIiNmYWY3ZjIiIH19PgogICAgICAgICAgICAgIDxkaXYgc3R5bGU9e3sgYmFja2dyb3VuZDogIiNmZmYiLCBib3JkZXJSYWRpdXM6IDEyLCBvdmVyZmxvdzogImhpZGRlbiIsIGJveFNoYWRvdzogIjAgMnB4IDEycHggcmdiYSgwLDAsMCwwLjA0KSIgfX0+CiAgICAgICAgICAgICAgICA8dGFibGUgc3R5bGU9e3sgd2lkdGg6ICIxMDAlIiwgYm9yZGVyQ29sbGFwc2U6ICJjb2xsYXBzZSIgfX0+CiAgICAgICAgICAgICAgICAgIDx0aGVhZD4KICAgICAgICAgICAgICAgICAgICA8dHIgc3R5bGU9e3sgYmFja2dyb3VuZDogImxpbmVhci1ncmFkaWVudCgxMzVkZWcsICNFNTcwMDAgMCUsICNmZjhjMWEgMTAwJSkiLCBjb2xvcjogIiNmZmYiIH19PgogICAgICAgICAgICAgICAgICAgICAgPHRoIHN0eWxlPXt7IHBhZGRpbmc6IDE0LCB0ZXh0QWxpZ246ICJsZWZ0Iiwgd2lkdGg6IDQwLCBmb250V2VpZ2h0OiA2MDAsIGZvbnRTaXplOiAxMiB9fT48L3RoPgogICAgICAgICAgICAgICAgICAgICAgPHRoIG9uQ2xpY2s9eygpID0+IHRvZ2dsZVNvcnQoIm5hbWUiKX0gc3R5bGU9e3sgcGFkZGluZzogMTQsIHRleHRBbGlnbjogImxlZnQiLCBmb250V2VpZ2h0OiA2MDAsIGZvbnRTaXplOiAxMiwgbGV0dGVyU3BhY2luZzogIjAuNXB4IiwgY3Vyc29yOiAicG9pbnRlciIsIHVzZXJTZWxlY3Q6ICJub25lIiB9fT4KICAgICAgICAgICAgICAgICAgICAgICAgTkFNRXtzb3J0SW5kaWNhdG9yKCJuYW1lIil9CiAgICAgICAgICAgICAgICAgICAgICA8L3RoPgogICAgICAgICAgICAgICAgICAgICAgPHRoIHN0eWxlPXt7IHBhZGRpbmc6IDE0LCB0ZXh0QWxpZ246ICJsZWZ0IiwgZm9udFdlaWdodDogNjAwLCBmb250U2l6ZTogMTIsIGxldHRlclNwYWNpbmc6ICIwLjVweCIgfX0+VFlQRTwvdGg+CiAgICAgICAgICAgICAgICAgICAgICA8dGggb25DbGljaz17KCkgPT4gdG9nZ2xlU29ydCgic2l6ZSIpfSBzdHlsZT17eyBwYWRkaW5nOiAxNCwgdGV4dEFsaWduOiAibGVmdCIsIGZvbnRXZWlnaHQ6IDYwMCwgZm9udFNpemU6IDEyLCBsZXR0ZXJTcGFjaW5nOiAiMC41cHgiLCBjdXJzb3I6ICJwb2ludGVyIiwgdXNlclNlbGVjdDogIm5vbmUiIH19PgogICAgICAgICAgICAgICAgICAgICAgICBTSVpFe3NvcnRJbmRpY2F0b3IoInNpemUiKX0KICAgICAgICAgICAgICAgICAgICAgIDwvdGg+CiAgICAgICAgICAgICAgICAgICAgICA8dGggb25DbGljaz17KCkgPT4gdG9nZ2xlU29ydCgibXRpbWUiKX0gc3R5bGU9e3sgcGFkZGluZzogMTQsIHRleHRBbGlnbjogImxlZnQiLCBmb250V2VpZ2h0OiA2MDAsIGZvbnRTaXplOiAxMiwgbGV0dGVyU3BhY2luZzogIjAuNXB4IiwgY3Vyc29yOiAicG9pbnRlciIsIHVzZXJTZWxlY3Q6ICJub25lIiB9fT4KICAgICAgICAgICAgICAgICAgICAgICAgTU9ESUZJRUR7c29ydEluZGljYXRvcigibXRpbWUiKX0KICAgICAgICAgICAgICAgICAgICAgIDwvdGg+CiAgICAgICAgICAgICAgICAgICAgICA8dGggc3R5bGU9e3sgcGFkZGluZzogMTQsIHRleHRBbGlnbjogImNlbnRlciIsIGZvbnRXZWlnaHQ6IDYwMCwgZm9udFNpemU6IDEyLCBsZXR0ZXJTcGFjaW5nOiAiMC41cHgiLCB3aWR0aDogMTIwIH19PkFDVElPTlM8L3RoPgogICAgICAgICAgICAgICAgICAgIDwvdHI+CiAgICAgICAgICAgICAgICAgIDwvdGhlYWQ+CiAgICAgICAgICAgICAgICAgIDx0Ym9keT4KICAgICAgICAgICAgICAgICAgICB7aXRlbXMubWFwKChpdDogYW55LCBpZHg6IG51bWJlcikgPT4gKAogICAgICAgICAgICAgICAgICAgICAgPHRyIGtleT17aXQucGF0aH0gc3R5bGU9e3sgYm9yZGVyQm90dG9tOiAiMXB4IHNvbGlkICNmMWYzZjUiLCBjdXJzb3I6ICJwb2ludGVyIiwgdHJhbnNpdGlvbjogImJhY2tncm91bmQgMC4ycyBlYXNlIiwgYW5pbWF0aW9uOiAiZmFkZUluIDAuM3MgZWFzZSAiICsgaWR4ICogMC4wNSArICJzIGJvdGgiIH19CiAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s9eygpID0+IHNldERyYXdlckl0ZW0oaXQpfQogICAgICAgICAgICAgICAgICAgICAgICBvbk1vdXNlRW50ZXI9eyhlKSA9PiAoKGUuY3VycmVudFRhcmdldCBhcyBIVE1MVGFibGVSb3dFbGVtZW50KS5zdHlsZS5iYWNrZ3JvdW5kID0gIiNmYWY3ZjIiKX0KICAgICAgICAgICAgICAgICAgICAgICAgb25Nb3VzZUxlYXZlPXsoZSkgPT4gKChlLmN1cnJlbnRUYXJnZXQgYXMgSFRNTFRhYmxlUm93RWxlbWVudCkuc3R5bGUuYmFja2dyb3VuZCA9ICJ0cmFuc3BhcmVudCIpfQogICAgICAgICAgICAgICAgICAgICAgPgogICAgICAgICAgICAgICAgICAgICAgICA8dGQgc3R5bGU9e3sgcGFkZGluZzogMTIgfX0gb25DbGljaz17KGUpID0+IGUuc3RvcFByb3BhZ2F0aW9uKCl9PgogICAgICAgICAgICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJjaGVja2JveCIgY2hlY2tlZD17ISEoY2hlY2tlZEl0ZW1zIGFzIGFueSkuZmluZCgoeDogYW55KSA9PiB4LnBhdGggPT09IGl0LnBhdGgpfSBvbkNoYW5nZT17KCkgPT4gdG9nZ2xlQ2hlY2soaXQpfSBzdHlsZT17eyBjdXJzb3I6ICJwb2ludGVyIiwgd2lkdGg6IDE2LCBoZWlnaHQ6IDE2IH19IC8+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvdGQ+CiAgICAgICAgICAgICAgICAgICAgICAgIDx0ZCBzdHlsZT17eyBwYWRkaW5nOiAxMiwgZm9udFNpemU6IDEzLCBmb250V2VpZ2h0OiA1MDAsIGNvbG9yOiAiIzJjM2U1MCIgfX0+e2l0Lm5hbWV9PC90ZD4KICAgICAgICAgICAgICAgICAgICAgICAgPHRkIHN0eWxlPXt7IHBhZGRpbmc6IDEyLCBmb250U2l6ZTogMTIsIGNvbG9yOiAiIzM0NDk1ZSIgfX0+e2l0LnR5cGV9PC90ZD4KICAgICAgICAgICAgICAgICAgICAgICAgPHRkIHN0eWxlPXt7IHBhZGRpbmc6IDEyLCBmb250U2l6ZTogMTIsIGNvbG9yOiAiIzM0NDk1ZSIgfX0+e2l0LnNpemVfZm9ybWF0dGVkfTwvdGQ+CiAgICAgICAgICAgICAgICAgICAgICAgIDx0ZCBzdHlsZT17eyBwYWRkaW5nOiAxMiwgZm9udFNpemU6IDEyLCBjb2xvcjogIiMzNDQ5NWUiIH19PntpdC5tdGltZV9mb3JtYXR0ZWR9PC90ZD4KICAgICAgICAgICAgICAgICAgICAgICAgPHRkIHN0eWxlPXt7IHBhZGRpbmc6IDEyLCB0ZXh0QWxpZ246ICJjZW50ZXIiIH19IG9uQ2xpY2s9eyhlKSA9PiBlLnN0b3BQcm9wYWdhdGlvbigpfT4KICAgICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIG9uQ2xpY2s9eygpID0+IGRvd25sb2FkRmlsZShpdCl9IHN0eWxlPXt7IHBhZGRpbmc6ICI2cHggMTJweCIsIGJvcmRlcjogIm5vbmUiLCBiYWNrZ3JvdW5kOiAiI2ZmOGMxYSIsIGNvbG9yOiAiI2ZmZiIsIGJvcmRlclJhZGl1czogNiwgY3Vyc29yOiAicG9pbnRlciIsIGZvbnRTaXplOiAxMSwgZm9udFdlaWdodDogNjAwIH19PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgRG93bmxvYWQKICAgICAgICAgICAgICAgICAgICAgICAgICA8L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICAgICAgPC90ZD4KICAgICAgICAgICAgICAgICAgICAgIDwvdHI+CiAgICAgICAgICAgICAgICAgICAgKSl9CiAgICAgICAgICAgICAgICAgIDwvdGJvZHk+CiAgICAgICAgICAgICAgICA8L3RhYmxlPgogICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgIDwvZGl2PgogICAgICAgICl9CiAgICAgIDwvZGl2PgogICAgICB7ZHJhd2VySXRlbSAmJiAoCiAgICAgICAgPGRpdiBzdHlsZT17eyBwb3NpdGlvbjogImZpeGVkIiwgcmlnaHQ6IDAsIHRvcDogMCwgYm90dG9tOiAwLCB3aWR0aDogNDIwLCBiYWNrZ3JvdW5kOiAiI2ZmZiIsIGJveFNoYWRvdzogIi00cHggMCAyMHB4IHJnYmEoMCwwLDAsMC4xKSIsIHBhZGRpbmc6IDMyLCBvdmVyZmxvd1k6ICJhdXRvIiwgekluZGV4OiAxMDAwLCBhbmltYXRpb246ICJzbGlkZUluUmlnaHQgMC4zcyBlYXNlIiB9fT4KICAgICAgICAgIDxkaXYgc3R5bGU9e3sgZGlzcGxheTogImZsZXgiLCBqdXN0aWZ5Q29udGVudDogInNwYWNlLWJldHdlZW4iLCBhbGlnbkl0ZW1zOiAiY2VudGVyIiwgbWFyZ2luQm90dG9tOiAyOCB9fT4KICAgICAgICAgICAgPGgyIHN0eWxlPXt7IG1hcmdpbjogMCwgZm9udFNpemU6IDIyLCBmb250V2VpZ2h0OiA2MDAsIGNvbG9yOiAiIzJjM2U1MCIgfX0+RmlsZSBEZXRhaWxzPC9oMj4KICAgICAgICAgICAgPGJ1dHRvbiBvbkNsaWNrPXsoKSA9PiBzZXREcmF3ZXJJdGVtKG51bGwpfSBzdHlsZT17eyBib3JkZXI6ICJub25lIiwgYmFja2dyb3VuZDogIm5vbmUiLCBmb250U2l6ZTogMjAsIGN1cnNvcjogInBvaW50ZXIiLCBjb2xvcjogIiNhZGI1YmQiLCB0cmFuc2l0aW9uOiAiY29sb3IgMC4ycyIgfX0KICAgICAgICAgICAgICBvbk1vdXNlRW50ZXI9eyhlKSA9PiAoKGUuY3VycmVudFRhcmdldCBhcyBIVE1MQnV0dG9uRWxlbWVudCkuc3R5bGUuY29sb3IgPSAiIzJjM2U1MCIpfQogICAgICAgICAgICAgIG9uTW91c2VMZWF2ZT17KGUpID0+ICgoZS5jdXJyZW50VGFyZ2V0IGFzIEhUTUxCdXR0b25FbGVtZW50KS5zdHlsZS5jb2xvciA9ICIjYWRiNWJkIil9CiAgICAgICAgICAgID5YPC9idXR0b24+CiAgICAgICAgICA8L2Rpdj4KICAgICAgICAgIDxkaXYgc3R5bGU9e3sgZGlzcGxheTogImZsZXgiLCBmbGV4RGlyZWN0aW9uOiAiY29sdW1uIiwgZ2FwOiAyMCB9fT4KICAgICAgICAgICAgPGRpdiBzdHlsZT17eyBwYWRkaW5nOiAxNiwgYmFja2dyb3VuZDogIiNmYWY3ZjIiLCBib3JkZXJSYWRpdXM6IDgsIGJvcmRlckxlZnQ6ICI0cHggc29saWQgI0U1NzAwMCIgfX0+CiAgICAgICAgICAgICAgPGRpdiBzdHlsZT17eyBmb250U2l6ZTogMTEsIGZvbnRXZWlnaHQ6IDYwMCwgY29sb3I6ICIjYWRiNWJkIiwgbWFyZ2luQm90dG9tOiA2LCB0ZXh0VHJhbnNmb3JtOiAidXBwZXJjYXNlIiwgbGV0dGVyU3BhY2luZzogIjAuNXB4IiB9fT5OYW1lPC9kaXY+CiAgICAgICAgICAgICAgPGRpdiBzdHlsZT17eyBmb250U2l6ZTogMTQsIGZvbnRXZWlnaHQ6IDUwMCwgY29sb3I6ICIjMmMzZTUwIiwgd29yZEJyZWFrOiAiYnJlYWstYWxsIiB9fT57KGRyYXdlckl0ZW0gYXMgYW55KS5uYW1lfTwvZGl2PgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPGRpdiBzdHlsZT17eyBwYWRkaW5nOiAxNiwgYmFja2dyb3VuZDogIiNmYWY3ZjIiLCBib3JkZXJSYWRpdXM6IDgsIGJvcmRlckxlZnQ6ICI0cHggc29saWQgI2YwZTZkNiIgfX0+CiAgICAgICAgICAgICAgPGRpdiBzdHlsZT17eyBmb250U2l6ZTogMTEsIGZvbnRXZWlnaHQ6IDYwMCwgY29sb3I6ICIjYWRiNWJkIiwgbWFyZ2luQm90dG9tOiA2LCB0ZXh0VHJhbnNmb3JtOiAidXBwZXJjYXNlIiwgbGV0dGVyU3BhY2luZzogIjAuNXB4IiB9fT5UeXBlPC9kaXY+CiAgICAgICAgICAgICAgPGRpdiBzdHlsZT17eyBmb250U2l6ZTogMTQsIGZvbnRXZWlnaHQ6IDUwMCwgY29sb3I6ICIjMmMzZTUwIiB9fT57KGRyYXdlckl0ZW0gYXMgYW55KS50eXBlfTwvZGl2PgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPGRpdiBzdHlsZT17eyBwYWRkaW5nOiAxNiwgYmFja2dyb3VuZDogIiNmYWY3ZjIiLCBib3JkZXJSYWRpdXM6IDgsIGJvcmRlckxlZnQ6ICI0cHggc29saWQgI0U1NzAwMCIgfX0+CiAgICAgICAgICAgICAgPGRpdiBzdHlsZT17eyBmb250U2l6ZTogMTEsIGZvbnRXZWlnaHQ6IDYwMCwgY29sb3I6ICIjYWRiNWJkIiwgbWFyZ2luQm90dG9tOiA2LCB0ZXh0VHJhbnNmb3JtOiAidXBwZXJjYXNlIiwgbGV0dGVyU3BhY2luZzogIjAuNXB4IiB9fT5TaXplPC9kaXY+CiAgICAgICAgICAgICAgPGRpdiBzdHlsZT17eyBmb250U2l6ZTogMTQsIGZvbnRXZWlnaHQ6IDUwMCwgY29sb3I6ICIjMmMzZTUwIiB9fT57KGRyYXdlckl0ZW0gYXMgYW55KS5zaXplX2Zvcm1hdHRlZH08L2Rpdj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDxkaXYgc3R5bGU9e3sgcGFkZGluZzogMTYsIGJhY2tncm91bmQ6ICIjZmFmN2YyIiwgYm9yZGVyUmFkaXVzOiA4LCBib3JkZXJMZWZ0OiAiNHB4IHNvbGlkICNmMGU2ZDYiIH19PgogICAgICAgICAgICAgIDxkaXYgc3R5bGU9e3sgZm9udFNpemU6IDExLCBmb250V2VpZ2h0OiA2MDAsIGNvbG9yOiAiI2FkYjViZCIsIG1hcmdpbkJvdHRvbTogNiwgdGV4dFRyYW5zZm9ybTogInVwcGVyY2FzZSIsIGxldHRlclNwYWNpbmc6ICIwLjVweCIgfX0+TW9kaWZpZWQ8L2Rpdj4KICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXt7IGZvbnRTaXplOiAxNCwgZm9udFdlaWdodDogNTAwLCBjb2xvcjogIiMyYzNlNTAiIH19PnsoZHJhd2VySXRlbSBhcyBhbnkpLm10aW1lX2Zvcm1hdHRlZH08L2Rpdj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDxkaXYgc3R5bGU9e3sgcGFkZGluZzogMTYsIGJhY2tncm91bmQ6ICIjZmFmN2YyIiwgYm9yZGVyUmFkaXVzOiA4LCBib3JkZXJMZWZ0OiAiNHB4IHNvbGlkICNFNTcwMDAiIH19PgogICAgICAgICAgICAgIDxkaXYgc3R5bGU9e3sgZm9udFNpemU6IDExLCBmb250V2VpZ2h0OiA2MDAsIGNvbG9yOiAiI2FkYjViZCIsIG1hcmdpbkJvdHRvbTogNiwgdGV4dFRyYW5zZm9ybTogInVwcGVyY2FzZSIsIGxldHRlclNwYWNpbmc6ICIwLjVweCIgfX0+UGF0aDwvZGl2PgogICAgICAgICAgICAgIDxkaXYgc3R5bGU9e3sgZm9udFNpemU6IDEzLCBmb250V2VpZ2h0OiA0MDAsIGNvbG9yOiAiIzM0NDk1ZSIsIHdvcmRCcmVhazogImJyZWFrLWFsbCIsIGZvbnRGYW1pbHk6ICJtb25vc3BhY2UiIH19PnsoZHJhd2VySXRlbSBhcyBhbnkpLnBhdGh9PC9kaXY+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8ZGl2IHN0eWxlPXt7IHBhZGRpbmc6IDE2LCBiYWNrZ3JvdW5kOiAiI2ZhZjdmMiIsIGJvcmRlclJhZGl1czogOCwgYm9yZGVyTGVmdDogIjRweCBzb2xpZCAjZjBlNmQ2IiB9fT4KICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXt7IGZvbnRTaXplOiAxMSwgZm9udFdlaWdodDogNjAwLCBjb2xvcjogIiNhZGI1YmQiLCBtYXJnaW5Cb3R0b206IDYsIHRleHRUcmFuc2Zvcm06ICJ1cHBlcmNhc2UiLCBsZXR0ZXJTcGFjaW5nOiAiMC41cHgiIH19PlN0b3JhZ2U8L2Rpdj4KICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXt7IGZvbnRTaXplOiAxNCwgZm9udFdlaWdodDogNTAwLCBjb2xvcjogIiMyYzNlNTAiIH19PnsoZHJhd2VySXRlbSBhcyBhbnkpLnN0b3JhZ2V9PC9kaXY+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgPC9kaXY+CiAgICAgICAgPC9kaXY+CiAgICAgICl9CgogICAgICB7bW9kYWxPcCAmJiAoCiAgICAgICAgPGRpdiBzdHlsZT17eyBwb3NpdGlvbjogImZpeGVkIiwgaW5zZXQ6IDAsIGJhY2tncm91bmQ6ICJyZ2JhKDAsMCwwLDAuNSkiLCBkaXNwbGF5OiAiZmxleCIsIGFsaWduSXRlbXM6ICJjZW50ZXIiLCBqdXN0aWZ5Q29udGVudDogImNlbnRlciIsIHpJbmRleDogMjAwMCwgYmFja2Ryb3BGaWx0ZXI6ICJibHVyKDRweCkiIH19PgogICAgICAgICAgPGRpdiBzdHlsZT17eyBiYWNrZ3JvdW5kOiAiI2ZmZiIsIHBhZGRpbmc6IDM2LCBib3JkZXJSYWRpdXM6IDE2LCBtaW5XaWR0aDogNDQwLCBib3hTaGFkb3c6ICIwIDIwcHggNjBweCByZ2JhKDAsMCwwLDAuMykiIH19PgogICAgICAgICAgICA8aDIgc3R5bGU9e3sgbWFyZ2luOiAiMCAwIDI0cHggMCIsIGZvbnRTaXplOiAyMiwgZm9udFdlaWdodDogNjAwLCBjb2xvcjogIiMyYzNlNTAiIH19Pnttb2RhbE9wID09PSAiZGVsZXRlIiA/ICJEZWxldGUgRmlsZXMiIDogbW9kYWxPcCA9PT0gImNvcHkiID8gIkNvcHkgRmlsZXMiIDogIk1vdmUgRmlsZXMifTwvaDI+CiAgICAgICAgICAgIHttb2RhbE9wICE9PSAiZGVsZXRlIiAmJiAoCiAgICAgICAgICAgICAgPGRpdiBzdHlsZT17eyBtYXJnaW5Cb3R0b206IDI0IH19PgogICAgICAgICAgICAgICAgPGxhYmVsIHN0eWxlPXt7IGRpc3BsYXk6ICJibG9jayIsIG1hcmdpbkJvdHRvbTogMTAsIGZvbnRTaXplOiAxMywgZm9udFdlaWdodDogNjAwLCBjb2xvcjogIiMzNDQ5NWUiIH19PlRhcmdldCBTdG9yYWdlOjwvbGFiZWw+CiAgICAgICAgICAgICAgICA8c2VsZWN0IHZhbHVlPXttb2RhbFRhcmdldH0gb25DaGFuZ2U9eyhlKSA9PiBzZXRNb2RhbFRhcmdldCgoZS50YXJnZXQgYXMgSFRNTFNlbGVjdEVsZW1lbnQpLnZhbHVlKX0gc3R5bGU9e3sgd2lkdGg6ICIxMDAlIiwgcGFkZGluZzogIjEwcHggMTJweCIsIGJvcmRlcjogIjJweCBzb2xpZCAjZTllY2VmIiwgYm9yZGVyUmFkaXVzOiA4LCBmb250U2l6ZTogMTQgfX0+CiAgICAgICAgICAgICAgICAgIHtzdG9yYWdlcy5tYXAoKHM6IGFueSkgPT4gKAogICAgICAgICAgICAgICAgICAgIDxvcHRpb24ga2V5PXtzLklEfSB2YWx1ZT17cy5JRH0+e3MuSUR9PC9vcHRpb24+CiAgICAgICAgICAgICAgICAgICkpfQogICAgICAgICAgICAgICAgPC9zZWxlY3Q+CiAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICl9CiAgICAgICAgICAgIDxkaXYgc3R5bGU9e3sgZGlzcGxheTogImZsZXgiLCBnYXA6IDEyLCBqdXN0aWZ5Q29udGVudDogImZsZXgtZW5kIiB9fT4KICAgICAgICAgICAgICA8YnV0dG9uIG9uQ2xpY2s9e2V4ZWN1dGVPcH0gc3R5bGU9e3sgcGFkZGluZzogIjEwcHggMjRweCIsIGJvcmRlcjogIm5vbmUiLCBiYWNrZ3JvdW5kOiAiI0U1NzAwMCIsIGNvbG9yOiAiI2ZmZiIsIGJvcmRlclJhZGl1czogOCwgY3Vyc29yOiAicG9pbnRlciIsIGZvbnRXZWlnaHQ6IDYwMCwgZm9udFNpemU6IDE0IH19PkV4ZWN1dGU8L2J1dHRvbj4KICAgICAgICAgICAgICA8YnV0dG9uIG9uQ2xpY2s9eygpID0+IHsgc2V0TW9kYWxPcChudWxsKTsgc2V0TW9kYWxUYXJnZXQoIiIpOyB9fSBzdHlsZT17eyBwYWRkaW5nOiAiMTBweCAyNHB4IiwgYm9yZGVyOiAiMnB4IHNvbGlkICNlOWVjZWYiLCBiYWNrZ3JvdW5kOiAiI2ZmZiIsIGJvcmRlclJhZGl1czogOCwgY3Vyc29yOiAicG9pbnRlciIsIGZvbnRXZWlnaHQ6IDYwMCwgZm9udFNpemU6IDE0LCBjb2xvcjogIiMzNDQ5NWUiIH19PkNhbmNlbDwvYnV0dG9uPgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgIDwvZGl2PgogICAgICAgIDwvZGl2PgogICAgICApfQoKICAgICAge3Byb2dyZXNzICYmICgKICAgICAgICA8ZGl2IHN0eWxlPXt7IHBvc2l0aW9uOiAiZml4ZWQiLCBpbnNldDogMCwgYmFja2dyb3VuZDogInJnYmEoMCwwLDAsMC42KSIsIGRpc3BsYXk6ICJmbGV4IiwgYWxpZ25JdGVtczogImNlbnRlciIsIGp1c3RpZnlDb250ZW50OiAiY2VudGVyIiwgekluZGV4OiAzMDAwLCBiYWNrZHJvcEZpbHRlcjogImJsdXIoNnB4KSIsIGFuaW1hdGlvbjogImZhZGVJbiAwLjJzIGVhc2UiIH19PgogICAgICAgICAgPGRpdiBzdHlsZT17eyBiYWNrZ3JvdW5kOiAiI2ZmZiIsIHBhZGRpbmc6IDQ0LCBib3JkZXJSYWRpdXM6IDIwLCBtaW5XaWR0aDogNTQwLCBib3hTaGFkb3c6ICIwIDI1cHggODBweCByZ2JhKDAsMCwwLDAuNCkiLCBhbmltYXRpb246ICJzY2FsZUluIDAuM3MgZWFzZSIgfX0+CiAgICAgICAgICAgIDxoMiBzdHlsZT17eyBtYXJnaW46IDAsIG1hcmdpbkJvdHRvbTogMjQsIHRleHRBbGlnbjogImNlbnRlciIsIGZvbnRTaXplOiAyNCwgZm9udFdlaWdodDogNjAwLCBjb2xvcjogcHJvZ3Jlc3Muc3RhdHVzID09PSAiY29tcGxldGVkIiA/ICIjMmY5ZTQ0IiA6IHByb2dyZXNzLnN0YXR1cyA9PT0gImZhaWxlZCIgPyAiI2ZmNGQ0ZiIgOiAiI0U1NzAwMCIgfX0+CiAgICAgICAgICAgICAge3Byb2dyZXNzLnN0YXR1cyA9PT0gImNvbXBsZXRlZCIgPyAiQ29tcGxldGVkISIgOiBwcm9ncmVzcy5zdGF0dXMgPT09ICJmYWlsZWQiID8gIkZhaWxlZCIgOiBpc1VwbG9hZGluZyA/ICJVcGxvYWRpbmcuLi4iIDogIlByb2Nlc3NpbmcuLi4ifQogICAgICAgICAgICA8L2gyPgogICAgICAgICAgICA8ZGl2IHN0eWxlPXt7IG1hcmdpbkJvdHRvbTogMjAsIGZvbnRTaXplOiAxNCwgY29sb3I6ICIjMzQ0OTVlIiwgdGV4dEFsaWduOiAiY2VudGVyIiwgbWluSGVpZ2h0OiAyMCwgZm9udFdlaWdodDogNTAwIH19Pntwcm9ncmVzcy5jdXJyZW50fTwvZGl2PgogICAgICAgICAgICB7IWlzVXBsb2FkaW5nICYmICgKICAgICAgICAgICAgICA8ZGl2PgogICAgICAgICAgICAgICAgPGRpdiBzdHlsZT17eyBiYWNrZ3JvdW5kOiAiI2YxZjNmNSIsIGJvcmRlclJhZGl1czogMTIsIGhlaWdodDogMzYsIG92ZXJmbG93OiAiaGlkZGVuIiwgbWFyZ2luQm90dG9tOiAxNCwgYm94U2hhZG93OiAiaW5zZXQgMCAycHggNHB4IHJnYmEoMCwwLDAsMC4wNikiIH19PgogICAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXt7IGJhY2tncm91bmQ6IHByb2dyZXNzLnN0YXR1cyA9PT0gImZhaWxlZCIgPyAibGluZWFyLWdyYWRpZW50KDkwZGVnLCAjZmY0ZDRmLCAjZmY3ODc1KSIgOiAibGluZWFyLWdyYWRpZW50KDkwZGVnLCAjRTU3MDAwLCAjZmY4YzFhKSIsIGhlaWdodDogIjEwMCUiLCB3aWR0aDogcHJvZ3Jlc3NQZXJjZW50ICsgIiUiLCB0cmFuc2l0aW9uOiAid2lkdGggMC40cyBjdWJpYy1iZXppZXIoMC40LCAwLCAwLjIsIDEpIiwgZGlzcGxheTogImZsZXgiLCBhbGlnbkl0ZW1zOiAiY2VudGVyIiwganVzdGlmeUNvbnRlbnQ6ICJjZW50ZXIiLCBjb2xvcjogIiNmZmYiLCBmb250V2VpZ2h0OiA3MDAsIGZvbnRTaXplOiAxNCwgbWluV2lkdGg6IHByb2dyZXNzUGVyY2VudCA+IDAgPyAiNjBweCIgOiAiMCIsIGJveFNoYWRvdzogIjAgMnB4IDhweCByZ2JhKDIyOSwgMTEyLCAwLCAwLjQpIiB9fT4KICAgICAgICAgICAgICAgICAgICB7TWF0aC5yb3VuZChwcm9ncmVzc1BlcmNlbnQpfSUKICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9e3sgdGV4dEFsaWduOiAiY2VudGVyIiwgZm9udFNpemU6IDEzLCBjb2xvcjogIiNhZGI1YmQiLCBtYXJnaW5Cb3R0b206IDI0LCBmb250V2VpZ2h0OiA1MDAgfX0+CiAgICAgICAgICAgICAgICAgIHsocHJvZ3Jlc3MucHJvZ3Jlc3MgLyAxZTkpLnRvRml4ZWQoMil9IEdCIC8geyhwcm9ncmVzcy50b3RhbCAvIDFlOSkudG9GaXhlZCgyKX0gR0IKICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICApfQogICAgICAgICAgICB7cHJvZ3Jlc3MuZmFpbGVkICYmIHByb2dyZXNzLmZhaWxlZC5sZW5ndGggPiAwICYmICgKICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXt7IGJhY2tncm91bmQ6ICIjZmZmNWY1IiwgYm9yZGVyOiAiMXB4IHNvbGlkICNmZjRkNGYiLCBwYWRkaW5nOiAxNCwgYm9yZGVyUmFkaXVzOiAxMCwgbWFyZ2luQm90dG9tOiAyNCwgZm9udFNpemU6IDEyLCBtYXhIZWlnaHQ6IDEyMCwgb3ZlcmZsb3c6ICJhdXRvIiB9fT4KICAgICAgICAgICAgICAgIDxzdHJvbmcgc3R5bGU9e3sgY29sb3I6ICIjZDYzMDMxIiB9fT5FcnJvcnM6PC9zdHJvbmc+CiAgICAgICAgICAgICAgICA8dWwgc3R5bGU9e3sgbWFyZ2luOiAiOHB4IDAgMCAwIiwgcGFkZGluZ0xlZnQ6IDIwLCBjb2xvcjogIiMzNDQ5NWUiIH19PgogICAgICAgICAgICAgICAgICB7cHJvZ3Jlc3MuZmFpbGVkLm1hcCgoZiwgaSkgPT4gKAogICAgICAgICAgICAgICAgICAgIDxsaSBrZXk9e2l9IHN0eWxlPXt7IG1hcmdpbkJvdHRvbTogNCB9fT57Zn08L2xpPgogICAgICAgICAgICAgICAgICApKX0KICAgICAgICAgICAgICAgIDwvdWw+CiAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICl9CiAgICAgICAgICAgIHtpc0RvbmUgJiYgKAogICAgICAgICAgICAgIDxkaXYgc3R5bGU9e3sgdGV4dEFsaWduOiAiY2VudGVyIiB9fT4KICAgICAgICAgICAgICAgIDxidXR0b24gb25DbGljaz17Y2xvc2VQcm9ncmVzc30gc3R5bGU9e3sgcGFkZGluZzogIjEycHggMzZweCIsIGJvcmRlcjogIm5vbmUiLCBiYWNrZ3JvdW5kOiAiI0U1NzAwMCIsIGNvbG9yOiAiI2ZmZiIsIGJvcmRlclJhZGl1czogMTAsIGN1cnNvcjogInBvaW50ZXIiLCBmb250U2l6ZTogMTYsIGZvbnRXZWlnaHQ6IDcwMCwgdHJhbnNpdGlvbjogInRyYW5zZm9ybSAwLjJzIiwgYm94U2hhZG93OiAiMCA0cHggMTJweCByZ2JhKDIyOSwgMTEyLCAwLCAwLjQpIiB9fQogICAgICAgICAgICAgICAgICBvbk1vdXNlRW50ZXI9eyhlKSA9PiAoKGUuY3VycmVudFRhcmdldCBhcyBIVE1MQnV0dG9uRWxlbWVudCkuc3R5bGUudHJhbnNmb3JtID0gInRyYW5zbGF0ZVkoLTJweCkiKX0KICAgICAgICAgICAgICAgICAgb25Nb3VzZUxlYXZlPXsoZSkgPT4gKChlLmN1cnJlbnRUYXJnZXQgYXMgSFRNTEJ1dHRvbkVsZW1lbnQpLnN0eWxlLnRyYW5zZm9ybSA9ICJ0cmFuc2xhdGVZKDApIil9CiAgICAgICAgICAgICAgICA+CiAgICAgICAgICAgICAgICAgIE9LCiAgICAgICAgICAgICAgICA8L2J1dHRvbj4KICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgKX0KICAgICAgICAgIDwvZGl2PgogICAgICAgIDwvZGl2PgogICAgICApfQogICAgICA8c3R5bGU+e2AKICAgICAgICBAbWVkaWEgKG1heC13aWR0aDogNzY4cHgpIHsKICAgICAgICAgIGJvZHkgeyBmb250LXNpemU6IDE0cHg7IH0KICAgICAgICAgIGgxIHsgZm9udC1zaXplOiAyMHB4ICFpbXBvcnRhbnQ7IH0KICAgICAgICAgIC5zaWRlYmFyIHsgd2lkdGg6IDIwMHB4ICFpbXBvcnRhbnQ7IH0KICAgICAgICB9CiAgICAgICAgQGtleWZyYW1lcyBmYWRlSW4geyBmcm9tIHsgb3BhY2l0eTogMDsgfSB0byB7IG9wYWNpdHk6IDE7IH0gfQogICAgICAgIEBrZXlmcmFtZXMgc2NhbGVJbiB7IGZyb20geyB0cmFuc2Zvcm06IHNjYWxlKDAuOSk7IG9wYWNpdHk6IDA7IH0gdG8geyB0cmFuc2Zvcm06IHNjYWxlKDEpOyBvcGFjaXR5OiAxOyB9IH0KICAgICAgICBAa2V5ZnJhbWVzIHNsaWRlSW5SaWdodCB7IGZyb20geyB0cmFuc2Zvcm06IHRyYW5zbGF0ZVgoMTAwJSk7IH0gdG8geyB0cmFuc2Zvcm06IHRyYW5zbGF0ZVgoMCk7IH0gfQogICAgICAgIEBrZXlmcmFtZXMgc2xpZGVEb3duIHsgZnJvbSB7IHRyYW5zZm9ybTogdHJhbnNsYXRlWSgtMTBweCk7IG9wYWNpdHk6IDA7IH0gdG8geyB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoMCk7IG9wYWNpdHk6IDE7IH0gfQogICAgICBgfTwvc3R5bGU+CiAgICA8L2Rpdj4KICApOwp9CgpleHBvcnQgZGVmYXVsdCBBcHA7Cg==" | base64 -d > /opt/pxstor/src/ui/src/App.tsx

# UI package.json
cat > /opt/pxstor/src/ui/package.json << 'PKGJSON'
{
  "name": "pxstor-ui",
  "private": true,
  "version": "1.0.0",
  "type": "module",
  "scripts": {
    "build": "vite build"
  },
  "dependencies": {
    "react": "^18.2.0",
    "react-dom": "^18.2.0"
  },
  "devDependencies": {
    "@types/react": "^18.2.43",
    "@types/react-dom": "^18.2.17",
    "@vitejs/plugin-react": "^4.2.1",
    "vite": "^5.0.8"
  }
}
PKGJSON

# UI vite.config.js
cat > /opt/pxstor/src/ui/vite.config.js << 'VITEJS'
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'
export default defineConfig({
  plugins: [react()],
  build: { outDir: 'dist', emptyOutDir: true },
})
VITEJS

# UI index.html
cat > /opt/pxstor/src/ui/index.html << 'INDEXHTML'
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PSM</title>
    <link rel= icon href=/proxmox-logo.svg type=image/svg+xml>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>
  </body>
</html>
INDEXHTML

# UI main.jsx
cat > /opt/pxstor/src/ui/src/main.jsx << 'MAINJSX'
import React from 'react'
import ReactDOM from 'react-dom/client'
import App from './App'
ReactDOM.createRoot(document.getElementById('root')).render(<React.StrictMode><App /></React.StrictMode>)
MAINJSX

# UI App.css

# UI Proxmox logo
echo "PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjxzdmcKICAgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIgogICB4bWxuczpjYz0iaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbnMjIgogICB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiCiAgIHhtbG5zOnN2Zz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIKICAgeG1sbnM6c29kaXBvZGk9Imh0dHA6Ly9zb2RpcG9kaS5zb3VyY2Vmb3JnZS5uZXQvRFREL3NvZGlwb2RpLTAuZHRkIgogICB4bWxuczppbmtzY2FwZT0iaHR0cDovL3d3dy5pbmtzY2FwZS5vcmcvbmFtZXNwYWNlcy9pbmtzY2FwZSIKICAgd2lkdGg9IjgwMCIKICAgaGVpZ2h0PSI4MDAiCiAgIHZpZXdCb3g9IjAgMCAyMTEuNjY2NjYgMjExLjY2NjY2IgogICB2ZXJzaW9uPSIxLjEiCiAgIGlkPSJzdmc5MjQiCiAgIGlua3NjYXBlOmV4cG9ydC1maWxlbmFtZT0iL2hvbWUvZGFuaWVsYS9Eb2N1bWVudHMvcHJveG1veC9Qcm94bW94L01hcmtldGluZy9Mb2dvL1ppcGZpbGVzX3RvX3NlbmQvcHJveG1veC1sb2dvLXBhY2svUHJveG1veF9sb2dvc19mdWxsX2xvY2t1cF9QTkcvcHJveG1veC1sb2dvLXN0YWNrZWQtY29sb3ItYmd0cmFucy5wbmciCiAgIGlua3NjYXBlOmV4cG9ydC14ZHBpPSI5NiIKICAgaW5rc2NhcGU6ZXhwb3J0LXlkcGk9Ijk2IgogICBpbmtzY2FwZTp2ZXJzaW9uPSIxLjAuMiAoZTg2Yzg3MDg3OSwgMjAyMS0wMS0xNSkiCiAgIHNvZGlwb2RpOmRvY25hbWU9InByb3htb3gtbG9nby1zdGFja2VkLWNvbG9yLWJndHJhbnMuc3ZnIj4KICA8ZGVmcwogICAgIGlkPSJkZWZzOTE4IiAvPgogIDxzb2RpcG9kaTpuYW1lZHZpZXcKICAgICBpZD0iYmFzZSIKICAgICBwYWdlY29sb3I9IiNmZmZmZmYiCiAgICAgYm9yZGVyY29sb3I9IiM2NjY2NjYiCiAgICAgYm9yZGVyb3BhY2l0eT0iMS4wIgogICAgIGlua3NjYXBlOnBhZ2VvcGFjaXR5PSIwLjAiCiAgICAgaW5rc2NhcGU6cGFnZXNoYWRvdz0iMiIKICAgICBpbmtzY2FwZTp6b29tPSIwLjU2ODYzMTEzIgogICAgIGlua3NjYXBlOmN4PSIxOTUuODQ4NzIiCiAgICAgaW5rc2NhcGU6Y3k9IjE4OS43MDQzNSIKICAgICBpbmtzY2FwZTpkb2N1bWVudC11bml0cz0ibW0iCiAgICAgaW5rc2NhcGU6Y3VycmVudC1sYXllcj0ibGF5ZXIxIgogICAgIGlua3NjYXBlOmRvY3VtZW50LXJvdGF0aW9uPSIwIgogICAgIHNob3dncmlkPSJmYWxzZSIKICAgICBpbmtzY2FwZTpwYWdlY2hlY2tlcmJvYXJkPSJ0cnVlIgogICAgIGZpdC1tYXJnaW4tdG9wPSIwIgogICAgIGZpdC1tYXJnaW4tbGVmdD0iMCIKICAgICBmaXQtbWFyZ2luLXJpZ2h0PSIwIgogICAgIGZpdC1tYXJnaW4tYm90dG9tPSIwIgogICAgIGlua3NjYXBlOndpbmRvdy13aWR0aD0iMTcyMCIKICAgICBpbmtzY2FwZTp3aW5kb3ctaGVpZ2h0PSIxMzQzIgogICAgIGlua3NjYXBlOndpbmRvdy14PSIxNzIwIgogICAgIGlua3NjYXBlOndpbmRvdy15PSIyNyIKICAgICBpbmtzY2FwZTp3aW5kb3ctbWF4aW1pemVkPSIwIgogICAgIHVuaXRzPSJweCIgLz4KICA8bWV0YWRhdGEKICAgICBpZD0ibWV0YWRhdGE5MjEiPgogICAgPHJkZjpSREY+CiAgICAgIDxjYzpXb3JrCiAgICAgICAgIHJkZjphYm91dD0iIj4KICAgICAgICA8ZGM6Zm9ybWF0PmltYWdlL3N2Zyt4bWw8L2RjOmZvcm1hdD4KICAgICAgICA8ZGM6dHlwZQogICAgICAgICAgIHJkZjpyZXNvdXJjZT0iaHR0cDovL3B1cmwub3JnL2RjL2RjbWl0eXBlL1N0aWxsSW1hZ2UiIC8+CiAgICAgICAgPGRjOnRpdGxlIC8+CiAgICAgIDwvY2M6V29yaz4KICAgIDwvcmRmOlJERj4KICA8L21ldGFkYXRhPgogIDxnCiAgICAgaW5rc2NhcGU6bGFiZWw9IkxheWVyIDEiCiAgICAgaW5rc2NhcGU6Z3JvdXBtb2RlPSJsYXllciIKICAgICBpZD0ibGF5ZXIxIgogICAgIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0xMS4zNDY5MTYsLTMxLjM2ODQ2MSkiPgogICAgPGcKICAgICAgIGlkPSJnMTg5OCIKICAgICAgIHRyYW5zZm9ybT0ibWF0cml4KDEuMzQ2MzMzNCwwLDAsMS4zNDYzMzM0LDM3NS4zMzE1NiwtMTIxNS41MDU5KSI+CiAgICAgIDxnCiAgICAgICAgIHRyYW5zZm9ybT0ibWF0cml4KDAuNjI4ODY4NTQsMCwwLDAuNjI4ODY4NTQsMTI1LjMxODE4LDI5Ny45OTg2NSkiCiAgICAgICAgIGlkPSJnMTI4OCIKICAgICAgICAgc3R5bGU9ImZpbGw6IzAwMDAwMCI+CiAgICAgICAgPGcKICAgICAgICAgICBpZD0iZzEyODYiCiAgICAgICAgICAgc3R5bGU9ImZvbnQtc3R5bGU6bm9ybWFsO2ZvbnQtdmFyaWFudDpub3JtYWw7Zm9udC13ZWlnaHQ6bm9ybWFsO2ZvbnQtc3RyZXRjaDpub3JtYWw7Zm9udC1zaXplOjI1LjgzMzZweDtsaW5lLWhlaWdodDoxMjUlO2ZvbnQtZmFtaWx5OkhlbGlvbjstaW5rc2NhcGUtZm9udC1zcGVjaWZpY2F0aW9uOkhlbGlvbjt0ZXh0LWFsaWduOnN0YXJ0O2xldHRlci1zcGFjaW5nOjBweDt3b3JkLXNwYWNpbmc6MHB4O3dyaXRpbmctbW9kZTpsci10Yjt0ZXh0LWFuY2hvcjpzdGFydDtmaWxsOiMwMDAwMDA7ZmlsbC1vcGFjaXR5OjE7c3Ryb2tlOm5vbmUiCiAgICAgICAgICAgdHJhbnNmb3JtPSJtYXRyaXgoMS4yNDM1MTM3LDAsMCwxLjI0MzUxMzcsLTc5MS4wNjQ4MSw1NTMuNzU4NjIpIj4KICAgICAgICAgIDxwYXRoCiAgICAgICAgICAgICBpbmtzY2FwZTpjb25uZWN0b3ItY3VydmF0dXJlPSIwIgogICAgICAgICAgICAgaWQ9InBhdGgxMjcyIgogICAgICAgICAgICAgZD0ibSAxNjguODUxNDIsNTAwLjk1OTUgaCAtMTEuODU3NDcgYyAtMC40NjU1NCwwLjAxMjkgLTAuODU4NDIsMC4xODA4NSAtMS4xNzg2NCwwLjUwMzc0IC0wLjMyMDIzLDAuMzIyOTQgLTAuNDg3MDcsMC43MjMzNSAtMC41MDA1MiwxLjIwMTI1IHYgMTYuMzc4MyBjIDEuMjcyMjksLTAuMDMxOCAyLjMzMTQ1LC0wLjQ3MiAzLjE3NzQ5LC0xLjMyMDczIDAuODQ2MDQsLTAuODQ4NzMgMS4yODUyLC0xLjkxNTQzIDEuMzE3NSwtMy4yMDAxIGggOS4wNDE2NCBjIDEuMjg1NzMsLTAuMDMxNyAyLjM1NjczLC0wLjQ3MTk5IDMuMjEzMDIsLTEuMzIwNzIgMC44NTYyNCwtMC44NDg3MyAxLjMwMDc5LC0xLjkxNTQzIDEuMzMzNjQsLTMuMjAwMSB2IC00LjQ5NDk5IGMgLTAuMDMyOCwtMS4yODU3MyAtMC40Nzc0LC0yLjM1NjczIC0xLjMzMzY0LC0zLjIxMzAxIC0wLjg1NjI5LC0wLjg1NjI1IC0xLjkyNzI5LC0xLjMwMDggLTMuMjEzMDIsLTEuMzMzNjQgeiBtIC05LjA0MTY0LDkuNjA5OTcgdiAtNS4wNjMzMiBoIDcuOTMwODEgYyAwLjA0NjMsLTAuMDIzMSAwLjIzMTQxLDAuMDIzMiAwLjU1NTQyLDAuMTM4ODUgMC4zMjM5OCwwLjExNTczIDAuNTA5MTIsMC40Mzk3MiAwLjU1NTQxLDAuOTcxOTggdiAyLjgxNTgzIGMgMC4wMjMxLDAuMDQ3NCAtMC4wMjMxLDAuMjM2ODEgLTAuMTM4ODUsMC41NjgzMyAtMC4xMTU3MywwLjMzMTU0IC0wLjQzOTcyLDAuNTIwOTggLTAuOTcxOTgsMC41NjgzMyB6IgogICAgICAgICAgICAgc3R5bGU9ImZpbGw6IzAwMDAwMDtmaWxsLW9wYWNpdHk6MSIgLz4KICAgICAgICAgIDxwYXRoCiAgICAgICAgICAgICBpbmtzY2FwZTpjb25uZWN0b3ItY3VydmF0dXJlPSIwIgogICAgICAgICAgICAgaWQ9InBhdGgxMjc0IgogICAgICAgICAgICAgZD0ibSAxOTQuMDU5MzEsNTA4Ljg5MDMxIHYgLTMuMzg0MTYgYyAtMC4wMzE4LC0xLjI4NTczIC0wLjQ3MjAxLC0yLjM1NjczIC0xLjMyMDcyLC0zLjIxMzAxIC0wLjg0ODc1LC0wLjg1NjI1IC0xLjkxNTQ1LC0xLjMwMDggLTMuMjAwMSwtMS4zMzM2NCBoIC0xMS44NTc0NyBjIC0wLjQ3Njg0LDAuMDEyOSAtMC44NzI5NSwwLjE4MDg1IC0xLjE4ODMzLDAuNTAzNzQgLTAuMzE1MzgsMC4zMjI5NCAtMC40Nzg5OSwwLjcyMzM1IC0wLjQ5MDgzLDEuMjAxMjUgdiAxNi4zNzgzIGMgMS4yNzMzNiwtMC4wMzE4IDIuMzM2ODMsLTAuNDcyIDMuMTkwNCwtMS4zMjA3MyAwLjg1MzU3LC0wLjg0ODczIDEuMjk3MDUsLTEuOTE1NDMgMS4zMzA0MiwtMy4yMDAxIHYgLTEuMTM2NjYgaCA1LjE0MDgyIGwgMi42MDkxNiwzLjcxOTk5IGMgMC40MTg3LDAuNjAwNjMgMC45NDM5OCwxLjA3MjA4IDEuNTc1ODMsMS40MTQzNyAwLjYzMTgyLDAuMzQyMjkgMS4zMzc5MywwLjUxNjY3IDIuMTE4MzMsMC41MjMxMyAwLjM3NjE4LC01LjRlLTQgMC43NDEwNywtMC4wNDQ3IDEuMDk0NjgsLTAuMTMyNCAwLjM1MzU4LC0wLjA4NzcgMC42ODYxOCwtMC4yMTU4MiAwLjk5NzgxLC0wLjM4NDI3IGwgLTMuNjQyNDksLTUuMTkyNDkgYyAxLjA1NTkyLC0wLjIyODcyIDEuOTIxMzMsLTAuNzQ2NDcgMi41OTYyNSwtMS41NTMyMiAwLjY3NDg3LC0wLjgwNjc1IDEuMDIzNjIsLTEuNzcwMTEgMS4wNDYyNCwtMi44OTAxIHogbSAtMTMuNTM2NjMsMC41NDI1IHYgLTMuOTI2NjYgaCA3Ljg3OTE1IGMgMC4wNDc0LC0wLjAyMzEgMC4yMzY3OSwwLjAyMzIgMC41NjgzMywwLjEzODg1IDAuMzMxNTEsMC4xMTU3MyAwLjUyMDk2LDAuNDM5NzIgMC41NjgzMywwLjk3MTk4IHYgMS43MDUgYyAwLjAyMzcsMC4wNDYzIC0wLjAyMzcsMC4yMzE0MyAtMC4xNDIwOCwwLjU1NTQxIC0wLjExODQyLDAuMzI0IC0wLjQ0OTk1LDAuNTA5MTQgLTAuOTk0NTgsMC41NTU0MiB6IgogICAgICAgICAgICAgc3R5bGU9ImZpbGw6IzAwMDAwMDtmaWxsLW9wYWNpdHk6MSIgLz4KICAgICAgICAgIDxwYXRoCiAgICAgICAgICAgICBpbmtzY2FwZTpjb25uZWN0b3ItY3VydmF0dXJlPSIwIgogICAgICAgICAgICAgaWQ9InBhdGgxMjc2IgogICAgICAgICAgICAgZD0ibSAyMTAuMTc1MSw1MDAuOTU5NSBoIC05LjAxNTgxIGMgLTEuMjg0NjcsMC4wMzI4IC0yLjM1MTM3LDAuNDc3MzkgLTMuMjAwMSwxLjMzMzY0IC0wLjg0ODczLDAuODU2MjggLTEuMjg4OTcsMS45MjcyOCAtMS4zMjA3MiwzLjIxMzAxIHYgOS4wMTU4MSBjIDAuMDMxNywxLjI4NDY3IDAuNDcxOTksMi4zNTEzNyAxLjMyMDcyLDMuMjAwMSAwLjg0ODczLDAuODQ4NzMgMS45MTU0MywxLjI4ODk3IDMuMjAwMSwxLjMyMDczIGggOS4wMTU4MSBjIDEuMjg0NjUsLTAuMDMxOCAyLjM1MTM1LC0wLjQ3MiAzLjIwMDEsLTEuMzIwNzMgMC44NDg3MSwtMC44NDg3MyAxLjI4ODk1LC0xLjkxNTQzIDEuMzIwNzIsLTMuMjAwMSB2IC05LjAxNTgxIGMgLTAuMDMxOCwtMS4yODU3MyAtMC40NzIwMSwtMi4zNTY3MyAtMS4zMjA3MiwtMy4yMTMwMSAtMC44NDg3NSwtMC44NTYyNSAtMS45MTU0NSwtMS4zMDA4IC0zLjIwMDEsLTEuMzMzNjQgeiBtIDAsMTIuNDI1OCBjIDAuMDIzNywwLjA0NzQgLTAuMDIzNywwLjIzNjgxIC0wLjE0MjA4LDAuNTY4MzMgLTAuMTE4NDIsMC4zMzE1MyAtMC40NDk5NSwwLjUyMDk4IC0wLjk5NDU4LDAuNTY4MzMgaCAtNi43NDI0OSBjIC0wLjA0NzQsMC4wMjM3IC0wLjIzNjgxLC0wLjAyMzcgLTAuNTY4MzMsLTAuMTQyMDggLTAuMzMxNTMsLTAuMTE4NCAtMC41MjA5OCwtMC40NDk5MyAtMC41NjgzMywtMC45OTQ1OCB2IC02Ljc2ODMyIGMgLTAuMDIzNywtMC4wNDYzIDAuMDIzNywtMC4yMzE0MSAwLjE0MjA4LC0wLjU1NTQxIDAuMTE4NCwtMC4zMjM5OCAwLjQ0OTkzLC0wLjUwOTEyIDAuOTk0NTgsLTAuNTU1NDIgaCA2Ljc0MjQ5IGMgMC4wNDczLC0wLjAyMzEgMC4yMzY3OSwwLjAyMzIgMC41NjgzMywwLjEzODg1IDAuMzMxNTEsMC4xMTU3MyAwLjUyMDk2LDAuNDM5NzIgMC41NjgzMywwLjk3MTk4IHoiCiAgICAgICAgICAgICBzdHlsZT0iZmlsbDojMDAwMDAwO2ZpbGwtb3BhY2l0eToxIiAvPgogICAgICAgICAgPHBhdGgKICAgICAgICAgICAgIGlua3NjYXBlOmNvbm5lY3Rvci1jdXJ2YXR1cmU9IjAiCiAgICAgICAgICAgICBpZD0icGF0aDEyNzgiCiAgICAgICAgICAgICBkPSJtIDIzNy40NzY3LDUwMi4yNTExNiBjIC0wLjM5MTgzLC0wLjM5MTc5IC0wLjg0ODIyLC0wLjY5OTY0IC0xLjM2OTE3LC0wLjkyMzU0IC0wLjUyMDk5LC0wLjIyMzg3IC0xLjA4MDcxLC0wLjMzNzk3IC0xLjY3OTE2LC0wLjM0MjI5IC0wLjYzNjcsMC4wMDUgLTEuMjIzMzMsMC4xMzA4IC0xLjc1OTg5LDAuMzc3ODEgLTAuNTM2NTksMC4yNDcwNSAtMS4wMDA1MiwwLjU4NjExIC0xLjM5MTc3LDEuMDE3MTkgbCAtMy45MDA4Miw0LjI4ODMyIC0zLjkyNjY2LC00LjI4ODMyIGMgLTAuNDAxNSwtMC40NDIzOCAtMC44NjQzNCwtMC43ODQ2NyAtMS4zODg1NCwtMS4wMjY4OCAtMC41MjQyLC0wLjI0MjE3IC0xLjEwMzMsLTAuMzY0ODcgLTEuNzM3MjksLTAuMzY4MTIgLTAuNTk4NDcsMC4wMDQgLTEuMTU4MTksMC4xMTg0MiAtMS42NzkxNiwwLjM0MjI5IC0wLjUyMDk3LDAuMjIzOSAtMC45NzczNiwwLjUzMTc1IC0xLjM2OTE2LDAuOTIzNTQgbCA3LjA1MjQ4LDcuNzQ5OTggLTcuMDUyNDgsNy43NDk5OCBjIDAuMzkxOCwwLjQwNDE5IDAuODQ4MTksMC43MTk1NyAxLjM2OTE2LDAuOTQ2MTUgMC41MjA5NywwLjIyNjU3IDEuMDgwNjksMC4zNDE3NSAxLjY3OTE2LDAuMzQ1NTIgMC42MjUzOCwtMC4wMDUgMS4yMDg3OCwtMC4xMzA3OSAxLjc1MDIxLC0wLjM3NzgyIDAuNTQxNDIsLTAuMjQ3MDMgMS4wMDg1NywtMC41ODYwOSAxLjQwMTQ1LC0xLjAxNzE4IGwgMy45MDA4MywtNC4yODgzMiAzLjkwMDgyLDQuMjg4MzIgYyAwLjM5MTI1LDAuNDMxMDkgMC44NTUxOCwwLjc3MDE1IDEuMzkxNzcsMS4wMTcxOCAwLjUzNjU2LDAuMjQ3MDMgMS4xMjMxOSwwLjM3Mjk3IDEuNzU5ODksMC4zNzc4MiAwLjU5ODQ1LC0wLjAwNCAxLjE1ODE3LC0wLjExODk1IDEuNjc5MTYsLTAuMzQ1NTIgMC41MjA5NiwtMC4yMjY1OCAwLjk3NzM0LC0wLjU0MTk2IDEuMzY5MTcsLTAuOTQ2MTUgbCAtNy4wNTI0OSwtNy43NDk5OCB6IgogICAgICAgICAgICAgc3R5bGU9ImZpbGw6IzAwMDAwMDtmaWxsLW9wYWNpdHk6MSIgLz4KICAgICAgICAgIDxwYXRoCiAgICAgICAgICAgICBpbmtzY2FwZTpjb25uZWN0b3ItY3VydmF0dXJlPSIwIgogICAgICAgICAgICAgaWQ9InBhdGgxMjgwIgogICAgICAgICAgICAgZD0ibSAyNjAuOTgwNDIsNTAwLjk1OTUgaCAtMi44NDE2NiBjIC0wLjkyOTQ3LDAuMDEyOSAtMS43NTcyMSwwLjI2NDggLTIuNDgzMjIsMC43NTU2MiAtMC43MjYwNCwwLjQ5MDg1IC0xLjI3NjA3LDEuMTQzMTQgLTEuNjUwMSwxLjk1Njg3IGwgMC4wMjU4LC0wLjA1MTcgLTIuNjYwODIsNS44MzgzMiAtMi42MzUsLTUuODM4MzIgdiAwLjA1MTcgYyAtMC4zNjI3NSwtMC44MTM3MyAtMC45MDk1NSwtMS40NjYwMiAtMS42NDA0MSwtMS45NTY4NyAtMC43MzA4NywtMC40OTA4MiAtMS41NjE4NCwtMC43NDI2OSAtMi40OTI5MSwtMC43NTU2MiBoIC0yLjgxNTgzIGMgLTAuNDg5MjIsMC4wMTI5IC0wLjg5Mjg2LDAuMTgwODUgLTEuMjEwOTMsMC41MDM3NCAtMC4zMTgwOCwwLjMyMjk0IC0wLjQ4Mjc2LDAuNzIzMzUgLTAuNDk0MDYsMS4yMDEyNSB2IDE2LjM3ODMgYyAxLjI3MzM2LC0wLjAzMTggMi4zMzY4MywtMC40NzIgMy4xOTA0MSwtMS4zMjA3MyAwLjg1MzU3LC0wLjg0ODczIDEuMjk3MDQsLTEuOTE1NDMgMS4zMzA0MSwtMy4yMDAxIHYgLTguNjU0MTQgYyAwLjAwMiwtMC4xMTc4NSAwLjAzNzEsLTAuMjExNSAwLjEwNjU2LC0wLjI4MDk0IDAuMDY5NCwtMC4wNjk0IDAuMTYzMDcsLTAuMTA0OTMgMC4yODA5NCwtMC4xMDY1NiAwLjA2NzMsMC4wMDIgMC4xMzI5MywwLjAyMzcgMC4xOTY5OCwwLjA2NDYgMC4wNjQsMC4wNDA5IDAuMTEwMzIsMC4wODgzIDAuMTM4ODUsMC4xNDIwOCBsIDUuMDExNjYsMTEuMDU2NjQgYyAwLjA5NDcsMC4xOTc1MiAwLjIzNDY0LDAuMzU3OSAwLjQxOTc5LDAuNDgxMTUgMC4xODUxMiwwLjEyMzI1IDAuMzg5NjQsMC4xODY3NSAwLjYxMzU0LDAuMTkwNTIgMC4yMjIyNiwtMC4wMDMgMC40MjM1NCwtMC4wNjE5IDAuNjAzODUsLTAuMTc3NiAwLjE4MDI4LC0wLjExNTcxIDAuMzIzNDQsLTAuMjcxNzkgMC40Mjk0OCwtMC40NjgyMyBMIDI1Ny40MTU0LDUwNS42ODcgYyAwLjAzOTMsLTAuMDUzOCAwLjA4OTksLTAuMTAxMTYgMC4xNTE3NywtMC4xNDIwOCAwLjA2MTksLTAuMDQwOSAwLjEzMTg0LC0wLjA2MjQgMC4yMDk5LC0wLjA2NDYgMC4xMDU0NywwLjAwMiAwLjE5MTU4LDAuMDM3MSAwLjI1ODMzLDAuMTA2NTYgMC4wNjY3LDAuMDY5NCAwLjEwMTE2LDAuMTYzMDkgMC4xMDMzMywwLjI4MDk0IHYgOC42NTQxNCBjIDAuMDMzMywxLjI4NDY3IDAuNDc2ODIsMi4zNTEzNyAxLjMzMDQyLDMuMjAwMSAwLjg1MzU1LDAuODQ4NzMgMS45MTcwMiwxLjI4ODk3IDMuMTkwNDEsMS4zMjA3MyB2IC0xNi4zNzgzIGMgLTAuMDExOSwtMC40Nzc5IC0wLjE3NTQ4LC0wLjg3ODMxIC0wLjQ5MDg0LC0xLjIwMTI1IC0wLjMxNTQsLTAuMzIyODkgLTAuNzExNTEsLTAuNDkwODEgLTEuMTg4MzMsLTAuNTAzNzQgeiIKICAgICAgICAgICAgIHN0eWxlPSJmaWxsOiMwMDAwMDA7ZmlsbC1vcGFjaXR5OjEiIC8+CiAgICAgICAgICA8cGF0aAogICAgICAgICAgICAgaW5rc2NhcGU6Y29ubmVjdG9yLWN1cnZhdHVyZT0iMCIKICAgICAgICAgICAgIGlkPSJwYXRoMTI4MiIKICAgICAgICAgICAgIGQ9Im0gMjc4Ljc5NTYxLDUwMC45NTk1IGggLTkuMDE1ODEgYyAtMS4yODQ2NywwLjAzMjggLTIuMzUxMzcsMC40NzczOSAtMy4yMDAwOSwxLjMzMzY0IC0wLjg0ODc0LDAuODU2MjggLTEuMjg4OTgsMS45MjcyOCAtMS4zMjA3MywzLjIxMzAxIHYgOS4wMTU4MSBjIDAuMDMxNywxLjI4NDY3IDAuNDcxOTksMi4zNTEzNyAxLjMyMDczLDMuMjAwMSAwLjg0ODcyLDAuODQ4NzMgMS45MTU0MiwxLjI4ODk3IDMuMjAwMDksMS4zMjA3MyBoIDkuMDE1ODEgYyAxLjI4NDY2LC0wLjAzMTggMi4zNTEzNSwtMC40NzIgMy4yMDAxLC0xLjMyMDczIDAuODQ4NzEsLTAuODQ4NzMgMS4yODg5NiwtMS45MTU0MyAxLjMyMDczLC0zLjIwMDEgdiAtOS4wMTU4MSBjIC0wLjAzMTgsLTEuMjg1NzMgLTAuNDcyMDIsLTIuMzU2NzMgLTEuMzIwNzMsLTMuMjEzMDEgLTAuODQ4NzUsLTAuODU2MjUgLTEuOTE1NDQsLTEuMzAwOCAtMy4yMDAxLC0xLjMzMzY0IHogbSAwLDEyLjQyNTggYyAwLjAyMzcsMC4wNDc0IC0wLjAyMzcsMC4yMzY4MSAtMC4xNDIwOCwwLjU2ODMzIC0wLjExODQyLDAuMzMxNTMgLTAuNDQ5OTQsMC41MjA5OCAtMC45OTQ1OCwwLjU2ODMzIGggLTYuNzQyNDggYyAtMC4wNDc0LDAuMDIzNyAtMC4yMzY4MSwtMC4wMjM3IC0wLjU2ODM0LC0wLjE0MjA4IC0wLjMzMTUzLC0wLjExODQgLTAuNTIwOTcsLTAuNDQ5OTMgLTAuNTY4MzMsLTAuOTk0NTggdiAtNi43NjgzMiBjIC0wLjAyMzcsLTAuMDQ2MyAwLjAyMzcsLTAuMjMxNDEgMC4xNDIwOSwtMC41NTU0MSAwLjExODM5LC0wLjMyMzk4IDAuNDQ5OTIsLTAuNTA5MTIgMC45OTQ1OCwtMC41NTU0MiBoIDYuNzQyNDggYyAwLjA0NzMsLTAuMDIzMSAwLjIzNjc5LDAuMDIzMiAwLjU2ODMzLDAuMTM4ODUgMC4zMzE1MiwwLjExNTczIDAuNTIwOTYsMC40Mzk3MiAwLjU2ODMzLDAuOTcxOTggeiIKICAgICAgICAgICAgIHN0eWxlPSJmaWxsOiMwMDAwMDA7ZmlsbC1vcGFjaXR5OjEiIC8+CiAgICAgICAgICA8cGF0aAogICAgICAgICAgICAgaW5rc2NhcGU6Y29ubmVjdG9yLWN1cnZhdHVyZT0iMCIKICAgICAgICAgICAgIGlkPSJwYXRoMTI4NCIKICAgICAgICAgICAgIGQ9Im0gMzA2LjA5NzIsNTAyLjI1MTE2IGMgLTAuMzkxODIsLTAuMzkxNzkgLTAuODQ4MjEsLTAuNjk5NjQgLTEuMzY5MTYsLTAuOTIzNTQgLTAuNTIwOTksLTAuMjIzODcgLTEuMDgwNzEsLTAuMzM3OTcgLTEuNjc5MTYsLTAuMzQyMjkgLTAuNjM2NywwLjAwNSAtMS4yMjMzMywwLjEzMDggLTEuNzU5ODksMC4zNzc4MSAtMC41MzY2LDAuMjQ3MDUgLTEuMDAwNTIsMC41ODYxMSAtMS4zOTE3NywxLjAxNzE5IGwgLTMuOTAwODMsNC4yODgzMiAtMy45MjY2NSwtNC4yODgzMiBjIC0wLjQwMTUsLTAuNDQyMzggLTAuODY0MzUsLTAuNzg0NjcgLTEuMzg4NTQsLTEuMDI2ODggLTAuNTI0MjEsLTAuMjQyMTcgLTEuMTAzMywtMC4zNjQ4NyAtMS43MzcyOSwtMC4zNjgxMiAtMC41OTg0NywwLjAwNCAtMS4xNTgxOSwwLjExODQyIC0xLjY3OTE2LDAuMzQyMjkgLTAuNTIwOTcsMC4yMjM5IC0wLjk3NzM2LDAuNTMxNzUgLTEuMzY5MTcsMC45MjM1NCBsIDcuMDUyNDksNy43NDk5OCAtNy4wNTI0OSw3Ljc0OTk4IGMgMC4zOTE4MSwwLjQwNDE5IDAuODQ4MiwwLjcxOTU3IDEuMzY5MTcsMC45NDYxNSAwLjUyMDk3LDAuMjI2NTcgMS4wODA2OSwwLjM0MTc1IDEuNjc5MTYsMC4zNDU1MiAwLjYyNTM4LC0wLjAwNSAxLjIwODc4LC0wLjEzMDc5IDEuNzUwMiwtMC4zNzc4MiAwLjU0MTQyLC0wLjI0NzAzIDEuMDA4NTcsLTAuNTg2MDkgMS40MDE0NiwtMS4wMTcxOCBsIDMuOTAwODIsLTQuMjg4MzIgMy45MDA4Myw0LjI4ODMyIGMgMC4zOTEyNSwwLjQzMTA5IDAuODU1MTcsMC43NzAxNSAxLjM5MTc3LDEuMDE3MTggMC41MzY1NiwwLjI0NzAzIDEuMTIzMTksMC4zNzI5NyAxLjc1OTg5LDAuMzc3ODIgMC41OTg0NSwtMC4wMDQgMS4xNTgxNywtMC4xMTg5NSAxLjY3OTE2LC0wLjM0NTUyIDAuNTIwOTUsLTAuMjI2NTggMC45NzczNCwtMC41NDE5NiAxLjM2OTE2LC0wLjk0NjE1IGwgLTcuMDUyNDgsLTcuNzQ5OTggeiIKICAgICAgICAgICAgIHN0eWxlPSJmaWxsOiMwMDAwMDA7ZmlsbC1vcGFjaXR5OjEiIC8+CiAgICAgICAgPC9nPgogICAgICA8L2c+CiAgICAgIDxnCiAgICAgICAgIGlkPSJnMTg4MiI+CiAgICAgICAgPHBhdGgKICAgICAgICAgICBpbmtzY2FwZTpjb25uZWN0b3ItY3VydmF0dXJlPSIwIgogICAgICAgICAgIGlkPSJwYXRoMTI5MCIKICAgICAgICAgICBzdHlsZT0iZmlsbDojZTU3MDAwO2ZpbGwtb3BhY2l0eToxO2ZpbGwtcnVsZTpub256ZXJvO3N0cm9rZTpub25lO3N0cm9rZS13aWR0aDowLjU0Mjg3NSIKICAgICAgICAgICBkPSJtIC0xNzMuMzg0OTcsOTg5LjY0NTE0IDE4Ljg3NTI0LDIwLjc0MjI2IGMgLTIuMDc0MywyLjE0MzIgLTQuOTc4MTQsMy40NTc1IC04LjE1OTQsMy40NTc1IC0zLjM4NzU0LDAgLTYuMzYwMzUsLTEuNDUyMiAtOC40MzQ3LC0zLjczMzkgbCAtMTAuNDQwMDIsLTExLjQ3Njg5IC04LjE1ODksLTguOTg4OTcgOC4xNTg5LC04LjkxOTQ0IDEwLjQ0MDAyLC0xMS40Nzc0OSBjIDIuMDc0MzUsLTIuMjgxMTQgNS4wNDcxNiwtMy43MzM5IDguNDM0NywtMy43MzM5IDMuMTgxMjYsMCA2LjA4NTEsMS4zMTM3NiA4LjE1OTQsMy4zODgxMSB6IgogICAgICAgICAgIHNvZGlwb2RpOm5vZGV0eXBlcz0iY2NzY2NjY2NzY2MiIC8+CiAgICAgICAgPHBhdGgKICAgICAgICAgICBpbmtzY2FwZTpjb25uZWN0b3ItY3VydmF0dXJlPSIwIgogICAgICAgICAgIGlkPSJwYXRoMTI5MiIKICAgICAgICAgICBzdHlsZT0iZmlsbDojZTU3MDAwO2ZpbGwtb3BhY2l0eToxO2ZpbGwtcnVsZTpub256ZXJvO3N0cm9rZTpub25lO3N0cm9rZS13aWR0aDowLjU0Mjg3NSIKICAgICAgICAgICBkPSJtIC0yMTAuMTk4NTQsOTg5LjY0NDkxIC0xOC44NzUyNSwyMC43NDIyOSBjIDIuMDc0MywyLjE0MzIgNC45NzgxNCwzLjQ1NzUgOC4xNTk0MSwzLjQ1NzUgMy4zODc1MywwIDYuMzYwMzQsLTEuNDUyMiA4LjQzNDY5LC0zLjczMzkgbCAxMC40NDAwMiwtMTEuNDc2OTIgOC4xNTg4OCwtOC45ODg5NyAtOC4xNTg4OCwtOC45MTk0NCAtMTAuNDQwMDIsLTExLjQ3NzQ5IGMgLTIuMDc0MzUsLTIuMjgxMTcgLTUuMDQ3MTYsLTMuNzMzOSAtOC40MzQ2OSwtMy43MzM5IC0zLjE4MTI3LDAgLTYuMDg1MTEsMS4zMTM3NiAtOC4xNTk0MSwzLjM4ODExIHoiCiAgICAgICAgICAgc29kaXBvZGk6bm9kZXR5cGVzPSJjY3NjY2NjY3NjYyIgLz4KICAgICAgICA8cGF0aAogICAgICAgICAgIGlua3NjYXBlOmNvbm5lY3Rvci1jdXJ2YXR1cmU9IjAiCiAgICAgICAgICAgaWQ9InBhdGgxMjk0IgogICAgICAgICAgIHN0eWxlPSJmaWxsOiMwMDAwMDA7ZmlsbC1vcGFjaXR5OjE7ZmlsbC1ydWxlOm5vbnplcm87c3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOjAuNDk1NTA5IgogICAgICAgICAgIGQ9Im0gLTE4NC4zNTQyOSw5OTkuOTI5NzMgLTcuNDQ2NzgsLTguMjA0NDEgLTcuNDQ3MTIsOC4yMDQ0MSAtMTcuMjI4NTMsMTguOTMyNzcgYyAxLjg5MzE1LDEuODkzMyA0LjU0NDMyLDMuMDkyMyA3LjQ0NjI2LDMuMDkyMyAzLjA5MjU0LDAgNS42ODA0NSwtMS4yNjI1IDcuNjM2MzgsLTMuNDA3OSBsIDkuNTkzMDEsLTEwLjQ3NTkgOS41Mjg3MSwxMC40NzU5IGMgMS44OTM1MSwyLjA4MTkgNC42MDY3MiwzLjQwNzkgNy42OTg3OCwzLjQwNzkgMi45MDM1MiwwIDUuNTU0MTEsLTEuMTk5IDcuNDQ3MjgsLTMuMDkyMyB6IgogICAgICAgICAgIHNvZGlwb2RpOm5vZGV0eXBlcz0iY2NjY3NjY2NzY2MiIC8+CiAgICAgICAgPHBhdGgKICAgICAgICAgICBpbmtzY2FwZTpjb25uZWN0b3ItY3VydmF0dXJlPSIwIgogICAgICAgICAgIGlkPSJwYXRoMTI5NiIKICAgICAgICAgICBzdHlsZT0iZmlsbDojMDAwMDAwO2ZpbGwtb3BhY2l0eToxO2ZpbGwtcnVsZTpub256ZXJvO3N0cm9rZTpub25lO3N0cm9rZS13aWR0aDowLjQ5NTUwOSIKICAgICAgICAgICBkPSJtIC0xODQuMzU0NzUsOTc5LjM1OTIyIC03LjQ0Njc4LDguMjA0NDEgLTcuNDQ3MTIsLTguMjA0NDEgLTE3LjIyODUyLC0xOC45MzI3NiBjIDEuODkzMTcsLTEuODkzMjQgNC41NDQzMSwtMy4wOTIyNyA3LjQ0NjI3LC0zLjA5MjI3IDMuMDkyNTUsMCA1LjY4MDQ0LDEuMjYyNDkgNy42MzYzNiwzLjQwNzg4IGwgOS41OTMwMSwxMC40NzU5MyA5LjUyODcxLC0xMC40NzU5MyBjIDEuODkzNTQsLTIuMDgxOTUgNC42MDY3NCwtMy40MDc4OCA3LjY5ODc4LC0zLjQwNzg4IDIuOTAzNTIsMCA1LjU1NDE0LDEuMTk5MDMgNy40NDcyOSwzLjA5MjI3IHoiCiAgICAgICAgICAgc29kaXBvZGk6bm9kZXR5cGVzPSJjY2Njc2NjY3NjYyIgLz4KICAgICAgPC9nPgogICAgPC9nPgogIDwvZz4KPC9zdmc+Cg==" | base64 -d > /opt/pxstor/ui/proxmox-logo.svg
cat > /opt/pxstor/src/ui/src/App.css << 'APPCSS'
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: 'Segoe UI', sans-serif; overflow: hidden; }
APPCSS

echo "âœ“ Source code extracted"
echo ""

echo "ðŸ”¨ Building agent..."
cd /opt/pxstor/src/agent
go mod init pxstor-agent 2>/dev/null || true
go get gopkg.in/yaml.v3 >/dev/null 2>&1
go build -o /opt/pxstor/bin/pxstor-agent . 2>&1 | grep -v "go: downloading" || true

echo "ðŸ”¨ Building coordinator..."
cd /opt/pxstor/src/coordinator
go mod init pxstor-coordinator 2>/dev/null || true
go build -o /opt/pxstor/bin/pxstor-coordinator . 2>&1 | grep -v "go: downloading" || true

echo "ðŸ”¨ Building UI (this may take a minute)..."
cd /opt/pxstor/src/ui
npm install --silent >/dev/null 2>&1
npm run build --silent >/dev/null 2>&1
cp -r dist/* /opt/pxstor/ui/

echo "âœ“ Build complete"
echo ""

echo "âš™ï¸  Creating services..."
cat > /etc/systemd/system/pxstor-agent.service << 'AGENTSVC'
[Unit]
Description=pxstor agent
After=network.target
[Service]
Type=simple
User=root
WorkingDirectory=/opt/pxstor
ExecStart=/opt/pxstor/bin/pxstor-agent
Restart=always
[Install]
WantedBy=multi-user.target
AGENTSVC

cat > /etc/systemd/system/pxstor-coordinator.service << 'COORDSVC'
[Unit]
Description=pxstor coordinator
After=network.target
[Service]
Type=simple
User=root
WorkingDirectory=/opt/pxstor
ExecStart=/opt/pxstor/bin/pxstor-coordinator
Restart=always
[Install]
WantedBy=multi-user.target
COORDSVC

chown -R pxstor:pxstor /opt/pxstor

systemctl daemon-reload
systemctl enable pxstor-agent pxstor-coordinator >/dev/null 2>&1
systemctl start pxstor-agent
systemctl start pxstor-coordinator

NODE_IP=$(hostname -I | awk '{print $1}')

echo ""
echo "======================================"
echo "âœ… Installation Complete!"
echo "======================================"
echo ""
echo "ðŸŒ Access: http://$NODE_IP:8087"
echo "ðŸ”‘ Token: $TOKEN"
echo ""
echo "Services:"
echo "  systemctl status pxstor-agent"
echo "  systemctl status pxstor-coordinator"
echo ""
